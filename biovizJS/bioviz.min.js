var biovizNamespace = {};
(function(ns) {
var z,aa=[];function da(e){return function(){return aa[e].apply(this,arguments)}}function ea(){if(this.constructor===ea)throw Error("Can't instanciate abstract class BiovizMap");}z=ea.prototype;z.set=function(){throw Error("Trying to call an abstract method");};z.get=function(){throw Error("Trying to call an abstract method");};z.remove=function(){throw Error("Trying to call an abstract method");};z.Dc=function(){throw Error("Trying to call an abstract method");};
z.keys=function(){throw Error("Trying to call an abstract method");};z.values=function(){throw Error("Trying to call an abstract method");};z.clear=function(){throw Error("Trying to call an abstract method");};z.pd=da(2);function fa(){ea.call(this);this.ja=Object.create(null);this.Ef=Object.create(null);this.Ve={}.hasOwnProperty}fa.prototype=Object.create(ea.prototype);z=fa.prototype;z.constructor=fa;z.set=function(e,f){var g=ha(e);this.Dc(g);this.ja[g]=f;this.Ef[g]=e};
z.get=function(e){e=ha(e);return this.Dc(e)?this.ja[e]:null};z.remove=function(e){e=ha(e);if(this.Dc(e)){var f=this.ja[e];delete this.ja[e];delete this.Ef[e];return f}return null};z.Dc=function(e){e=ha(e);return this.Ve.call(this.ja,e)};z.keys=function(){var e=[],f;for(f in this.ja)e.push(f);return e};z.values=function(){var e=[],f;for(f in this.ja)e.push(this.ja[f]);return e};z.clear=function(){this.ja=Object.create(null);this.Ef=Object.create(null)};z.pd=da(1);
function ha(e){if(e instanceof Array){e=[];for(var f=e.length,g=0;g<f;g++)e.push(e[g].vb());return e.join("")}return e instanceof Object?e.vb():e}function ja(){ea.call(this);this.ja=[]}function ka(e,f){this.key=e;this.value=f}ja.prototype=Object.create(ea.prototype);z=ja.prototype;z.constructor=ja;
z.set=function(e,f){if(void 0===e)throw"ERROR: key cannot be undefined";var g;a:if(void 0!==e.kf)g=this.ja[e.kf];else{for(g in this.ja)if(this.ja[g].key===e){g=this.ja[g];break a}g=void 0}void 0===g?"object"===typeof e&&(e.kf=this.ja.push(new ka(e,f))-1):g.value=f};z.get=function(e){if(void 0!==e.kf)return this.ja[e.kf].value;for(var f in this.ja)if(this.ja[f].key===e)return this.ja[f].value};z.keys=function(){var e=[],f;for(f in this.ja)e.push(this.ja[f].key);return e};
z.Dc=function(e){return-1!==this.keys().indexOf(e)};z.values=function(){var e=[],f;for(f in this.ja)e.push(this.ja[f].value);return e};z.remove=function(e){var f=-1,g;for(g in this.ja)if(this.ja[g].key===e){f=g;break}return 0<=f?this.ja.splice(f,1)[0].value:null};z.clear=function(){this.ja=[]};z.pd=da(0);

function Ea(){this.pos=new THREE.Vector3;this.aa=this.wa=this.Wb=this.v=this.u=this.cc=this.da=this.symbol=this.ta=this.fa=this.ld=this.name=this.id=this.type=null}z=Ea.prototype;z.sa=function(){return this.id};z.mb=function(){return this.wa};function Ma(e,f){e.v!==f&&(e.v=f,null!==e.wa&&e.wa.bd(f))}z.Ka=function(){return this.pos};z.mc=function(){if(null===this.aa){var e=parseFloat(Ua.Fc(this.symbol)[7]),f=new THREE.Vector3(-e,-e,-e),e=new THREE.Vector3(e,e,e);this.aa=new Va(f,e)}return this.aa};
z.radius=function(){return parseFloat(Ua.Fc(this.symbol)[7])};z.lb=function(){return this.Wb};function $a(e,f){if(e.Wb!==f&&(e.Wb=f,null!=e.wa)){var g=e.wa,h=e.Wb;if(g.Wb!=h){g.Wb=h;for(var k=g.u.length,l=0;l<k;l++)$a(g.u[l],h)}}}z.Vc=function(){return this.cc};z.Je=function(e){this.cc!=e&&(this.cc=e,null!==this.wa&&this.wa.Je(e))};z.ue=function(){return this.u};z.Zd=function(e){this.u!==e&&(this.u=e,null!==this.wa&&this.wa.Zd(e))};
z.jk=function(){return this.wa.ea.da._id+":"+this.wa.ea.type+":"+this.wa.ea.id+":"+this.wa.cc+":"+this.wa._id+":"+this.name+":"+this.id};z.toString=function(){return this.symbol+":"+this.id};z.qd=function(){return this.wa.qd()+":"+this.toString()};z.vb=function(){return this.symbol+":"+this.id+":"+this.u};
z.distanceTo=function(e){return e instanceof Ea?Math.sqrt((this.pos.x-e.pos.x)*(this.pos.x-e.pos.x)+(this.pos.y-e.pos.y)*(this.pos.y-e.pos.y)+(this.pos.z-e.pos.z)*(this.pos.z-e.pos.z)):Math.sqrt((this.pos.x-e.x)*(this.pos.x-e.x)+(this.pos.y-e.y)*(this.pos.y-e.y)+(this.pos.z-e.z)*(this.pos.z-e.z))};z.sub=function(e){return e instanceof Ea?new THREE.Vector3(this.pos.x-e.pos.x,this.pos.y-e.pos.y,this.pos.z-e.pos.z):new THREE.Vector3(this.pos.x-e.x,this.pos.y-e.y,this.pos.z-e.z)};
z.add=function(e){return e instanceof Ea?new THREE.Vector3(this.pos.x+e.pos.x,this.pos.y+e.pos.y,this.pos.z+e.pos.z):new THREE.Vector3(this.pos.x+e.x,this.pos.y+e.y,this.pos.z+e.z)};z.clone=function(){return new THREE.Vector3(this.pos.x,this.pos.y,this.pos.z)};function ab(){this.fa=null;this.u=new ib;this.aa=[];this.ta=this.v=this.da=null}z=ab.prototype;z.Ec=function(){return this.fa};z.Ke=function(e){this.fa=e;e=this.aa.length;for(var f=0;f<e;f++)f.Ke(this.fa)};
z.add=function(e){if(e instanceof Ea)return e=this.u.Ff(e),ub(this),e;e instanceof vb?(null!==e.bc&&e.bc!==this&&console.warn("ERROR : ",e,"already belongs to",e.bc),null===e.bc&&(this.aa.push(e),e.Ke(this.fa),e.bc=this,ub(this))):console.warn("ERROR : a is not an atom or a molecule")};
z.remove=function(e){e instanceof Ea?(e=this.u.findNode(atom),-1<e&&(delete this.u[e],ub(this))):e instanceof vb&&(null===molecule&&console.warn("molecule null in remove, Model"),molecule.bc===this&&(this.aa.splice(this.aa.Ea(molecule),1),molecule.Ke(null),molecule.bc=null,ub(this)))};z.xa=function(){return this.u.values()};
z.ec=function(){if(!this.ta){console.log("Computing atoms bonds");this.u.Ej();console.log("Building atoms Octree");this.v=this.mc();for(var e=new wb(this.v.we(),this.v.ve(),32),f=this.xa(),g=f.length,h=0;h<g;h++)e.add(new xb(f[h]));e.optimize();console.log("Building bonds");g=f.length;for(h=0;h<g;h++)for(var k=f[h],l=k.symbol,l=l.charAt(0).toUpperCase()+l.slice(1).toLowerCase(),n=parseFloat(Ua.Fc(l)[6]),r=e.ah(k.pos,5),q=r.length,t=0;t<q;t++){var x=r[t].getPoint();if(x!==k){var l=x.symbol,l=l.charAt(0).toUpperCase()+
l.slice(1).toLowerCase(),l=parseFloat(Ua.Fc(l)[6]),w=k.distanceTo(x);if(w>=n+l-.4&&w<=n+l+.4){var l=k,w=this.u.findNode(l),C=this.u.findNode(x);void 0!==w&&void 0!==C||console.warn("Couldn't find atoms ",l," and/or ",x," in model ",this);w.Ei(C)||this.u.Kg(w,C).setAttribute("BondType","SIMPLE")}}}this.ta=!0}return this.u};function ub(e){e.da=null;e.v=null;e.ta=!1}
z.Ka=function(){if(null===this.da){this.da=new THREE.Vector3;for(var e=this.xa(),f=0,g=0,h=0,k=e.length,l=0;l<k;l++)var n=e[l].pos,f=f+parseInt(n.x),g=g+parseInt(n.y),h=h+parseInt(n.z);this.da.set(f/k,g/k,h/k)}return this.da};
z.mc=function(){if(null===this.v){for(var e=new THREE.Vector3(Infinity,Infinity,Infinity),f=new THREE.Vector3(-Infinity,-Infinity,-Infinity),g=this.xa(),h=g.length,k=0;k<h;k++){var l=g[k].pos;e.x=Math.min(e.x,l.x);e.y=Math.min(e.y,l.y);e.z=Math.min(e.z,l.z);f.x=Math.max(f.x,l.x);f.y=Math.max(f.y,l.y);f.z=Math.max(f.z,l.z)}this.v=new Va(e,f)}return this.v};function vb(e){this.id=e;this.bc=this.da=this.type=null;this.ia=[];this.v=this.aa=this.u=null;this.Ig=!1}z=vb.prototype;z.sa=function(){return this.id};
z.ec=function(){return this.bc.ec()};z.bd=function(e){if(this.id!==e){this.id=e;for(var f=0;f<this.ia.length;f++)this.ia[f].Zd(e)}};z.Ec=function(){return this.da};z.Ke=function(e){this.da=e};z.add=function(e){null==e&&console.warn("residue is null in Molecule");null!==e.ea&&e.ea!==this&&console.warn(e," already belongs to ",e.ea);null===e.ea&&(this.ia.push(e),Gb(e,this),Nb(this))};
z.remove=function(e){null===e&&console.warn("residue is null in Molecule");e.ea===this&&(this.ia.remove(e),Gb(e,null),Nb(this))};z.mb=function(e){for(var f=0;f<this.ia.length;f++){var g=this.ia[f];if(g.sa()==e)return g}return null};z.xa=function(){for(var e=[],f=this.ia.length,g=0;g<f;g++)e=e.concat(this.ia[g].xa());return e};z.size=function(){return this.ia.length};z.isEmpty=function(){return 0===this.size};function Nb(e){e.u=null;e.aa=null;null!==e.bc&&ub(e.bc)}
z.Ka=function(){if(null===this.u){this.u=new THREE.Vector3;for(var e=this.xa(),f=e.length,g=0;g<f;g++){var h=e[g].pos;this.u.x+=h.x;this.u.y+=h.y;this.u.z+=h.z}this.u.x/=f;this.u.y/=f;this.u.z/=f}return this.u};
z.mc=function(){if(null===this.aa){for(var e=new THREE.Vector3(Infinity,Infinity,Infinity),f=new THREE.Vector3(-Infinity,-Infinity,-Infinity),g=this.xa(),h=g.length,k=0;k<h;k++){var l=g[k].pos;e.x=Math.min(e.x,l.x);e.y=Math.min(e.y,l.y);e.z=Math.min(e.z,l.z);f.x=Math.max(f.x,l.x);f.y=Math.max(f.y,l.y);f.z=Math.max(f.z,l.z)}this.aa=new Va(e,f)}return this.aa};z.toString=function(){return this.type+":"+this.id};z.vb=function(){return this.toString()};z.qd=function(){return this.da.qd()+":"+this.toString()};
z.ki=function(){if(null!==this.type&&"Protein"===this.type&&!this.Ig){console.time("\t\t\tCompute HBonds");if(null===this.v){var e=this.ia,f=e.length;this.v=new ib;for(var g=1;g<f;g++){var h=e[g-1],k=e[g],l=this.v.findNode(k);null==l&&(l=this.v.Lg(k.toString(),k));var n=k.hc("CA"),r=k.hc("N"),q=k.hc("H");console.log("Predicting H position for residue ",k);if(h.sa()+h.lb().charCodeAt(0)===k.sa()+k.lb().charCodeAt(0)-1&&"PRO"!==h.aa){q=h.hc("C");h=h.hc("O");if(null==q||null==h)continue;q=q.sub(h);q=
q.normalize();h=r.add(q);q=new Ea;q.name="H";q.symbol="H";q.pos.x=h.x;q.pos.y=h.y;q.pos.z=h.z}if(null==q)console.log("TRACE : H position prediction failed for residue ",k);else for(k=0;k<f;k++)if(k!=g&&k!=g-1){var t=e[k],h=this.v.findNode(t);null==h&&(h=this.v.Lg(t.toString(),t));var x=t.hc("CA"),w=t.hc("C"),C=t.hc("O");if(null!=x&&null!=w&&null!=C&&!(9<x.distanceTo(n))){var x=q.distanceTo(C),t=q.distanceTo(w),C=r.distanceTo(C),F=r.distanceTo(w),w=-9.9;.5>x||.5>t||.5>C||.5>F||(w=27.888/C,w+=27.888/
t,w-=27.888/x,w-=27.888/F,-9.9>w&&(w=-9.9));if(-.5>w){console.log("acceptable H-bond found");var x=l.ck(h),G;null!=x?G=x.getAttribute("eH"):G=0;w<G&&(this.v.Kg(l,h,!0).setAttribute("eH",w),null!=x&&(console.log("- Replaces: ",x.toString()," ",G," kcal/mol"),this.v.Xk(x)))}}}}console.log(hBonds.Qc().length+" H-bonds found")}console.timeEnd("\t\t\tCompute HBonds");console.time("\t\t\tSSE Assignment");e=this.ia.length;for(f=0;f<e;f++)this.ia[f].ob=null;f=1;for(l=4;f+l<e;f++)if(Ob(this,this.ia[f-1],this.ia[f-
1+l])&&Ob(this,this.ia[f],this.ia[f+l]))for(g=f;g<f+l;g++)this.ia[g].ob=E.u;for(f=1;f+1<e;f++)for(g=f+3;g+1<e;g++)if(l=this.ia[f],n=this.ia[g],null===l.ob&&null===n.ob)if(Ob(this,this.ia[f-1],n)&&Ob(this,n,this.ia[f+1])||Ob(this,this.ia[g-1],l)&&Ob(this,l,this.ia[g+1]))l.ob=E.aa,n.ob=E.aa;else if(Ob(this,l,n)&&Ob(this,n,l)||Ob(this,this.ia[f-1],this.ia[g+1])&&Ob(this,this.ia[g-1],this.ia[f+1]))l.ob=E.v,n.ob=E.v;f=1;for(l=3;f+l<e;f++)if(Ob(this,this.ia[f-1],this.ia[f-1+l])&&Ob(this,this.ia[f],this.ia[f+
l])){n=!0;for(g=f;g<f+l;g++)if(null!=this.ia[g]){n=!1;break}for(g=f;g<f+l;g++)this.ia[g].ob=n?E.u:E.da}f=1;for(l=5;f+l<e;f++)if(Ob(this,this.ia[f-1],this.ia[f-1+l])&&Ob(this,this.ia[f],this.ia[f+l])){n=!0;for(g=f;g<f+l;g++)if(null!=this.ia[g]){n=!1;break}for(g=f;g<f+l;g++)this.ia[g].ob=n?E.u:E.da}for(n=3;5>=n;n++)for(f=0;f+n<e;f++)if(Ob(this,this.ia[f],this.ia[f+n]))for(g=f+1;g<f+n;g++)l=this.ia[g].ob,null==l&&(this.ia[g].ob=E.da);for(f=0;f<e;f++)l=this.ia[f].ob,null==l&&(this.ia[f].ob=E.fa);console.timeEnd("\t\t\tSSE Assignment");
this.Ig=!0}};function Ob(e,f,g){f=e.v.findNode(f);return null==f?!1:f.kk(e.v.findNode(g))}z.Rd=function(e){void 0===e&&(e=!0);for(var f="",g=this.ia,h=0,k="\x00",l=this.td()?"X":this.ye()?"N":"-",n=g.length,r=0;r<n;r++){var q=g[r];if(e&&0!=r)for(h=q.sa()-h+q.lb().charCodeAt(0)-k.charCodeAt(0);1<h--;)f+=l;f+=q.Di();h=q.sa();k=q.lb()}return f};z.ye=function(){return"DNA"==this.type||"RNA"==this.type};z.td=function(){return"Protein"==this.type||"Peptide"==this.type||"Small Peptide"==this.type};
z.Qi=function(){return this.ye()||this.td()};z.Pi=function(){return"Ligand"===this.type};z.tj=function(e){var f=new fc,g=[];g.push(new gc(this.toString(),this.Rd(!1)));g.push(new gc("ExternalSequence",e));f=f.da(g);e=f.Rd("ExternalSequence");f=f.Rd(this.toString());console.log(e,f);this.fa=f;console.log(f.fa())};
function qc(e){var f=[],g=0,h=e.ia,k=0,l;for(l in h){var n=h[l];if(null===n.type)k++;else{var r=f[n.type];void 0===r&&(r=0,f[n.type]=r,g++);f[n.type]++}}if(0!==g){var g=Infinity,q;for(r in f)h=f[r],0!==h&&h<g?(g=h,q=r):h===g&&r<q&&(q=r);g>=k&&("Protein"==q?(f=e.size(),e.type=20>f?"Small Peptide":60>f?"Peptide":"Protein"):e.type=q)}}function rc(){this._id=this.da=this.cc=this.ea=this.ob=this.type=this.aa=null;this.Wb="\x00";this.u=[];this.ta=new fa;this.za=this.fa=this.v=null}
function sc(e,f){e.da=f.Ib;e._id=f.rb;e.Wb=f.Kb}z=rc.prototype;z.ec=function(){return this.ea.ec()};function Gb(e,f){e.ea=f;null!==f&&void 0!==f&&e.Zd(f.sa())}z.sa=function(){return this._id};z.bd=function(e){if(this._id!=e){console.log("Changing residue id from "+this._id+" to "+e);this._id=e;for(var f=0;f<this.u.length;f++)Ma(this.u[f],e)}};z.lb=function(){return this.Wb};z.Vc=function(){return this.cc};z.Je=function(e){if(this.cc!=e){this.cc=e;for(var f=this.u.length,g=0;g<f;g++)g.Je(e)}};
z.ue=function(){return this.da};z.Zd=function(e){if(this.da!=e){this.da=e;null!==this.ea&&this.ea.bd(e);for(var f=this.u.length,g=0;g<f;g++)g.Zd(e)}};z.add=function(e){null===e&&console.warn("atom = null in Residue");null!==e.mb()&&e.mb()!==this&&console.warn(e," already belongs to ",e.mb());if(null===e.mb()){this.u.push(e);var f=new xc(e.name,e.ld);this.ta.Dc(f)||this.ta.set(f,e);e.wa=this;null!==this&&(Ma(e,e.wa.sa()),$a(e,e.wa.lb()),e.Je(e.wa.Vc()),e.Zd(e.wa.ue()))}};
z.remove=function(e){null===e&&console.warn("atom = null in Residue");if(e.mb()===this){this.u.remove(e);var f=new this.xb(e.name,e.ld);this.ta.remove(f,e)}};z.xa=function(){return this.u};z.Zj=function(e){for(var f=0;f<this.u.length;f++){var g=this.u[f];if(g.sa()==e)return g}return null};z.hc=function(e){var f=void 0;void 0===f&&(f="\x00");e=this.ta.get(new xc(e,f));if(null!==e)return e};
z.Ka=function(){if(null==this.v){this.v=new THREE.Vector3;for(var e=this.u.length,f=0;f<e;f++){var g=this.u[f].pos;this.v.x+=g.x;this.v.y+=g.y;this.v.z+=g.z}this.v.x/=e;this.v.y/=e;this.v.z/=e}return this.v};
z.dh=function(){if(null==this.fa)for(var e=this.u.length,f=0;f<e;f++){var g=this.u[f];if("CA"===g.name){this.fa=g.pos.clone();break}}if(null==this.fa){for(var h=this.Ka(),k=this.u[0],l=h.distanceTo(k.pos),e=this.u.length,f=0;f<e;f++){var g=this.u[f],n=h.distanceTo(g.pos);n<l&&(k=g,l=n)}this.fa=k.clone()}return this.fa};
z.mc=function(){if(null===this.za){for(var e=new THREE.Vector3(Infinity,Infinity,Infinity),f=new THREE.Vector3(-Infinity,-Infinity,-Infinity),g=this.u.length,h=0;h<g;h++){var k=this.u[h];e.x=Math.min(e.x,k.pos.x);e.y=Math.min(e.y,k.pos.y);e.z=Math.min(e.z,k.pos.z);f.x=Math.max(f.x,k.pos.x);f.y=Math.max(f.y,k.pos.y);f.z=Math.max(f.z,k.pos.z)}this.za=new Va(e,f)}return this.za};z.ye=function(){return"DNA"==this.type||"RNA"==this.type};
z.td=function(){return"Protein"==this.type||"Peptide"==this.type||"Small Peptide"==this.type};
z.Di=function(){switch(null!==this.aa?this.aa:this.cc){case "GLY":return"G";case "ALA":return"A";case "VAL":return"V";case "LEU":return"L";case "ILE":return"I";case "PRO":return"P";case "PHE":return"F";case "MET":return"M";case "TRP":return"W";case "SER":return"S";case "THR":return"T";case "ASN":return"N";case "GLN":return"Q";case "ASP":return"D";case "GLU":return"E";case "CYS":return"C";case "TYR":return"Y";case "HIS":return"H";case "LYS":return"K";case "ARG":return"R";case "ASX":return"B";case "GLX":return"Z";
case "A":case "DA":case "+A":return"A";case "C":case "DC":case "+C":return"C";case "G":case "DG":case "+G":return"G";case "T":case "DT":case "+T":return"T";case "U":case "DU":case "+U":return"U";case "I":case "DI":case "+I":return"I"}return null!=this.ea.type&&"Protein"===this.ea.type?"X":null==this.ea.type||"RNA"!==this.ea.type&&"DNA"!==this.ea.type?"?":"N"};z.toString=function(){return this.cc+":"+this._id};z.vb=function(){return this.cc+":"+this._id+":"+this.da};
z.qd=function(){return this.ea.qd()+":"+this.toString()};function xc(e,f){this.name=e;this.ld=f}xc.prototype.toString=function(){return this.name+":"+this.ld};xc.prototype.vb=function(){return this.name+":"+this.ld};
function Ec(e,f){null===e.aa&&console.warn("Error : stdResName must be set before guessing residue type");if(-1!==Fc.indexOf(e.aa))e.type="DNA";else if(-1!==Gc.indexOf(e.aa))e.type="RNA";else if(-1!==Hc.indexOf(e.aa))e.type="Protein";else if(-1!==Ic.indexOf(e.Vc()))e.type="Solvent";else if(-1!==Oc.indexOf(e.Vc()))e.type=null;else{var g=f.get(e.sa());null!=g&&g.name.endsWith(" ION")&&(e.type="Ion");e.type="Ligand"}}
var Hc="GLY ALA VAL LEU ILE PRO PHE MET TRP SER THR ASN GLN ASP GLU CYS TYR HIS LYS ARG".split(" "),Gc=["A","C","G","U","I"],Fc="DA DC DG DT DI DU +A +C +G +T +I +U T".split(" "),Oc="UNK ASX GLX N DN UNL UNX".split(" "),Ic=["HOH","DOD","GOL","EDO"];
function Pc(e,f,g){null===e&&console.warn("chainId null in Residue.Id");this.Ib=e;this.rb=f;this.Kb=g;this.toString=function(){return"\x00"!==this.Kb.charCodeAt(0)?this.Ib+":"+this.rb+":"+this.Kb:this.Ib+":"+this.rb};this.vb=function(){return"\x00"!==this.Kb.charCodeAt(0)?this.Ib+":"+this.rb+":"+this.Kb:this.Ib+":"+this.rb}}function E(e,f){this.name=e;this.code=f}E.fa=new E("Coil"," ");E.da=new E("Turn","T");E.u=new E("Helix","H");E.aa=new E("Strand","x");E.v=new E("Strand","X");
E.prototype.toString=function(){return name};function Tc(){this.Ik=!0;this.ci=this._id=this.Gg=null;this.aa=[];this.Xh=[];this.$e=new fa;this.We=new fa;this.Id=new fa;this.uj=[];this.v=[];this.da=new fa;this.u=null}z=Tc.prototype;z.Ka=function(){if(null===this.u){this.u=new THREE.Vector3;for(var e=this.v[0].aa,f=0;f<e.length;f++){var g=e[f].Ka();this.u.x+=g.x;this.u.y+=g.y;this.u.z+=g.z}this.u.x/=e.length;this.u.y/=e.length;this.u.z/=e.length}return this.u};z.ec=function(){return this.v[0].ec()};
z.sa=function(){return this._id};z.bd=function(e){null==this._id&&(this.Gg=e);this._id=e};z.Kh=function(){};z.setDate=function(){};z.dj=function(e){this.ci=e};z.gl=function(){};z.fi=function(e,f){f=null==e?this.aa:this.aa[e];null===this.aa&&(console.warn("ref inexistante dans lPdbFormat, cr\u00e9ation"),this.aa[e]=f)};z.el=function(e){this.Xh=e};
z.add=function(e){null===e&&console.warn("Error on adding model to structure : model = NULL");null!=e.Ec()&&e.Ec()!=this&&console.warn("Error on adding model to structure");null==e.Ec()&&(this.v.push(e),e.Ke(this))};z.remove=function(e){null===e&&console.warn("Error on removing structure");e.Ec()==this&&(this.v.remove(e),e.Ke(null))};z.Qf=function(){return this.v[0]};z.toString=function(){return this._id};z.vb=function(){return this.toString()};z.qd=function(){return this.toString()};
z.Oj=function(e){this.$e.__proto__=fa.prototype;this.$e.Ve={}.hasOwnProperty;this.Id.__proto__=fa.prototype;this.Id.Ve={}.hasOwnProperty;this.We.__proto__=fa.prototype;this.We.Ve={}.hasOwnProperty;this.da.__proto__=fa.prototype;this.da.Ve={}.hasOwnProperty;for(var f=e.length,g=0;g<f;g++){var h=new ab;this.add(h);for(var k=e[g],l=k.length,n=0;n<l;n++){var r=new Ea;r.type=k[n][0];r.id=k[n][1];r.name=k[n][2];r.ld=k[n][3];r.Je(k[n][4]);r.Zd(k[n][5]);Ma(r,k[n][6]);$a(r,k[n][7]);r.pos.x=k[n][8];r.pos.y=
k[n][9];r.pos.z=k[n][10];r.fa=k[n][11];r.ta=k[n][12];r.symbol=k[n][13];r.da=k[n][14];h.add(r)}}console.time("Time for building the models");Uc(this)};
function Uc(e){var f=e.$e,g=e.We,h=e.Id,k=e.v,l=!1,n,r=k.length;for(n=0;n<r;n++){for(var q=k[n],t=[],x=q.xa(),w=x.length,C=0;C<w;C++){var F=x[C],G=void 0,I=void 0,D;for(D in t)if(I=t[D],I.sa()===F.v&&I.ue()===F.ue()&&I.lb().charCodeAt(0)===F.lb().charCodeAt(0)){G=I;break}if(void 0===G){I=new Pc(F.ue(),F.v,F.lb());G=new rc;sc(G,I);G.Je(F.Vc());var K=f.get(I);G.aa=K?K.Oh:G.Vc();Ec(G,g);K=h.get(I);null!=K?(l||(l=!0),G.ob=K):G.ob=E.fa;t[I]=G}G.add(F)}var I=void 0,H;for(H in t){G=x=t[H];for(w=[];void 0!==
G&&null!==G&&-1===w.indexOf(H)&&!G.td()&&!G.ye();)if(w.push(H),C=e.da.get(H),null!=C){var I=C.Ea.Ib===H.Ib&&C.Ea.rb===H.rb&&C.Ea.Kb===H.Kb?C.pc:C.Ea,L;for(D in t)G=t[D],I.Ib===G.Ib&&I.rb===G.rb&&I.Kb===G.Kb&&(L=G);G=t[L]}void 0!==G&&G.type!==x.type&&(x.type=G.type)}x=[];for(G in t){var w=t[G],C=w.ue(),F=w.type+" "+C,O=x[F];void 0===O&&(O=new vb(C),q.add(O),x[F]=O);O.add(w);O.Ig=l}for(O in x)q=x[O],q.ia.sort(function(e,f){return e.Dg<f.Dg?-1:e.Dg>f.Dg?1:e._id<f._id?-1:e._id>f._id?1:e.Wb<f.Wb?-1:e.Wb>
f.Wb?1:0}),qc(q)}};

function Vc(e,f){return aa[e]=f}ea.prototype.pd=Vc(2,function(){throw Error("Trying to call an abstract method");});fa.prototype.pd=Vc(1,function(e){for(var f in this.ja)if(this.ja[f]===e)return f});ja.prototype.pd=Vc(0,function(e){for(var f in this.ja)if(this.ja[f].value===e)return this.ja[f].key});function bd(e){var f=[],g;for(g in e.Ef)f.push(g);return f}var cd=cd||{};cd.Ub=cd.Ub||{};cd.Ub.yj=function(){return this.Df||this.Bf};
cd.Ub.vj=function(){if(this.Df)return document.webkitIsFullScreen;if(this.Bf)return document.mozFullScreen;console.assert(!1)};cd.Ub.request=function(e){e=e||document.body;this.Df?e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):this.Bf?e.mozRequestFullScreen():console.assert(!1)};cd.Ub.cancel=function(){this.Df?document.webkitCancelFullScreen():this.Bf?document.mozCancelFullScreen():console.assert(!1)};cd.Ub.Df="webkitCancelFullScreen"in document?!0:!1;
cd.Ub.Bf="mozCancelFullScreen"in document?!0:!1;
cd.Ub.zj=function(e){function f(){cd.Ub.vj()?(dd(l),null!=l.Mf?l.contextMenu.moveTo(l.Mf):l.contextMenu.moveTo(l.Ug),cd.Ub.cancel()):(dd(l),null!=l.Mf&&l.contextMenu.moveTo(l.Ug),cd.Ub.request(k))}e=e||{};var g=e.charCode||102,h=void 0!==e.dblclick?e.dblclick:!1,k=e.element,l=e.ca;document.addEventListener("keypress",function(e,f){return function(){return e.apply(f,arguments)}}(function(e){e.which===g&&f()},this),!1);h&&document.addEventListener("dblclick",f,!1)};cd=cd||{};
cd.ee=function(e,f,g,h){function k(){var k=null,q=null;null==f?(k=window.v,q=window.u):(k=f.width(),q=f.height());if(l!==k||n!==q)l=k,n=q,e.setSize(l,n),null!=g&&(g instanceof THREE.PerspectiveCamera?(g.aspect=l/n,g.fov=ed(h,g),g.updateProjectionMatrix()):g instanceof THREE.OrthographicCamera?(g.left=-l/2,g.right=l/2,g.top=n/2,g.bottom=-n/2,g.updateProjectionMatrix()):console.warn("Unknown camera type"))}var l,n;window.addEventListener("resize",k,!1);return{stop:function(){window.removeEventListener("resize",
k)}}};cd.ee.bind=function(e,f,g,h){return cd.ee(e,f,g,h)};cd=cd||{};
cd.Il=function(){var e=document.createElement("div");e.style.cssText="width:80px;opacity:0.9;cursor:pointer";var f=document.createElement("div");f.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#200;";e.appendChild(f);var g=document.createElement("div");g.style.cssText="color:#f00;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";g.innerHTML="WebGLRenderer";f.appendChild(g);for(var h=[],g=0;9>g;g++)h[g]=document.createElement("div"),h[g].style.cssText=
"color:#f00;background-color:#311;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",f.appendChild(h[g]),h[g].innerHTML="-";var k=Date.now();return{domElement:e,update:function(e){console.assert(e instanceof THREE.WebGLRenderer);if(!(Date.now()-k<1E3/30)){k=Date.now();var f=0;h[f++].textContent="== Memory =====";h[f++].textContent="Programs: "+e.info.memory.programs;h[f++].textContent="Geometries: "+e.info.memory.geometries;h[f++].textContent="Textures: "+e.info.memory.textures;
h[f++].textContent="== Render =====";h[f++].textContent="Calls: "+e.info.render.calls;h[f++].textContent="Vertices: "+e.info.render.vertices;h[f++].textContent="Faces: "+e.info.render.faces;h[f++].textContent="Points: "+e.info.render.points}}}};function fd(){Element.call(this);this.Mi=!0;this.lc=this.xc=null;this.zf=!1}fd.prototype=Object.create(Element.prototype);fd.prototype.constructor=fd;fd.prototype.Wc=function(){return this.lc};
function gd(e,f){if(e.xc===f)return e.lc;if(e.lc===f)return e.xc;console.warn(e.xc,NaN+e.lc+":"+f);console.warn("Node "+f+" is not part of edge "+e.sa())}fd.prototype.toString=function(){var e;e=""+this.xc;e=this.zf?e+"->":e+"--";return e+=this.lc};function Element(){this.Fd=this._id=null;this.Bg=[]}Element.prototype.sa=function(){return this._id};Element.prototype.getAttributes=function(){return this.Bg};Element.prototype.getAttribute=function(e){return this.Bg[e]};
Element.prototype.setAttribute=function(e,f){this.Bg[e]=f};function ib(){this.aa=this.da=0;this.le=new fa;this.u=new fa;this.v=new fa;this.fd=new fa}z=ib.prototype;z.clear=function(){this.le.clear();this.u.clear();this.v.clear();this.fd.clear()};z.Ej=function(){this.u.clear();this.fd.clear()};
z.Lg=function(e,f){void 0===f&&(f=null);var g=new Node,h=f;void 0!==e&&(g._id=e);void 0!==this&&(g.Fd=this);void 0!==h&&null!==h&&(g.Dd=h);null==g&&console.warn("Error : node undefined or null in Graph");g.Fd!==this&&console.warn("Error : node with id ",g," must belong to this in graph");h=this.le.get(g.sa());null!=h&&h!==g?console.warn("Error : node with id ",g.sa()," already exists in graph"):(this.le.set(g.sa(),g),this.v.Dc(g.Dd)||this.v.set(g.Dd,g));return g};
z.Ff=function(e){var f;do f=this.da++;while(null!=this.le.get(f));return this.Lg(f,e)};z.values=function(){for(var e=[],f=this.le.values(),g=f.length,h=0;h<g;h++)e.push(f[h].Dd);return e};z.findNode=function(e){return this.v.get(e)};
z.Kg=function(e,f,g){!0!==g&&(g=!1);var h;do h=this.aa++;while(null!=this.u.get(h));var k=g;!0!==k&&(k=!1);g=new fd;void 0!==h&&(g._id=h);void 0!==this&&(g.Fd=this);this===e.Fd&&this===f.Fd||console.warn("Error : nodes ",g.xc,", ",g.lc," and edge ",h," must all be part of same graph ",this);g.xc=e;g.lc=f;!0!==k&&(k=!1);g.zf=k;null===g&&console.warn("Error : edge is null in GRAPH");g.Fd!==this&&console.warn("Error : edge with id ",g," must belong to this in graph");e=this.u.get(g.sa());if(null!=e&&
e!==g)console.warn("Error : edge with id ",g.sa()," already exists in graph");else{this.u.set(g.sa(),g);e=[];e=e.concat(g.xc);e=e.concat(g.lc);for(var l in e)f=this.fd.get(e[l]),null===f&&(f=[],this.fd.set(e[l],f)),f.push(g)}return g};z.Xk=function(e){!0!==e.Mi&&(e=this.u.get(e));var f=e;if(f.Mi?null!==f&&this.u.get(f.sa())===f:null==this.u.get(f))this.u.remove(e.sa()),f=this.fd.get(e.xc),null!==f&&delete f[e],f=this.fd.get(e.lc),null!==f&&delete f[e]};
z.Qc=function(){for(var e=[],f=this.u.values(),g=f.length,h=0;h<g;h++)e.push(f[h]);return e};function Node(){Element.call(this);this.Dd=null}Node.prototype=Object.create(Element.prototype);z=Node.prototype;z.constructor=Node;z.Qc=function(){return this.Fd.fd.get(this)};z.Ei=function(e){a:{var f=this.Qc();if(f)for(var g=f.length,h=0;h<g;h++)if(gd(f[h],this)===e){e=h;break a}e=void 0}return void 0!==e};
z.kk=function(e){a:{var f=this.Qc();if(f)for(var g=f.length,h=0;h<g;h++){var k=f[h];if(k.zf&&k.xc===e&&k.Wc()===this){e=k;break a}}e=void 0}return void 0!==e};z.toString=function(){return this.sa()};z.vb=function(){return this.sa()};z.ck=function(e){var f=this.Qc();if(f)for(var g=f.length,h=0;h<g;h++){var k=f[h];if(k.zf&&k.xc==this&&k.Wc()==e)return k}};
function Va(e,f){this.u=Array(8);this.u[0]=new THREE.Vector3(e.x,e.y,e.z);this.u[1]=new THREE.Vector3(f.x,e.y,e.z);this.u[2]=new THREE.Vector3(e.x,f.y,e.z);this.u[3]=new THREE.Vector3(e.x,e.y,f.z);this.u[4]=new THREE.Vector3(f.x,f.y,e.z);this.u[5]=new THREE.Vector3(f.x,e.y,f.z);this.u[6]=new THREE.Vector3(e.x,f.y,f.z);this.u[7]=new THREE.Vector3(f.x,f.y,f.z)}z=Va.prototype;z.applyMatrix4=function(e){for(var f=this.u.length,g=0;g<f;g++)this.u[g].applyMatrix4(e);return this};
z.we=function(){for(var e=this.u[0].clone(),f=this.u.length,g=1;g<f;g++)e.min(this.u[g].clone());return e};z.ve=function(){for(var e=this.u[0].clone(),f=this.u.length,g=1;g<f;g++)e.max(this.u[g].clone());return e};function jd(e){var f=e.we();e=e.ve();return f.add(e).multiplyScalar(.5)}z.length=function(){return kd(this).length()};function kd(e){var f=e.we();return e.ve().sub(f)}z.merge=function(e){var f=this.we(),g=this.ve();f.min(e.we());g.max(e.ve());return new Va(f,g)};
z.clone=function(){return new Va(this.we(),this.ve())};function ld(e){this.u=new fa;for(var f=e.length,g=0;g<f;g++){var h=e[g];this.u.set(h.getName(),h)}}ld.prototype.Rd=function(e){return this.u.get(e)};function gc(e,f){this.da=e;this.u=f;this.v=this.aa=null}function md(e,f){e.u=f;e.aa=null;e.v=null}gc.prototype.getName=function(){return this.da};function nd(e,f){if(null!==e.u&&(null===e.v&&od(e),null!==e.v))return e.v[f];throw Error("Can't find index ",f," in sequence");}
gc.prototype.fa=function(){if(null!==this.u&&(null===this.aa&&od(this),null!==this.aa))return this.aa[0];throw Error("Can't find index ",0," in sequence");};function od(e){if(null!==e.u){var f=e.u.length;e.aa=Array(f);var g=0;e.v=Array(f);for(var h=0;h<f;h++){var k=e.u.charAt(h);"A"<=k&&"Z">=k||"a"<=k&&"z">=k?(e.aa[g]=h,e.v[h]=g,g++):e.v[h]=-1}e.aa=e.aa.slice(0,g)}else e.v=null}function fc(e){e?this.v=e:this.v=pd;this.u=null;this.fa=this.ta=NaN}
var rd=new qd("ABCDEFGHIKLMNPQRSTVWXYZ",[[24,0,5,-3,0,-23,5,-8,-8,-4,-12,-7,-3,3,-2,-6,11,6,1,-36,0,-22,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[5,0,115,-32,-30,-8,-20,-13,-11,-28,-15,-9,-18,-31,-24,-22,1,-5,0,-10,0,-5,0],[-3,0,-32,47,27,-45,1,4,-38,5,-40,-30,22,-7,9,-3,5,0,-29,-52,0,-28,0],[0,0,-30,27,36,-39,-8,4,-27,12,-28,-20,9,-5,17,4,2,-1,-19,-43,0,-27,0],[-23,0,-8,-45,-39,70,-52,-1,10,-33,20,16,-31,-38,-26,-32,-28,-22,1,36,0,51,0],[5,0,-20,1,-8,-52,66,-14,-45,-11,-44,-35,4,-16,-10,
-10,4,-11,-33,-40,0,-40,0],[-8,0,-13,4,4,-1,-14,60,-22,6,-19,-13,12,-11,12,6,-2,-3,-20,-8,0,22,0],[-8,0,-11,-38,-27,10,-45,-22,40,-21,28,25,-28,-26,-19,-24,-18,-6,31,-18,0,-7,0],[-4,0,-28,5,12,-33,-11,6,-21,32,-21,-14,8,-6,15,27,1,1,-17,-35,0,-21,0],[-12,0,-15,-40,-28,20,-44,-19,28,-21,40,28,-30,-23,-16,-22,-21,-13,18,-7,0,0,0],[-7,0,-9,-30,-20,16,-35,-13,25,-14,28,43,-22,-24,-10,-17,-14,-6,16,-10,0,-2,0],[-3,0,-18,22,9,-31,4,12,-28,8,-30,-22,38,-9,7,3,9,5,-22,-36,0,-14,0],[3,0,-31,-7,-5,-38,-16,
-11,-26,-6,-23,-24,-9,76,-2,-9,4,1,-18,-50,0,-31,0],[-2,0,-24,9,17,-26,-10,12,-19,15,-16,-10,7,-2,27,15,2,0,-15,-27,0,-17,0],[-6,0,-22,-3,4,-32,-10,6,-24,27,-22,-17,3,-9,15,47,-2,-2,-20,-16,0,-18,0],[11,0,1,5,2,-28,4,-2,-18,1,-21,-14,9,4,2,-2,22,15,-10,-33,0,-19,0],[6,0,-5,0,-1,-22,-11,-3,-6,1,-13,-6,5,1,0,-2,15,25,0,-35,0,-19,0],[1,0,0,-29,-19,1,-33,-20,31,-17,18,16,-22,-18,-15,-20,-10,0,34,-26,0,-11,0],[-36,0,-10,-52,-43,36,-40,-8,-18,-35,-7,-10,-36,-50,-27,-16,-33,-35,-26,142,0,41,0],[0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-22,0,-5,-28,-27,51,-40,22,-7,-21,0,-2,-14,-31,-17,-18,-19,-19,-11,41,0,78,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),zd=new qd("ARNBDCQZEGHILKMFPSTWYVX*",[[1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,
-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,
-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,
-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,
-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,
-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1,-1E4,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,0,-1E4],[-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,
-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,0]]),pd=rd;
fc.prototype.da=function(e){if(0===e.length)return new ld;for(var f=e.length,g=0;g<f;g++){var h=e[g];md(h,h.u.toUpperCase())}if(2===e.length){var f=e[0].u,g=e[1].u,k=this.v.clone(),h=0;this.v===pd?h=10:this.v===zd&&(h=100);for(var l=h,n=k.gb.length,r=0;r<n;r++)for(var q=k.gb[r].length,t=0;t<q;t++)k.gb[r][t]*=l;k=this.u=k;l=k.gb.length-1;n=0;r=k.gb.length;for(q=0;q<r;q++)for(t=0;t<=q;t++)q!==t&&(n+=k.gb[q][t]);this.ta=0>=-(n/((l*l-l)/2))?2*(10+Math.log(Math.min(f.length,g.length)))*h:2*(10+Math.log(Math.min(f.length,
g.length)));this.fa=.1*h;var h=f.length,k=g.length,x=this.aa(2,k),l=this.aa(h,k),w=[k];w.fill(0);for(var C=Number.MIN_VALUE,r=n=-1,q=0;q<h;q++){for(t=0;t<k;t++)if(0===q||0===t)x[1][t]=this.u.getValue(f.charAt(q),g.charAt(t)),0===q&&0!==t&&(x[1][t]-=Ad(this,q,h,2===w[t-1]),w[t]=2),0===t&&0!==q&&(x[1][t]-=Ad(this,t,k,1===w[t]),w[t]=1),l[q][t]=0;else{var F=x[0][t-1]+this.u.getValue(f.charAt(q),g.charAt(t)),G=x[1][t-1]-Ad(this,q,h,2===w[t-1]),I=x[0][t]-Ad(this,t,k,1===w[t]);x[1][t]=Math.max(Math.max(F,
G),I);if(x[1][t]===F)l[q][t]=1,w[t]=0;else if(x[1][t]===G)l[q][t]=3,w[t]=2;else if(x[1][t]===I)l[q][t]=2,w[t]=1;else throw"Error when filling traceback matrix";(q===h-1||t===k-1)&&x[1][t]>C&&(C=x[1][t],n=q,r=t)}t=x[0];x[0]=x[1];x[1]=t}w=x="";q=h-1;for(t=k-1;q>n&&0<=q;)x+=f.charAt(q),w+="-",q--;for(;t>r&&0<=t;)x+="-",w+=g.charAt(t),t--;for(;0<=q&&0<=t;)0<q&&3===l[q][t]?(x+="-",w+=g.charAt(t),t--):0<t&&2===l[q][t]?(x+=f.charAt(q),w+="-",q--):(x+=f.charAt(q),w+=g.charAt(t),q--,t--);for(;0<=q;)x+=f.charAt(q),
w+="-",q--;for(;0<=t;)x+="-",w+=g.charAt(t),t--;f=[x.split("").reverse().join(""),w.split("").reverse().join("")];md(e[0],f[0]);md(e[1],f[1]);e=new ld(e)}else throw"Alignment must be computed with only 2 sequences, for advanced alignement, use Bioviz Java";return e};fc.prototype.aa=function(e){var f=Array(e||0),g=e;if(1<arguments.length)for(var h=Array.prototype.slice.call(arguments,1);g--;)f[e-1-g]=this.aa.apply(this,h);return f};function Ad(e,f,g,h){return 0===f||f===g-1?0:h?e.fa:e.ta}
function qd(e,f){this.v=e;this.u=new fa;this.gb=f}qd.prototype.setValue=function(e){this.gb=e.slice(0)};qd.prototype.getValue=function(e,f){return this.u.Dc(e)&&this.u.Dc(f)?this.gb[this.u.get(e)][this.u.get(f)]:0};qd.prototype.clone=function(){var e=new qd;e.setValue(this.gb);var f=this.v;e.v=f;for(var g=f.length,h=0;h<g;h++)e.u.set(f[h],h);return e};function Bd(){this.aa=this.v=null;this.u=NaN}
function Cd(e,f){for(var g=[],h=e.ia.slice(0),k=f.u,l=e.Ka(),n=e.td()?"CA":"C4'",r=k.length,q=0;q<r;q++)if("-"!=k.charAt(q)){var t=h[nd(f,q)].hc(n);if(null!==t){var x=new THREE.Vector3;x.subVectors(t.pos,l);g.push(x)}else g.push(null)}else g.push(null);return g}function Dd(e,f){return new gc((null!==e?e:"")+f.toString(),f.Rd(!1))}function wb(e,f,g){this.fb=e;this.eb=f;this.Ma=new THREE.Vector3((e.x+f.x)/2,(e.y+f.y)/2,(e.z+f.z)/2);this.va=[];this.wc=g;void 0===g&&(this.wc=32);this.gb=[]}z=wb.prototype;
z.add=function(e){if(e.Fk){var f=e.getPoint().pos;Ed(this,f)||console.warn("Error : "+f+" can't fit into [ "+this.fb+" , "+this.eb+" ]");if(0===this.va.length){if(this.gb.push(e),this.gb.length>this.wc){0!==this.va.length&&console.warn("Error : This octant was already split ");this.va.push(new wb(new THREE.Vector3(this.fb.x,this.fb.y,this.fb.z),new THREE.Vector3(this.Ma.x,this.Ma.y,this.Ma.z),this.wc));this.va.push(new wb(new THREE.Vector3(this.Ma.x,this.fb.y,this.fb.z),new THREE.Vector3(this.eb.x,
this.Ma.y,this.Ma.z),this.wc));this.va.push(new wb(new THREE.Vector3(this.fb.x,this.Ma.y,this.fb.z),new THREE.Vector3(this.Ma.x,this.eb.y,this.Ma.z),this.wc));this.va.push(new wb(new THREE.Vector3(this.Ma.x,this.Ma.y,this.fb.z),new THREE.Vector3(this.eb.x,this.eb.y,this.Ma.z),this.wc));this.va.push(new wb(new THREE.Vector3(this.fb.x,this.fb.y,this.Ma.z),new THREE.Vector3(this.Ma.x,this.Ma.y,this.eb.z),this.wc));this.va.push(new wb(new THREE.Vector3(this.Ma.x,this.fb.y,this.Ma.z),new THREE.Vector3(this.eb.x,
this.Ma.y,this.eb.z),this.wc));this.va.push(new wb(new THREE.Vector3(this.fb.x,this.Ma.y,this.Ma.z),new THREE.Vector3(this.Ma.x,this.eb.y,this.eb.z),this.wc));this.va.push(new wb(new THREE.Vector3(this.Ma.x,this.Ma.y,this.Ma.z),new THREE.Vector3(this.eb.x,this.eb.y,this.eb.z),this.wc));for(var g in this.gb){e=this.gb[g];var h=e.getPoint().pos,k;for(k in this.va)Ed(this.va[k],h)&&this.va[k].add(e)}}}else for(h in this.va)if(Ed(this.va[h],f)){this.va[h].add(e);break}}else if(0<e.length)for(f in e)this.add(e[f])};
z.optimize=function(){if(0<this.va.length){var e=0,f;for(f in this.va){var g=this.va[f];g.optimize();g.isEmpty()&&g.va===[]&&(this.va[f]=null,e++)}if(0!==e)if(e===this.va.length)this.va=[];else for(f in e=$.extend(!0,{},this.va),this.va=[],e)g=e[f],null!==g&&void 0!==g&&this.va.push(g)}};z.isEmpty=function(){return 0===this.gb.length};function Ed(e,f){return f.x>=e.fb.x&&f.y>=e.fb.y&&f.z>=e.fb.z&&f.x<=e.eb.x&&f.y<=e.eb.y&&f.z<=e.eb.z}
z.ah=function(e,f){var g;if(g=!Ed(this,e)){g=this.fb;var h=this.eb,k=f*f;e.x<g.x?k-=(e.x-g.x)*(e.x-g.x):e.x>h.x&&(k-=(e.x-h.x)*(e.x-h.x));e.y<g.y?k-=(e.y-g.y)*(e.y-g.y):e.y>h.y&&(k-=(e.y-h.y)*(e.y-h.y));e.z<g.z?k-=(e.z-g.z)*(e.z-g.z):e.z>h.z&&(k-=(e.z-h.z)*(e.z-h.z));g=!(0<k)}if(g)return[];g=[];if(0!==this.va.length)for(var l in this.va)g=g.concat(this.va[l].ah(e,f));else for(var n in this.gb)this.gb[n].getPoint().distanceTo(e)<=f&&g.push(this.gb[n]);return g};
z.trace=function(){var e=0;void 0===e&&(e=0);for(var f=0;f<e;f++)console.log(f==e-1?"\u2514-":"  ");console.log(this.toString()+": "+this.gb.length);if(null!==this.va){e++;for(var g in this.va)this.va[g].trace(e)}};z.toString=function(){return"[("+this.fb.x+","+this.fb.y+","+this.fb.z+"),("+this.eb.x+","+this.eb.y+","+this.eb.z+")]"};function xb(e){this.Fk=!0;this.bi=e}xb.prototype.getPoint=function(){return this.bi};xb.prototype.toString=function(){return this.bi.toString()};
function Fd(e,f,g,h){this.pa=null;this.vd=f;this.hj=e;this.wl=g;this.Ek=null!=h?h:!1;this.og=new Worker("webworker.js");this.blob=null}
Fd.prototype.load=function(){var e=this;console.time("time for loading parsing on the webworker");console.log("Loading URL : "+this.hj);return new Promise(function(f,g){e.og.onmessage=function(h){h.hi=e.wl;h.data instanceof Blob?e.blob=h.data:(h=JSON.parse(h.data),h.Ik?(h.__proto__=Tc.prototype,e.pa=h,e.pa.blob=e.blob):"error"===h.type?g(Error(h.msg)):(e.pa.Oj(h),e.og.terminate(),f(e.pa)))};e.og.postMessage([e.hj,e.vd,e.Ek])})};
var Gd={atom:"#F5A99580",residue:"#CCFF00",molecule:"#FF66CC"},Hd={A:"#2424DC",B:"#AABDC0",C:"#00C500",D:"#5A00C1",E:"#96640A",F:"#F5A995",G:"#2EF7F0",H:"#C1C1BC",I:"#E8A432",J:"#0AFA0A",K:"#49C8C8",L:"#C8C80A",M:"#64C864",N:"#CB70BB",O:"#960096",P:"#531966",Q:"#173232",R:"#AA4664",S:"#7B7B7B",T:"#189A8F",U:"#F57B15",V:"#EA22EA",W:"#82B4BE",X:"#828282",Y:"#505050",Z:"#323232",0:"#7B7B7B",1:"#189A8F",2:"#F57B15",3:"#EA22EA",4:"#82B4BE",5:"#828282",6:"#505050",7:"#323232",8:"#A050FA",9:"#1EEA20"},Id=
{A:"#FF3232",T:"#0A32FF",C:"#FFFF32",G:"#0AFF0A",U:"#FF32FF",DA:"#FF3232",DT:"#0A32FF",DC:"#FFFF32",DG:"#0AFF0A",DU:"#FF32FF"},Jd={SER:"#DAD0CC",LEU:"#008CB1",GLY:"#D6E9E5",ALA:"#69A0AC",LYS:"#DD524A",VAL:"#799CB4",THR:"#D0C2B0",ASP:"#82C56B",GLU:"#4EC4A4",PRO:"#315E87",ASN:"#E5E3DA",ARG:"#A73638",PHE:"#315E87",ILE:"#61818A",GLN:"#CFD0CD",TYR:"#72896E",CYS:"#72896E",HIS:"#6C6C67",MET:"#C8DBE8",TRP:"#356B84"},Kd={H:"#FFFFFF",He:"#FADEC5",Li:"#7F3C3D",Be:"#000000",B:"#229262",C:"#AFAFAF",N:"#385E96",
O:"#B83839",F:"#FB9B27",Ne:"#000000",Na:"#38608E",Mg:"#72896E",Al:"#82C56B",Si:"#000000",P:"#FB9B27",S:"#F7B848",Cl:"#28FE28",Ar:"#000000",K:"#FADEC5",Ca:"#6C6C67",Sc:"#6C6C67",Ti:"#72896E",V:"#000000",Cr:"#6C6C67",Mn:"#6C6C67",Fe:"#FB9B27",Co:"#AAB844",Ni:"#6B5248",Cu:"#6B5248",Zn:"#6B5248"},Ld={Hydrophobic:"#FF0000",Hydrophilic:"#0000FF"},Md={"First residue":"#00FF00","Last residue":"#0000FF"},Nd={Coil:"#B4B4B4",Turn:"#FFB419",Helix:"#FF1919",Strand:"#1919FF"},Od={AA_AROMATIC:"#CDCD4B",AA_CHARGED_NEG:"#FF1919",
AA_CHARGED_PLUS:"#1919FF",AA_CYSTEINE:"#FF7D0F",AA_GLYCINE:"#9696FF",AA_HYDROPHOB:"#AFAFAF",AA_POLAR_NEG:"#9B3737",AA_POLAR_PLUS:"#37379B",AA_PROLINE:"#FF9B9B",AccessibleSurface:"#C8641E",ALL_ATOMS:"#000000",ALL_RESIDUES:"#000000",ALL_SSE:"#000000",AlphaShapeSurface:"#C8641E",Antiparallel_Strand:"#1919FF",APOLAIRE:"#CFD0CD",ATOM_CARBON_CHAIN:"#AFAFAF",ATOM_CARBON_CYCLE:"#AFAF4B",ATOM_CHARGED_NEG:"#1919FF",ATOM_CHARGED_PLUS:"#1919FF",ATOM_POLAR_NEG:"#9B1919",ATOM_POLAR_PLUS:"#19199B",ATOM_S:"#FFFFFF",
AXIS:"#FFFFFF",BACKBONE:"#A0B4FA",Background:"#000000",BOND:"#1EEA2066",CHARGE_NEG:"#0000FF99",CHARGE_NEUTRAL:"#FFFFFF99",CHARGE_POS:"#FF000099",Coil:"#B4B4B4",CORE:"#FF6464",C_TERM:"#A73638",DELTA_NEG:"#0000B499",DELTA_POS:"#B4000099",FIX:"#315E87",FLEXIBLE:"#C8DBE8",HELIX_2:"#32B432",Helix:"#FF1919",HYDROGEN_BOND:"#FFFFFF33",INTERFACE:"#FFFFFF",MolecularSurface:"#C8641E",N_TERM:"#315E87",Parallel_Strand:"#1919FF",PCORE:"#3C321E",PE:"#F7B848B3",PLANE:"#FFFFFF1A",POLAIRE_F_AB_ANIONIQUE:"#38608E",
POLAIRE_F_AB_CATIONIQUE:"#A73638",POLAIRE_F_AB_NEUTRE:"#F6F7F0",POLAIRE_SANS_F_AB:"#F9B58F",PSURFACE:"#141496",RIM:"#1428FF",SELECTION:"#FDB45D",SSE_B:"#6A68E6",SSE:"#FB9B27",SSE_HA:"#DC5456",SSE_T:"#FAFAFA",STABLE:"#385E96",SURFACE:"#FF0000",Turn:"#FFB419",UNSTABLE:"#BA3938",VDW:"#008CB1E1",Void_mo:"#9BFAB4",Void_pi:"#BEFF64",Void_po:"#C8C8C8",Void_pp:"#787878",Void_pr:"#6464FF"},Ua={Ac:"Actinium 7Act 20 f 89 [227] 2.15 2".split(" "),Al:"Aluminium 3 13 p 13 26.982 1.21 2".split(" "),Am:"Americium 7Act 20 f 95 [243] 1.8 2".split(" "),
Sb:"Antimony 5 15 p 51 121.76 1.39 2".split(" "),Ar:"Argon 3 18 p 18 39.948 1.51 1.88".split(" "),As:"Arsenic 4 15 p 33 74.922 1.21 1.85".split(" "),At:"Astatine 6 17 p 85 [210] 1.21 2".split(" "),Ba:"Barium 6 2 s 56 137.327 2.15 2".split(" "),Bk:"Berkelium 7Act 20 f 97 [247] 1.54 2".split(" "),Be:"Beryllium 2 2 s 4 9.012 0.96 2".split(" "),Bi:"Bismuth 6 15 p 83 208.98 1.48 2".split(" "),Bh:"Bohrium 7 7 d 107 [264] 1.5 2".split(" "),B:"Boron 2 13 p 5 10.811 0.83 2".split(" "),Br:"Bromine 4 17 p 35 79.904 1.21 1.85".split(" "),
Cd:"Cadmium 5 12 d 48 112.411 1.54 1.58".split(" "),Cs:"Caesium 6 1 s 55 132.905 2.44 2".split(" "),Ca:"Calcium 4 2 s 20 40.078 1.76 2".split(" "),Cf:"Californium 7Act 20 f 98 [251] 1.83 2".split(" "),C:"Carbon 2 14 p 6 12.011 0.68 1.7".split(" "),Ce:"Cerium 6Lan 19 f 58 140.116 2.04 2".split(" "),Cl:"Chlorine 3 17 p 17 35.453 0.99 1.75".split(" "),Cr:"Chromium 4 6 d 24 51.996 1.39 2".split(" "),Co:"Cobalt 4 9 d 27 58.933 1.26 2".split(" "),Cu:"Copper 4 11 d 29 63.546 1.32 1.4".split(" "),Cm:"Curium 7Act 20 f 96 [247] 1.69 2".split(" "),
Ds:"Darmstadtium 7 10 d 110 [271] 1.5 2".split(" "),Db:"Dubnium 7 5 d 105 [262] 1.5 2".split(" "),Dy:"Dysprosium 6Lan 19 f 66 162.5 1.92 2".split(" "),Es:"Einsteinium 7Act 20 f 99 [252] 1.5 2".split(" "),Er:"Erbium 6Lan 19 f 68 167.26 1.89 2".split(" "),Eu:"Europium 6Lan 19 f 63 151.964 1.98 2".split(" "),Fm:"Fermium 7Act 20 f 100 [257] 1.5 2".split(" "),F:"Fluorine 2 17 p 9 18.998 0.64 1.47".split(" "),Fr:"Francium 7 1 s 87 [223] 2.6 2".split(" "),Gd:"Gadolinium 6Lan 19 f 64 157.25 1.96 2".split(" "),
Ga:"Gallium 4 13 p 31 69.723 1.22 1.87".split(" "),Ge:"Germanium 4 14 p 32 72.61 1.17 2".split(" "),Au:"Gold 6 11 d 79 196.967 1.36 1.66".split(" "),Hf:"Hafnium 6 4 d 72 178.49 1.75 2".split(" "),Hs:"Hassium 7 8 d 108 [269] 1.5 2".split(" "),He:"Helium 1 18 p 2 4.003 1.5 1.4".split(" "),Ho:"Holmium 6Lan 19 f 67 164.93 1.92 2".split(" "),H:"Hydrogen 1 1 s 1 1.008 0.23 1.09".split(" "),In:"Indium 5 13 p 49 114.818 1.42 1.93".split(" "),I:"Iodine 5 17 p 53 126.904 1.4 1.98".split(" "),Ir:"Iridium 6 9 d 77 192.217 1.41 2".split(" "),
Fe:"Iron 4 8 d 26 55.845 1.52 2".split(" "),Kr:"Krypton 4 18 p 36 83.8 1.5 2.02".split(" "),La:"Lanthanum 6Lan 19 f 57 138.906 2.07 2".split(" "),"Lr (Lw)":"Lawrencium 7 3 d 103 [262] 1.5 2".split(" "),Pb:"Lead 6 14 p 82 207.2 1.46 2.02".split(" "),Li:"Lithium 2 1 s 3 6.941 1.28 1.82".split(" "),Lu:"Lutetium 6 3 d 71 174.967 1.87 2".split(" "),Mg:"Magnesium 3 2 s 12 24.305 1.41 1.73".split(" "),Mn:"Manganese 4 7 d 25 54.938 1.61 2".split(" "),Mt:"Meitnerium 7 9 d 109 [268] 1.5 2".split(" "),Md:"Mendelevium 7Act 20 f 101 [258] 1.5 2".split(" "),
Hg:"Mercury 6 12 d 80 200.59 1.32 1.55".split(" "),Mo:"Molybdenum 5 6 d 42 95.94 1.54 2".split(" "),Nd:"Neodymium 6Lan 19 f 60 144.24 2.01 2".split(" "),Ne:"Neon 2 18 p 10 20.18 1.5 1.54".split(" "),Np:"Neptunium 7Act 20 f 93 [237] 1.9 2".split(" "),Ni:"Nickel 4 10 d 28 58.693 1.24 1.63".split(" "),Nb:"Niobium 5 5 d 41 92.906 1.64 2".split(" "),N:"Nitrogen 2 15 p 7 14.007 0.68 1.55".split(" "),No:"Nobelium 7Act 20 f 102 [259] 1.5 2".split(" "),Os:"Osmium 6 8 d 76 190.23 1.44 2".split(" "),O:"Oxygen 2 16 p 8 15.999 0.68 1.52".split(" "),
Pd:"Palladium 5 10 d 46 106.42 1.39 1.63".split(" "),P:"Phosphorus 3 15 p 15 30.974 1.05 1.8".split(" "),Pt:"Platinum 6 10 d 78 195.078 1.36 1.72".split(" "),Pu:"Plutonium 7Act 20 f 94 [244] 1.87 2".split(" "),Po:"Polonium 6 16 p 84 [210] 1.4 2".split(" "),K:"Potassium 4 1 s 19 39.098 2.03 2.75".split(" "),Pr:"Praseodymium 6Lan 19 f 59 140.908 2.03 2".split(" "),Pm:"Promethium 6Lan 19 f 61 [145] 1.99 2".split(" "),Pa:"Protactinium 7Act 20 f 91 231.036 2 2".split(" "),Ra:"Radium 7 2 s 88 [226] 2.21 2".split(" "),
Rn:"Radon 6 18 p 86 [222] 1.5 2".split(" "),Re:"Rhenium 6 7 d 75 186.207 1.51 2".split(" "),Rh:"Rhodium 5 9 d 45 102.906 1.42 2".split(" "),Rb:"Rubidium 5 1 s 37 85.468 2.2 2".split(" "),Ru:"Ruthenium 5 8 d 44 101.07 1.46 2".split(" "),Rf:"Rutherfordium 7 4 d 104 [261] 1.5 2".split(" "),Sm:"Samarium 6Lan 19 f 62 150.36 1.98 2".split(" "),Sc:"Scandium 4 3 d 21 44.956 1.7 2".split(" "),Sg:"Seaborgium 7 6 d 106 [266] 1.5 2".split(" "),Se:"Selenium 4 16 p 34 78.96 1.22 1.9".split(" "),Si:"Silicon 3 14 p 14 28.086 1.2 2.1".split(" "),
Ag:"Silver 5 11 d 47 107.868 1.45 1.72".split(" "),Na:"Sodium 3 1 s 11 22.991 1.66 2.27".split(" "),Sr:"Strontium 5 2 s 38 87.62 1.95 2".split(" "),S:"Sulphur 3 16 p 16 32.066 1.02 1.8".split(" "),Ta:"Tantalum 6 5 d 73 180.948 1.7 2".split(" "),Tc:"Technetium 5 7 d 43 [98] 1.47 2".split(" "),Te:"Tellurium 5 16 p 52 127.6 1.47 2.06".split(" "),Tb:"Terbium 6Lan 19 f 65 158.925 1.94 2".split(" "),Tl:"Thallium 6 13 p 81 204.383 1.45 1.96".split(" "),Th:"Thorium 7Act 20 f 90 232.038 2.06 2".split(" "),
Tm:"Thulium 6Lan 19 f 69 168.934 1.9 2".split(" "),Sn:"Tin 5 14 p 50 118.71 1.39 2.17".split(" "),Ti:"Titanium 4 4 d 22 47.867 1.6 2".split(" "),W:"Tungsten 6 6 d 74 183.84 1.62 2".split(" "),U:"Uranium 7Act 20 f 92 238.029 1.96 1.86".split(" "),V:"Vanadium 4 5 d 23 50.942 1.53 2".split(" "),Xe:"Xenon 5 18 p 54 131.29 1.5 2.16".split(" "),Yb:"Ytterbium 6Lan 19 f 70 173.04 1.87 2".split(" "),Y:"Yttrium 5 3 d 39 88.906 1.9 2".split(" "),Zn:"Zinc 4 12 d 30 65.39 1.22 1.39".split(" "),Zr:"Zirconium 5 4 d 40 91.224 1.75 2".split(" "),
Fc:function(e){return this[e[0].toUpperCase()+e.substr(1).toLowerCase()]}};function Pd(e,f,g,h){var k=1;void 0!==h&&(k=h);var l=e.Pc();h=e.qb().length()/2;var n=new THREE.Matrix4;n.copy(e.matrixWorld);e=new THREE.Matrix4;e.makeTranslation(l.x,l.y,l.z);n.multiply(e);e=new THREE.Matrix4;e.makeTranslation(-n.elements[12],-n.elements[13],-n.elements[14]);e.multiply(f.scene.matrix);e.elements[14]=g?e.elements[14]-(1/k*h*2-f.camera.position.z):f.scene.matrix.elements[14];return e}
function Qd(e,f,g,h){if(0===f.length)return null;var k=new THREE.Raycaster;k.linePrecision=.2;g=new THREE.Vector3(g,h,e.camera.near);k.setFromCamera(g,e.camera);e=k.intersectObjects(f);if(k=e.length){for(f=0;f<k;){g=e[f].object;for(h=!0;null!=g&&h;)h=g.visible,g=g.parent;if(h)break;f++}if(f<k){k=e[f].object;g=k.geometry;if(g instanceof THREE.Geometry)return g.vertices[e[f].face.a].qa;if(g instanceof THREE.BufferGeometry)return k.Ha.oa[g.attributes.atomIndex.array[null!=e[f].index?e[f].index:e[f].face.a]];
console.warn("Unknown type of geometry for raycasting real object")}}return null}function ed(e,f){var g=NaN,h=Pd(e,e,!0),k=e.qb().clone(),g=kd(k).length(),h=jd(k.applyMatrix4(h)),h=Math.abs(f.position.z-h.z)+.5*g,g=Math.max(Math.Zg(2*Math.atan(g/(2*h))),Math.Zg(2*Math.atan(Math.tan(2*Math.atan(g/(2*h))/2)/f.aspect)));isNaN(g)&&(g=Math.Zg(2*Math.atan(Math.tan(Math.Wk()/2)*f.aspect)));return g}
function Rd(e,f){var g=new THREE.SpriteMaterial({map:e});g.depthTest=!1;g.depthWrite=!1;var h=g.map.image.width,k=g.map.image.height,g=new THREE.Sprite(g);g.position.set(f.x,f.y,f.z);g.scale.set(h/40,k/40,1);return g}function Sd(e){this.geometry=new THREE.BufferGeometry;this.kc=[];this.Ye=e?[]:null;this.Fg=[];this.Jg=[];this.Nc=[];this.je=null}function Td(e,f,g,h,k){e.kc.push(f,g,h);f=null!=k?k:new THREE.Color(1,1,1);e.Fg.push(f.r,f.g,f.b);f=new THREE.Vector2(0,1);e.Jg.push(f.x,f.y)}
function Ud(e,f,g,h){null!=e.Ye?e.Ye.push(f,g,h):console.warn("This BufferGeometry is not indexed")}Sd.prototype.sd=function(){this.je=Array(this.kc.length/3);this.je.fill(0);return this.je};THREE.BufferGeometry.prototype.sd=function(){var e=Array(this.attributes.position.count);e.fill(0);e=new Float32Array(e);this.addAttribute("highlight",new THREE.BufferAttribute(e,1))};
function Vd(e){null==e.je&&e.sd();var f=new Float32Array(e.kc);e.kc=void 0;e.geometry.addAttribute("position",new THREE.BufferAttribute(f,3));null!=e.Ye&&(f=new Uint32Array(e.Ye),e.geometry.setIndex(new THREE.BufferAttribute(f,1)),e.Ye=void 0);f=new Float32Array(e.Fg);e.Fg=void 0;f=new THREE.BufferAttribute(f,3);f.dynamic=!0;e.geometry.addAttribute("color",f);f=new Float32Array(e.je);e.je=void 0;e.geometry.addAttribute("highlight",new THREE.BufferAttribute(f,1));f=new Float32Array(e.Jg);e.Jg=void 0;
e.geometry.addAttribute("uv",new THREE.BufferAttribute(f,2));f=new Float32Array(e.Nc);e.Nc=void 0;e.geometry.addAttribute("atomIndex",new THREE.BufferAttribute(f,1));e.geometry.computeVertexNormals();e.geometry.normalizeNormals();return e.geometry}Math.Wk=function(){return 22.5*Math.PI/180};Math.Zg=function(e){return 180*e/Math.PI};THREE.Vector3.prototype.vb=function(){return this.x+":"+this.y+":"+this.z};
function Wd(e,f){var g=new THREE.Vector3;g.x=f.x*e.elements[0];g.y=f.x*e.elements[1];g.z=f.x*e.elements[2];g.x+=f.y*e.elements[4];g.y+=f.y*e.elements[5];g.z+=f.y*e.elements[6];g.x+=f.z*e.elements[8];g.y+=f.z*e.elements[9];g.z+=f.z*e.elements[10];return g}
function Xd(e,f,g,h,k){var l=Math.sqrt(g*g+h*h+k*k);0==l&&(l=.01);g/=l;h/=l;k/=l;l=Math.sin(f);f=Math.cos(f);var n=1-f;e.elements[0]=n*g*g+f;e.elements[4]=n*g*h-l*k;e.elements[8]=n*g*k+l*h;e.elements[1]=n*h*g+l*k;e.elements[5]=n*h*h+f;e.elements[9]=n*h*k-l*g;e.elements[2]=n*k*g-l*h;e.elements[6]=n*k*h+l*g;e.elements[10]=n*k*k+f;e.elements[3]=0;e.elements[7]=0;e.elements[11]=0;e.elements[12]=0;e.elements[13]=0;e.elements[14]=0;e.elements[15]=1}
THREE.Matrix4.prototype.lerp=function(e,f,g){var h=new THREE.Matrix4;h.copy(e);h.elements[12]=e.elements[12]+g*(f.elements[12]-e.elements[12]);h.elements[13]=e.elements[13]+g*(f.elements[13]-e.elements[13]);h.elements[14]=e.elements[14]+g*(f.elements[14]-e.elements[14]);this.copy(h)};
THREE.Matrix4.prototype.slerp=function(e,f,g){var h=Yd(e),h=e.normalize(h);e=Yd(f);e=f.normalize(e);var k=h[0]*e[0]+h[1]*e[1]+h[2]*e[2]+h[3]*e[3];0>k&&(e[0]=-e[0],e[1]=-e[1],e[2]=-e[2],e[3]=-e[3],k=-k);f=1-g;var l=g;.1<1-k&&(l=Math.acos(k),k=1/Math.sin(l),f=Math.sin((1-g)*l)*k,l=Math.sin(g*l)*k);g=[];g.push(f*h[0]+l*e[0]);g.push(f*h[1]+l*e[1]);g.push(f*h[2]+l*e[2]);g.push(f*h[3]+l*e[3]);this.setFromQuaternion(g)};
function Yd(e){var f=e.elements[0]+e.elements[5]+e.elements[10],g,h,k;if(0<=f){var l=Math.sqrt(f+1);k=.5*l;l=.5/l;f=(e.elements[9]-e.elements[6])*l;g=(e.elements[2]-e.elements[8])*l;h=(e.elements[4]-e.elements[1])*l}else e.elements[0]>e.elements[5]&&e.elements[0]>e.elements[10]?(l=Math.sqrt(1+e.elements[0]-e.elements[5]-e.elements[10]),f=.5*l,l=.5/l,g=(e.elements[4]+e.elements[1])*l,h=(e.elements[2]+e.elements[8])*l,k=(e.elements[9]-e.elements[6])*l):e.elements[5]>e.elements[10]?(l=Math.sqrt(1+e.elements[5]-
e.elements[0]-e.elements[10]),g=.5*l,l=.5/l,f=(e.elements[4]+e.elements[1])*l,h=(e.elements[9]+e.elements[6])*l,k=(e.elements[2]-e.elements[8])*l):(l=Math.sqrt(1+e.elements[10]-e.elements[0]-e.elements[5]),h=.5*l,l=.5/l,f=(e.elements[2]+e.elements[8])*l,g=(e.elements[9]+e.elements[6])*l,k=(e.elements[4]-e.elements[1])*l);return[f,g,h,k]}
THREE.Matrix4.prototype.setFromQuaternion=function(e){this.setPosition(new THREE.Vector3(0,0,0));var f=Zd(e),f=1==f?2:0<f?2/f:0,g=e[0]*f,h=e[1]*f,k=e[2]*f,f=e[0]*g,l=e[0]*h,n=e[0]*k,g=e[3]*g,r=e[1]*h,q=e[1]*k,h=e[3]*h,t=e[2]*k;e=e[3]*k;this.elements[0]=1-(r+t);this.elements[1]=l-e;this.elements[2]=n+h;this.elements[4]=l+e;this.elements[5]=1-(f+t);this.elements[6]=q-g;this.elements[8]=n-h;this.elements[9]=q+g;this.elements[10]=1-(f+r)};
function Zd(e){return e[3]*e[3]+e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}THREE.Matrix4.prototype.normalize=function(e){var f=1/Math.sqrt(Zd(e));e[0]*=f;e[1]*=f;e[2]*=f;e[3]*=f;return e};THREE.Vector3.prototype.ib=function(e,f){return new THREE.Vector3(this.x+e.x*f,this.y+e.y*f,this.z+e.z*f)};
THREE.Vector3.u=function(e,f,g){if(e.ph&&f.ph&&g.ph){var h=new THREE.Vector3(f.x,f.y,f.z);h.sub(new THREE.Vector3(e.x,e.y,e.z));h.cross((new THREE.Vector3(g.x,g.y,g.z)).sub(new THREE.Vector3(f.x,f.y,f.z)))}else h=new THREE.Vector3,h.copy(f),h.sub(e),h.cross(g.clone().sub(f));return h};
THREE.Vector3.aa=function(e,f,g,h,k){var l=k*k,n=l*k;if(null===e||null===f||null===g||null===h)return null;var r=null,q=null,r=f.clone().sub(e).add(g.clone().sub(f)).multiplyScalar(.5),q=g.clone().sub(f).add(h.clone().sub(g)).multiplyScalar(.5);e=2*n-3*l+1;k=n-2*l+k;h=n-l;l=-2*n+3*l;return f.clone().multiplyScalar(e).ib(r,k).ib(q,h).ib(g,l)};THREE.Vector3.qc=function(e,f,g){return null===e|null===f?new THREE.Vector3:e.clone().multiplyScalar(1-g).ib(f,g)};
function $d(e,f,g){return Math.atan2(e.clone().dot(g),e.clone().dot(f))}THREE.Vector3.v=function(e,f,g){return e.clone().multiplyScalar(Math.cos(g)).ib(f,Math.sin(g))};function ae(e){var f=Math.abs(e.x),g=Math.abs(e.y),h=Math.abs(e.z);return f<=g&&f<=h?e.clone().cross(new THREE.Vector3(1,0,0)).normalize():g<=f&&g<=h?e.clone().cross(new THREE.Vector3(0,1,0)).normalize():e.clone().cross(new THREE.Vector3(0,0,1)).normalize()}
function be(e,f,g,h){var k=ae(e);e=e.clone().cross(k).normalize();var l=f.length(),n=g.length();f=$d(f,k,e);g=$d(g,k,e);Math.abs(f-g)>Math.PI&&(g<f?g+=2*Math.PI:f+=2*Math.PI);g=THREE.Math.qc(f,g,h);h=THREE.Math.qc(l,n,h);return THREE.Vector3.v(k,e,g).multiplyScalar(h)}THREE.Color.qc=function(e,f,g){return null===e|null===f?null:e.clone().multiplyScalar(1-g).ib(f,g)};THREE.Color.prototype.ib=function(e,f){return new THREE.Color(this.r+e.r*f,this.g+e.g*f,this.b+e.b*f)};
THREE.Math.qc=function(e,f,g){return e*(1-g)+f*g};THREE.GeometryUtils.Tj=function(e,f,g,h,k,l,n,r,q,t,x,w,C,F,G,I){var D=k*f-e*l,K=q*f-e*t;e=C*f-e*F;f=q*l-k*t;k=C*l-k*F;q=C*t-q*F;return(q*n-k*x+f*G)*h-(q*g-e*x+K*G)*r+(k*g-e*n+D*G)*w-(f*g-K*n+D*x)*I};THREE.GeometryUtils.pl=function(e,f,g,h){return THREE.GeometryUtils.ql(e.x,e.y,e.z,e.weight,f.x,f.y,f.z,f.weight,g.x,g.y,g.z,g.weight,h.x,h.y,h.z,h.weight)};THREE.GeometryUtils.ff=function(e,f,g,h,k,l,n,r,q){return(e*k-h*f)*q-(e*r-n*f)*l+(h*r-n*k)*g};
THREE.GeometryUtils.Oc=function(e,f,g,h){return e*h-g*f};
THREE.GeometryUtils.ql=function(e,f,g,h,k,l,n,r,q,t,x,w,C,F,G,I){k=k-e;l=l-f;n=n-g;r=THREE.GeometryUtils.square(k)+THREE.GeometryUtils.square(l)+THREE.GeometryUtils.square(n)-r+h;q=q-e;t=t-f;x=x-g;w=THREE.GeometryUtils.square(q)+THREE.GeometryUtils.square(t)+THREE.GeometryUtils.square(x)-w+h;e=C-e;f=F-f;g=G-g;F=THREE.GeometryUtils.square(e)+THREE.GeometryUtils.square(f)+THREE.GeometryUtils.square(g)-I+h;I=THREE.GeometryUtils.ff(l,n,r,t,x,w,f,g,F);G=THREE.GeometryUtils.ff(k,n,r,q,x,w,e,g,F);r=THREE.GeometryUtils.ff(k,
l,r,q,t,w,e,f,F);k=THREE.GeometryUtils.ff(k,l,n,q,t,x,e,f,g);if(0===k)throw"den==0 in squared_radius_orthogonal_sphereC3_detailedParams";return(THREE.GeometryUtils.square(I)+THREE.GeometryUtils.square(G)+THREE.GeometryUtils.square(r))*THREE.GeometryUtils.square(.5/k)-h};THREE.GeometryUtils.square=function(e){return e*e};THREE.GeometryUtils.Gi=function(e,f,g,h){return THREE.GeometryUtils.xk(e.x,e.y,e.z,e.weight,f.x,f.y,f.z,f.weight,g.x,g.y,g.z,g.weight,h.x,h.y,h.z,h.weight)};
THREE.GeometryUtils.xk=function(e,f,g,h,k,l,n,r,q,t,x,w,C,F,G,I){k=k-e;l=l-f;n=n-g;q=q-e;t=t-f;x=x-g;var D=THREE.GeometryUtils.square(k)+THREE.GeometryUtils.square(l)+THREE.GeometryUtils.square(n),K=THREE.GeometryUtils.square(q)+THREE.GeometryUtils.square(t)+THREE.GeometryUtils.square(x),H=k*q+l*t+n*x,L=D-r+h,O=K-w+h;w=THREE.GeometryUtils.Oc(D,H,H,K);r=THREE.GeometryUtils.Oc(L,H,O,K);D=THREE.GeometryUtils.Oc(D,L,H,O);e=C-e;f=F-f;g=G-g;G=THREE.GeometryUtils.square(e)+THREE.GeometryUtils.square(f)+
THREE.GeometryUtils.square(g);if(0==w)throw"den==0 in in_sphere_detailedParams";return THREE.GeometryUtils.sign(w*(G-I+h)-r*(e*k+f*l+g*n)-D*(e*q+f*t+g*x))};THREE.GeometryUtils.sign=function(e){return 0<e?1:0>e?-1:0};
THREE.GeometryUtils.sl=function(e,f,g,h,k,l,n,r,q,t,x,w){k=k-e;l=l-f;n=n-g;r=THREE.GeometryUtils.square(k)+THREE.GeometryUtils.square(l)+THREE.GeometryUtils.square(n)-r+h;e=q-e;f=t-f;g=x-g;var C=THREE.GeometryUtils.square(e)+THREE.GeometryUtils.square(f)+THREE.GeometryUtils.square(g)-w+h;t=l*g-n*f;q=n*e-k*g;var F=k*f-l*e;w=r*THREE.GeometryUtils.Oc(f,g,q,F)-C*THREE.GeometryUtils.Oc(l,n,q,F);x=r*THREE.GeometryUtils.Oc(e,g,t,F)-C*THREE.GeometryUtils.Oc(k,n,t,F);r=r*THREE.GeometryUtils.Oc(e,f,t,q)-C*
THREE.GeometryUtils.Oc(k,l,t,q);k=THREE.GeometryUtils.ff(k,l,n,e,f,g,t,q,F);if(0==k)throw"den==0";return(THREE.GeometryUtils.square(w)+THREE.GeometryUtils.square(x)+THREE.GeometryUtils.square(r))*THREE.GeometryUtils.square(.5/k)-h};THREE.GeometryUtils.rl=function(e,f,g){return THREE.GeometryUtils.sl(e.x,e.y,e.z,e.weight,f.x,f.y,f.z,f.weight,g.x,g.y,g.z,g.weight)};
function ce(e,f){this.ca=e;this.div=f;this.menu=null;this.ta=!1;this.Hd();this.za=this.Ea=this.aa=this.u=this.da=this.wa=this.v=this.fa=null;this.ne=this.oe=!1;this.ba=this.ca.ba;this.scene3D=this.ba.scene3D}ce.prototype.moveTo=function(e){this.menu.getMenu().detach().appendTo(e)};
ce.prototype.Hd=function(){var e=this,f=de(this),g=ee(this),h=fe(this),k=ge(this),l=he(),n=ie(this),r={title:"Move",cmd:"move"},q={title:"Reset&nbspposition",cmd:"resetPos"},t={title:"Center",cmd:"center"},x={title:"Zoom",cmd:"zoom"},w={title:"As&nbsprotation&nbspanchor",cmd:"anchor"},C={title:"Structure&nbspname",cmd:"labelStr"},F={title:"Molecule&nbspname",cmd:"labelMol"},G={title:"Residue&nbspname",cmd:"labelRes"},I={title:"Atom&nbspname",cmd:"labelAtom"},D={title:"vdW",cmd:"labelVdw"},K={title:"Clear",
cmd:"labelClear"},H={title:"Remove",cmd:"remove"},L=this.ca.Qh,L=L.split("${id}")[0];this.menu=this.div.contextmenu({delegate:".hasContextMenu",autoTrigger:!1,preventContextMenuForPopup:!0,menu:[{title:"File",children:[{title:"Load",cmd:"load",children:[{title:"Load&nbspURL",cmd:"loadUrl"},{title:"Load&nbspFrom&nbsp"+L,cmd:"loadPDB"},{title:"Load&nbspFrom&nbspLocal&nbspFile",cmd:"loadFile"},{title:"Load&nbspScript",cmd:"loadScript"},{title:"Load&nbspScript&nbspFile",cmd:"loadScriptFile"}]},{title:"Save",
cmd:"save"},{title:"Export&nbspFile",cmd:"export"},{title:"Options",cmd:"options"},{title:"Reset",cmd:"reset"}]},{title:"Model",cmd:"model",children:[{title:"Clear&nbsprotation&nbspanchor",cmd:"clearAnchor"},{title:"Manage&nbsprepresentations",cmd:"manageRep"}]},{title:"Tools",children:[{title:"Legend",cmd:"legend"},{title:"Stereoscopy",cmd:"stereo"},{title:"Anaglyph",cmd:"anaglyph"},{title:"Zoom",children:[{title:"25%",cmd:"zoom25"},{title:"50%",cmd:"zoom50"},{title:"100%",cmd:"zoom100"},{title:"200%",
cmd:"zoom200"},{title:"400%",cmd:"zoom400"}]},{title:"Spin",cmd:"spin"}]},{title:"Measurements",children:[{title:"Start",cmd:"startMeasure"},{title:"Stop",cmd:"stopMeasure"},{title:"Clear",cmd:"clearMeasure"}]},{title:"About",children:[{title:"BiovizJS",cmd:"biovizJS"},{title:"System",cmd:"System"}]}],position:function(e){return{my:"left top",at:"left+"+e.extraData.pageX+" top+"+e.extraData.pageY,of:parent.$(document),collision:e.extraData.Oi?"none":"fit"}},beforeOpen:function(f){e.da=f.extraData.target;
null!==e.da?(f=e.ca.ba,e.wa=e.da.mb(),e.v=e.wa.ea,e.fa=e.v.Ec(),e.u=f.ab(e.fa.sa())[0],e.aa=je(f,e.fa.sa(),e.v.type,e.v.id)[0],e.div.contextmenu("setEntry","model",{title:"Model",cmd:"model",children:[{title:"Clear&nbsprotation&nbspanchor",cmd:"clearAnchor"},{title:"----"},{title:e.fa.toString(),cmd:"structure",children:[r,q,w,{title:"----"},t,x,{title:"----"},{title:"Labels",children:[C,F,G,I,D,{title:"----"},K]},{title:"----"},H]},{title:e.v.toString(),cmd:"molecule",children:[r,q,w,{title:"----"},
t,x,{title:"----"},{title:"Labels",children:[F,G,I,D,{title:"----"},K]}]},{title:e.wa.toString(),cmd:"residue",children:[w,{title:"----"},t,x,{title:"----"},{title:"Labels",children:[G,I,D,{title:"----"},K]}]},{title:e.da.toString(),cmd:"atom",children:[w,{title:"----"},t,x,{title:"----"},{title:"Labels",children:[I,D,{title:"----"},K]}]},{title:"----"},{title:"Manage&nbsprepresentations",cmd:"manageRep"}]})):e.div.contextmenu("setEntry","model",{title:"Model",cmd:"model",children:[{title:"Clear&nbsprotation&nbspanchor",
cmd:"clearAnchor"},{title:"Manage&nbsprepresentations",cmd:"manageRep"}]})},select:function(r,q){r.stopPropagation();switch(q.cmd){case "loadUrl":e.ta=!0;f.dialog("open");break;case "loadPDB":e.ta=!1;f.dialog("open");break;case "loadFile":g.dialog("open");break;case "loadScript":h.dialog("open");break;case "loadScriptFile":k.dialog("open");break;case "reset":e.scene3D.reset();break;case "save":l.dialog("open");break;case "options":n.dialog("open");break;case "export":l.dialog("open");break;case "legend":var t=
e.ca.Sh;void 0!=t.u.Legend&&t.u.Legend.show(!0);break;case "stereo":e.oe=!e.oe;e.ne=e.ba.oe(e.oe);break;case "anaglyph":e.ne=!e.ne;e.oe=e.ba.ne(e.ne);break;case "zoom25":case "zoom50":case "zoom100":case "zoom200":case "zoom400":var t=q.cmd.split("zoom").pop()/100,w=e.ba;w.v=t;ke(w,null!=w.Ja?w.Ja:w.scene3D,!0);break;case "spin":null===e.ba.ae?e.ba.kg():e.ba.qf();break;case "measure":l.dialog("open");break;case "biovizJS":l.dialog("open");break;case "System":l.dialog("open");break;case "move":w=q.item.context.parentElement.parentElement.dataset.command;
switch(w){case "structure":e.ba.Xa=e.u;e.scene3D.ba.Ja=e.u;break;case "molecule":e.ba.Xa=e.aa;e.scene3D.ba.Ja=e.aa;break;default:throw Error("Parent command type "+w+" is not handled");}break;case "resetPos":w=q.item.context.parentElement.parentElement.dataset.command;switch(w){case "structure":e.u.Yd();break;case "molecule":e.aa.Yd();break;default:throw Error("Parent command type "+w+" is not handled");}break;case "clearAnchor":e.scene3D.ba.Ja=null;break;case "anchor":w=q.item.context.parentElement.parentElement.dataset.command;
switch(w){case "structure":e.scene3D.ba.Ja=e.u;break;case "molecule":e.scene3D.ba.Ja=e.aa;break;case "residue":le(e);e.scene3D.ba.Ja=e.Ea;break;case "atom":me(e);e.scene3D.ba.Ja=e.za;break;default:throw Error("Parent command type "+w+" is not handled");}break;case "center":w=q.item.context.parentElement.parentElement.dataset.command;switch(w){case "structure":ke(e.ba,e.u);break;case "molecule":ke(e.ba,e.aa);break;case "residue":le(e);ke(e.ba,e.Ea);break;case "atom":me(e);ke(e.ba,e.za);break;default:throw Error("Parent command type "+
w+" is not handled");}break;case "zoom":w=q.item.context.parentElement.parentElement.dataset.command;switch(w){case "structure":ne(e.ba.scene3D,e.u);break;case "molecule":ne(e.ba.scene3D,e.aa);break;case "residue":le(e);ne(e.ba.scene3D,e.Ea);break;case "atom":me(e);ne(e.ba.scene3D,e.za);break;default:throw Error("Parent command type "+w+" is not handled");}break;case "remove":oe(e.ba,e.u);break;case "labelStr":w=q.item.context.parentElement.parentElement.parentElement.parentElement.dataset.command;
pe(e,w);var x;"structure"===w&&(x=e.fa);e.u.Mb(x,M.u.xf);break;case "labelMol":w=q.item.context.parentElement.parentElement.parentElement.parentElement.dataset.command;pe(e,w);"molecule"===w&&(x=e.v);e.u.Mb(x,M.u.Vb);break;case "labelRes":w=q.item.context.parentElement.parentElement.parentElement.parentElement.dataset.command;pe(e,w);switch(w){case "structure":break;case "molecule":x=e.v;break;case "residue":x=e.wa;break;default:throw Error("Parent command type "+w+" is not handled");}e.u.Mb(x,M.u.Gb);
break;case "labelAtom":w=q.item.context.parentElement.parentElement.parentElement.parentElement.dataset.command;pe(e,w);switch(w){case "structure":e.u.Mb(void 0,M.u.Va);break;case "molecule":e.u.Mb(e.v,M.u.Va);break;case "residue":e.u.Mb(e.wa,M.u.Va);break;case "atom":e.u.Mb(e.da,M.u.Va);break;default:throw Error("Parent command type "+w+" is not handled");}break;case "labelVdw":w=q.item.context.parentElement.parentElement.parentElement.parentElement.dataset.command;pe(e,w);switch(w){case "structure":e.u.Mb(void 0,
M.u.vc);break;case "molecule":e.u.Mb(e.v,M.u.vc);break;case "residue":w=e.wa.xa();for(t in w)e.u.Mb(w[t],M.u.vc);break;case "atom":e.u.Mb(e.da,M.u.vc);break;default:throw Error("Parent command type "+w+" is not handled");}break;case "labelClear":w=q.item.context.parentElement.parentElement.parentElement.parentElement.dataset.command;pe(e,w);break;case "startMeasure":e.scene3D.mf();break;case "stopMeasure":e.scene3D.pf();break;case "clearMeasure":e.scene3D.Jf();break;case "manageRep":t=e.ca.Sh;void 0!=
t.u.RepresentationManager&&t.u.RepresentationManager.show(!0);break;default:throw Error("Command "+q.cmd+" not handled by ContextMenu");}}}).contextmenu("instance")};function pe(e,f){switch(f){case "structure":qe(e.u);break;case "molecule":qe(e.u,e.aa);qe(e.u,e.aa.ea.ia);qe(e.u,e.aa.ea.xa());break;case "residue":qe(e.u,e.wa);qe(e.u,e.wa.xa());break;case "atom":qe(e.u,e.da);break;default:throw Error("Parent command type "+f+" is not handled");}}
function de(e){var f,g,h;h='<div id="load-structure-dialog-form" title="Load New Structure"><p class="validateTips">All form fields are required.</p><form><fieldset>';h+='<label id ="structIDLabel" for="structID">Structure ID : </label>';h+='<input type="text" name="structID" id="structID" class="text ui-widget-content ui-corner-all">';h+="<br>";h+='<label for="isPDBX">Load PDBX : </label>';h+='<input type="checkbox" name="isPDBX" id="isPDBX" class="button ui-widget-content ui-corner-all" checked>';
h+='<input type="submit" tabindex="-1" style="position:absolute; top:-1000px">';h+="</fieldset>";h+="</form>";h+="</div>";$(h).appendTo(document.body);var k=$("#structID"),l=$("#isPDBX"),n=$([]).add(k).add(l);f=$("#load-structure-dialog-form").dialog({autoOpen:!1,height:250,width:300,modal:!0,position:{my:"center",at:"center",of:$("#content")},buttons:{"Load Structure":function(){n.removeClass("ui-state-error");console.log("Loading PDBX ? "+l.is(":checked"));if(e.ta)e.ca.vd=l.is(":checked"),e.ba.Jc(k.val()),
f.dialog("close");else{var g=/^[a-z0-9]+$/i;4==k.val().length&&g.test(k.val())?(e.ca.vd=l.is(":checked"),biovizAPI.Jc(k.val()),f.dialog("close")):k.addClass("ui-state-error")}},Cancel:function(){f.dialog("close")}},open:function(){e.ta?$("#structIDLabel").html("Structure URL : "):$("#structIDLabel").html("Structure ID : ")},close:function(){g[0].reset();n.removeClass("ui-state-error")}});g=f.find("form").on("submit",function(f){f.preventDefault();e.Jc()});return $("#load-structure-dialog-form")}
function ee(e){var f,g,h;h='<div id="load-structure-file-dialog-form" title="Load New Structure"><p class="validateTips">All form fields are required.</p><form><fieldset>';h+='<label id ="structIDLabel" for="file">Structure file : </label>';h+='<input type="file" name="file" id="file">';h+="<br>";h+='<label for="isPDBX">Load PDBX : </label>';h+='<input type="checkbox" name="isPDBX" id="isPDBX" class="button ui-widget-content ui-corner-all" checked>';h+='<input type="submit" tabindex="-1" style="position:absolute; top:-1000px">';
h+="</fieldset>";h+="</form>";h+="</div>";$(h).appendTo(document.body);var k=$("#isPDBX");f=$("#load-structure-file-dialog-form").dialog({autoOpen:!1,height:250,width:300,modal:!0,position:{my:"center",at:"center",of:$("#content")},buttons:{"Load Structure":function(){var g=$("#file")[0].files,h=new FileReader;h.onload=function(){return function(g){e.ca.vd=k.is(":checked");biovizAPI.Xf(g.target.result);f.dialog("close")}}(g);h.readAsText(g[0])},Cancel:function(){f.dialog("close")}},open:function(){e.ta?
$("#structIDLabel").html("Structure URL : "):$("#structIDLabel").html("Structure ID : ")},close:function(){g[0].reset()}});g=f.find("form").on("submit",function(f){f.preventDefault();e.Jc()});return $("#load-structure-file-dialog-form")}
function fe(e){var f,g,h;h='<div id="load-script-dialog-form" title="Load New Script"><form><fieldset><label id ="scriptLabel" for="script">Script (string or url) : </label>';h+='<input type="text" name="script" id="script" class="text ui-widget-content ui-corner-all">';h+="<br>";h+='<input type="submit" tabindex="-1" style="position:absolute; top:-1000px">';h+="</fieldset>";h+="</form>";h+="</div>";$(h).appendTo(document.body);var k=$("#script"),l=$([]).add(k);f=$("#load-script-dialog-form").dialog({autoOpen:!1,
height:250,width:300,modal:!0,position:{my:"center",at:"center",of:$("#content")},buttons:{"Load Script":function(){function g(h){try{re(e.ca,h),f.dialog("close")}catch(l){k.addClass("ui-state-error"),console.warn("Didn't succeed to get script")}}l.removeClass("ui-state-error");var h=k.val();$.ajax({async:!0,crossDomain:!0,url:h,success:function(e){g(e)},error:function(){g(h)}})},Cancel:function(){f.dialog("close")}},close:function(){g[0].reset();l.removeClass("ui-state-error")}});g=f.find("form").on("submit",
function(f){f.preventDefault();e.xb()});return $("#load-script-dialog-form")}
function ge(e){var f,g,h;h='<div id="load-local-script-dialog-form" title="Load New Script"><form><fieldset><label id ="scriptLabel" for="scriptFile">Script (string or url) : </label>';h+='<input type="file" name="scriptFile" id="scriptFile">';h+="<br>";h+='<input type="submit" tabindex="-1" style="position:absolute; top:-1000px">';h+="</fieldset>";h+="</form>";h+="</div>";$(h).appendTo(document.body);f=$("#load-local-script-dialog-form").dialog({autoOpen:!1,height:250,width:300,modal:!0,position:{my:"center",
at:"center",of:$("#content")},buttons:{"Load Script":function(){var g=$("#scriptFile")[0].files,h=new FileReader;h.onload=function(){return function(g){console.log(g.target.result);re(e.ca,g.target.result);f.dialog("close");f.dialog("close")}}(g);h.readAsText(g[0])},Cancel:function(){f.dialog("close")}},close:function(){g[0].reset()}});g=f.find("form").on("submit",function(f){f.preventDefault();e.xb()});return $("#load-local-script-dialog-form")}
function he(){var e;$('<div id="not-implemented-dialog-form" title="Feature not available"><p class="info">This feature will be added soon</p></div>').appendTo(document.body);e=$("#not-implemented-dialog-form").dialog({autoOpen:!1,height:250,width:300,modal:!0,position:{my:"center",at:"center",of:$("#content")},buttons:{Cancel:function(){e.dialog("close")}}});return $("#not-implemented-dialog-form")}
function ie(e){function f(){r=l.Qa;q=l.dg.antialias;t=l.me;x="#"+l.bgColor.getHexString();w=l.af;C=r;F=t;G=w;I="";$("#quality").find('option[value="'+r+'"]').attr("selected",!0);$("#quality").selectmenu("refresh");$("#antialias").prop("checked",q);$("#textSize").slider("value",t);$("#textSizeInfo").html(t+"%");$("#mouse3D").val("");var e=[],f=n.te.values(),g;for(g in f){var k=f[g];e.push('<option value="'+k.index+'">'+k.id+"</option>")}$("#mouse3D").append(e.join(""));null!=n.kb&&(I=n.kb.id,G=n.kb.index,
$("#mouse3D").find('option[value="'+G+'"]').attr("selected",!0),$("#mouse3D").selectmenu("refresh"));$.farbtastic("#colorpicker").setColor(x)}function g(){se(l,C);r=C;var e=$("#antialias").prop("checked");window.localStorage.setItem("antialias",e);q=antialias;l.me=F;window.localStorage.setItem("textRatio",l.me);t=F;e=$.farbtastic("#colorpicker").color;$("#saveBg").prop("checked")&&window.localStorage.setItem("background",e);l.Ld(new THREE.Color(e));x=e;n.kb=n.te.get(G);e=I;l.af=e;window.localStorage.setItem("3DController",
e);w=G}var h,k;k='<div id="config-dialog-form" title="BiovizJS Configuration"><label for="quality">Select a quality : </label><select name="quality" id="quality"><option value="LOW">Low</option>';k+='<option value="MEDIUM">Medium</option>';k+='<option value="HIGH">High</option>';k+="</select>";k+="<br/>";k+='<label for="antialias">Antialiasing (needs page refresh) : </label>';k+='<input type="checkbox" name="Antialiasing" id="antialias" class="button ui-widget-content ui-corner-all">';k+="<br/>";
k+='<label for="mouse3D">Select a 3D Mouse : </label>';k+='<select name="mouse3D" id="mouse3D">';k+="</select>";k+="<br/>";k+='<label for="textSize">Text Size : </label>';k+='<span id="textSizeInfo"></span>';k+='<div id="textSize"></div>';k+="<br/>";k+='<label id ="bgLabel" for="background">Background Color : </label>';k+='<label for="saveBg">Save background configuration : </label>';k+='<input type="checkbox" name="saveBg" id="saveBg" class="button ui-widget-content ui-corner-all">';k+='<div id="colorpicker"></div>';
k+="<br/>";k+='<label for="advance">Enable advance features : </label>';k+='<input type="checkbox" name="Advanced Features" id="advance" class="button ui-widget-content ui-corner-all">';k=$(k);k.appendTo(document.body);var l=te(),n=e.ca.ba.scene3D.Ui,r=l.Qa,q=l.dg.antialias,t=l.me,x="#"+l.bgColor.getHexString(),w=l.af,C=r,F=t,G=w,I="";h=$("#config-dialog-form").dialog({autoOpen:!1,height:250,width:300,modal:!0,position:{my:"center",at:"center",of:$("#content")},buttons:{Reset:function(){l.dg.antialias=
!0;l.Qa="MEDIUM";l.me=20;l.bgColor=new THREE.Color(0,0,0);l.af="";$("#saveBg").prop("checked",!0);f();g()},Apply:function(){g();h.dialog("close")},Cancel:function(){h.dialog("close")}},open:function(){f()}});$("#quality").selectmenu({width:"200px",select:function(e,f){C=f.item.value}});$("#mouse3D").selectmenu({width:"200px",select:function(e,f){G=f.item.value;I=f.item.label}});$("#textSize").slider({slide:function(e,f){F=f.value;$("#textSizeInfo").html(F+"%")}});$("#colorpicker").farbtastic();$("#advance").attr("disabled",
!0);k.find("select").css({width:"150%"});k.find("select").find(".options-small").css({"font-size":"0.8em"});k.find("label").css({display:"block"});return $("#config-dialog-form")}function le(e){e.Ea=e.ca.ba.oc(e.fa.sa(),e.v.type,e.v.id,e.wa._id,!0)[0]}function me(e){e.za=e.ca.ba.od(e.fa.sa(),e.v.type,e.v.id,e.da.id,e.da.ld,!0)[0]}
function EventTarget(e){this._listeners={};var f=this;e&&!e.addListener&&(e.addListener=function(e,h){f.addListener(e,h)},e.removeListener=function(e,h){f.removeListener(e,h)},e.pb=function(e){f.fire(e)})}EventTarget.prototype.addListener=function(e,f){void 0===this._listeners[e]&&(this._listeners[e]=[]);this._listeners[e].push(f)};EventTarget.prototype.removeListener=function(e,f){var g=this._listeners[e];if(void 0!==g)for(var h=g.length,k=0;k<h;k++)if(g[k]===f){g.splice(k,1);break}};
EventTarget.prototype.fire=function(e){"string"===typeof e&&(e={type:e});e.target||(e.target=this);if(!e.type)throw Error("Event object type must be defined");var f=this._listeners[e.type];if(void 0!==f)for(var g=f.length,h=0;h<g;h++)f[h].call(this,e)};
function ue(){if("object"===typeof ve)return ve;ve=this;this.bgColor=new THREE.Color(0,0,0);var e=window.localStorage.getItem("quality"),f=window.localStorage.getItem("antialias"),g=window.localStorage.getItem("textRatio"),h=window.localStorage.getItem("background"),k=window.localStorage.getItem("3DController");this.Xi=this.Ud=this.Ae=this.ze=this.xb=this.ud=this.Ic=this.wd=this.Yf=null;we(this);this.Kc={Atoms:this.xb,"Amino Acids":this.ud,"Nucleic Acids":this.Ic,Molecules:this.wd,"Secondary Structure Type":this.Ud,
Rainbow:this.Ae,Hydrophobicity:this.ze};this.fa={Atoms:[],Residues:[],Molecules:[],SST:[]};f="string"==typeof f?JSON.parse(f):f;this.dg={antialias:null!=f?f:!0,Kl:"0c0c0c"};this.Qa=null!=e?e:"MEDIUM";this.me=null!=g?g:7;null!=h&&(this.bgColor=new THREE.Color(h));this.af=k;this.Xj=30;this.fps=60;this.za=this.ta=this.Ea=this.pc=null;this.v={la:{radius:1,widthSegments:16,heightSegments:8,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},na:{radius:1,widthSegments:10,heightSegments:6,phiStart:0,
phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},ma:{radius:1,widthSegments:6,heightSegments:3,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI}};this.u={la:{radius:.3,widthSegments:12,heightSegments:8,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},na:{radius:.3,widthSegments:8,heightSegments:5,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},ma:{radius:.3,widthSegments:5,heightSegments:3,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI}};
this.aa={la:{radiusTop:.2,radiusBottom:.2,height:1,xd:12,heightSegments:1,openEnded:!1},na:{radiusTop:.2,radiusBottom:.2,height:1,xd:5,heightSegments:1,openEnded:!1},ma:{radiusTop:.2,radiusBottom:.2,height:1,xd:3,heightSegments:1,openEnded:!1}};this.da={la:{radius:this.aa.la.radiusTop,widthSegments:12,heightSegments:8,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},na:{radius:this.aa.la.radiusTop,widthSegments:6,heightSegments:4,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},
ma:{radius:this.aa.la.radiusTop,widthSegments:5,heightSegments:3,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI}};this.lineWidth=1.5;this.gj=1;this.Vd=[]}var ve;function te(){return new ue}ue.prototype.subscribe=function(e){void 0!==e.update&&this.Vd.push(e)};function xe(e,f){for(var g=e.Vd.length,h=0;h<g;h++)e.Vd[h].update(f)}ue.prototype.setLineWidth=function(e){this.lineWidth=e;xe(this,{lineWidth:!0})};ue.prototype.Ld=function(e){this.bgColor=e;xe(this,{bgColor:!0})};
function ye(e,f,g){if("A"===g)return void 0===e.fa.Atoms[f]?(g=new THREE.Color(e.xb[f]),e.fa.Atoms[f]=g):e.fa.Atoms[f];if("M"===g)return void 0===e.fa.Molecules[f]?(g=new THREE.Color(e.wd[f]),e.fa.Molecules[f]=g):e.fa.Molecules[f];if("R"===g)return void 0===e.fa.Residues[f]?(g=e.ud[f],void 0===g&&(g=e.Ic[f]),g=new THREE.Color(g),e.fa.Residues[f]=g):e.fa.Residues[f];if("SST"===g)return void 0===e.fa.SST[f]?(g=e.Ud[f],g=new THREE.Color(g),e.fa.SST[f]=g):e.fa.SST[f]}
function se(e,f){if("LOW"===f||"MEDIUM"===f||"HIGH"===f)e.Qa=f,"HIGH"===e.Qa?(e.Ea=new THREE.SphereGeometry(e.v.la.radius,e.v.la.widthSegments,e.v.la.heightSegments,e.v.la.phiStart,e.v.la.phiLength,e.v.la.thetaStart,e.v.la.thetaLength),e.ta=new THREE.SphereGeometry(e.u.la.radius,e.u.la.widthSegments,e.u.la.heightSegments,e.u.la.phiStart,e.u.la.phiLength,e.u.la.thetaStart,e.u.la.thetaLength),e.za=new THREE.CylinderGeometry(e.aa.la.radiusTop,e.aa.la.radiusBottom,e.aa.la.height,e.aa.la.xd,e.aa.la.gf,
e.aa.la.openEnded)):"MEDIUM"===e.Qa?(e.Ea=new THREE.SphereGeometry(e.v.na.radius,e.v.na.widthSegments,e.v.na.heightSegments,e.v.na.phiStart,e.v.na.phiLength,e.v.na.thetaStart,e.v.na.thetaLength),e.ta=new THREE.SphereGeometry(e.u.na.radius,e.u.na.widthSegments,e.u.na.heightSegments,e.u.na.phiStart,e.u.na.phiLength,e.u.na.thetaStart,e.u.na.thetaLength),e.za=new THREE.CylinderGeometry(e.aa.na.radiusTop,e.aa.na.radiusBottom,e.aa.na.height,e.aa.na.xd,e.aa.na.gf,e.aa.na.openEnded)):"LOW"===e.Qa&&(e.Ea=
new THREE.SphereGeometry(e.v.ma.radius,e.v.ma.widthSegments,e.v.ma.heightSegments,e.v.ma.phiStart,e.v.ma.phiLength,e.v.ma.thetaStart,e.v.ma.thetaLength),e.ta=new THREE.SphereGeometry(e.u.ma.radius,e.u.ma.widthSegments,e.u.ma.heightSegments,e.u.ma.phiStart,e.u.ma.phiLength,e.u.ma.thetaStart,e.u.ma.thetaLength),e.za=new THREE.CylinderGeometry(e.aa.ma.radiusTop,e.aa.ma.radiusBottom,e.aa.ma.height,e.aa.ma.xd,e.aa.ma.gf,e.aa.ma.openEnded)),xe(e,{bg:!0}),window.localStorage.setItem("quality",e.Qa)}
function ze(e){null===e.ta&&("HIGH"===e.Qa?e.ta=new THREE.SphereGeometry(e.u.la.radius,e.u.la.widthSegments,e.u.la.heightSegments,e.u.la.phiStart,e.u.la.phiLength,e.u.la.thetaStart,e.u.la.thetaLength):"MEDIUM"===e.Qa?e.ta=new THREE.SphereGeometry(e.u.na.radius,e.u.na.widthSegments,e.u.na.heightSegments,e.u.na.phiStart,e.u.na.phiLength,e.u.na.thetaStart,e.u.na.thetaLength):"LOW"===e.Qa&&(e.ta=new THREE.SphereGeometry(e.u.ma.radius,e.u.ma.widthSegments,e.u.ma.heightSegments,e.u.ma.phiStart,e.u.ma.phiLength,
e.u.ma.thetaStart,e.u.ma.thetaLength)));return e.ta}function Ae(e,f){if(null===f||void 0===f)f=30;return Be(e,{fontsize:f,bh:{r:255,g:255,b:255,a:1},strokeStyle:!0})}
function Be(e,f){void 0===f&&(f={});var g=void 0!==f.Yj?f.Yj:"Arial",h=void 0!==f.fontsize?f.fontsize:20,k=void 0!==f.bh?f.bh:{r:1,g:0,b:0,a:1},l=f.maxWidth,n=f.maxHeight,r=document.createElement("canvas"),q=r.getContext("2d");q.font=h+"px "+g;var t=q.measureText(e).width,h=Math.ceil(h);null!=l&&t>l&&(h=Math.ceil(h*l/t),q.font=h+"px "+g,t=l);null!=n&&h>n&&(t*=n/h,h=n,q.font=h+"px "+g);r.width=t;r.height=h;q.fillStyle="rgba("+k.r+","+k.g+","+k.b+","+k.a+")";q.font=h+"px "+g;q.textAlign="center";q.textBaseline=
"middle";f.strokeStyle&&(q.strokeStyle="rgba(0,0,0,1.0)",q.lineWidth=2,q.strokeText(e,t/2,h/2));q.fillText(e,t/2,h/2);g=new THREE.Texture(r);g.minFilter=THREE.LinearFilter;g.needsUpdate=!0;return g}function Ce(e,f){return parseFloat(Ua.Fc(f.symbol.charAt(0).toUpperCase()+f.symbol.slice(1).toLowerCase())[7])}function De(){return new THREE.MeshPhongMaterial({vertexColors:THREE.VertexColors})}
function we(e){e.Yf=JSON.parse(window.localStorage.getItem("def"))||Gd;e.wd=JSON.parse(window.localStorage.getItem("moleculeColor"))||Hd;e.Ic=JSON.parse(window.localStorage.getItem("nucleicAcidColor"))||Id;e.ud=JSON.parse(window.localStorage.getItem("residueColor"))||Jd;e.xb=JSON.parse(window.localStorage.getItem("atomColor"))||Kd;e.ze=JSON.parse(window.localStorage.getItem("hydroColor"))||Ld;e.Ae=JSON.parse(window.localStorage.getItem("rainbowColor"))||Md;e.Ud=JSON.parse(window.localStorage.getItem("sstColor"))||
Nd;e.Xi=JSON.parse(window.localStorage.getItem("unsortedProperties"))||Od;e.Kc={Atoms:e.xb,"Amino Acids":e.ud,"Nucleic Acids":e.Ic,Molecules:e.wd,"Secondary Structure Type":e.Ud,Rainbow:e.Ae,Hydrophobicity:e.ze}}
function Ee(e){this.og=new Worker("webworker.js");this.ca=e;this.ra=new ue;e=$("#content").width()/$("#content").height();this.camera=new THREE.PerspectiveCamera(45,e,1,1E3);this.Xa=this.scene3D=new Fe(this);this.Ja=null;this.domElement=this.scene3D.renderer.domElement;this.effect=null;this.yc=this.Me=!1;this.u=null;this.v=1;this.ae=null;this.ra.subscribe(this)}function Ge(e){e.ca.pb({type:"requestWidgetUpdate",data:null!=e.Ja?e.Ja.pa._id:null})}z=Ee.prototype;z.Pg=function(e){this.ca.Pg(e)};
z.Jc=function(e,f){var g=this;if(void 0===e)throw Error("Structure's identifier to load is undefined");He(this.ca,"Parsing...",!0);console.log("Loading URL : "+h);var h;-1!=e.indexOf("/")?h=e:(h=this.ca.Qh.slice().replace("${id}",e),h=h.replace("${divided}",e.substring(1,2)));He(this.ca,"Parsing...",!0);return(new Fd(h,this.ca.vd,f)).load().then(function(e){He(g.ca);return e})["catch"](function(e){He(g.ca,e.message);return e})};
z.Xf=function(e,f){var g=this;He(this.ca,"Parsing...",!0);return(new Fd(e,this.ca.vd,f,!0)).load().then(function(e){He(g.ca);return e})["catch"](function(e){console.warn("Error : ",e)})};function Ue(e,f,g){He(e.ca,"Loading 3D Objects...",!0);if(null!==f&&void 0!==f){var h=new M(f);null!=g&&h.pa.bd(g);f=f.v[0].aa;g=f.length;for(var k=0;k<g;k++)h.hb(f[k]);He(e.ca);return h}return null}
function Ve(e,f){He(e.ca,"Loading 3D Representations...",!0);for(var g=We(f),h=g.length,k=[],l=0;l<h;l++)k.push(new Promise(function(e){var f=g[l];setTimeout(function(){Xe(f);e()},100)}));return Promise.all(k)}function Ye(e){var f=1.5*e.scene3D.qb().length();e.camera.far=f;Ze=f/5E3;$e(e.scene3D,0,100);f=e.scene3D;f.Qb.fog.near=f.camera.far-(f.camera.far-f.camera.near)*f.ra.Xj/100;f.Qb.fog.far=f.camera.far;e.camera.updateProjectionMatrix();e.camera.fov=ed(e.scene3D,e.camera)}
function oe(e,f){f.traverse(function(f){f===e.Ja&&(e.Ja=null);f===e.Xa&&(e.Xa=e.scene3D)});var g=e.scene3D.ka.indexOf(f);0<=g&&e.scene3D.ka.splice(g,1);f["delete"]();Ye(e);Ge(e)}
z.translate=function(e,f,g){e=new THREE.Vector3(e,f,g);this.Xa===this.scene3D?(e=(new THREE.Matrix4).setPosition(e),e=e.multiply(this.Xa.matrixWorld),this.Xa.matrix.copy(e)):(f=new THREE.Matrix4,f.copy(this.Xa.matrixWorld),g=new THREE.Matrix4,g.getInverse(f),f=Wd(g,e),e=new THREE.Matrix4,e.makeTranslation(f.x,f.y,f.z),f=new THREE.Matrix4,f.copy(this.Xa.matrix),f.multiply(e),this.Xa.matrix.copy(f));this.Xa.updateMatrixWorld(!0)};
z.rotate=function(e,f,g){var h=null!==this.Xa?this.Xa:this.scene3D.scene,k=null!==this.Ja?this.Ja:h,l=new THREE.Matrix4;l.copy(h.matrixWorld);var n=new THREE.Matrix4;n.getInverse(l);var r=new THREE.Matrix4;r.copy(h.matrixWorld);l=new THREE.Matrix4;l.getInverse(r);var r=new THREE.Vector3(l.elements[0],l.elements[1],l.elements[2]),q=new THREE.Vector3(l.elements[4],l.elements[5],l.elements[6]),t=(new THREE.Vector3).crossVectors(r,q),l=new THREE.Matrix4;Xd(l,e,q.x,q.y,q.z);e=new THREE.Matrix4;Xd(e,f,
r.x,r.y,r.z);f=new THREE.Matrix4;Xd(f,g,t.x,t.y,t.z);g=new THREE.Matrix4;g=f.multiply(e).multiply(l);f=new THREE.Vector3;f.copy(k.Pc());f=(new THREE.Matrix4).makeTranslation(f.x,f.y,f.z);n=(new THREE.Matrix4).copy(n);n.multiply(k.matrixWorld).multiply(f);k=(new THREE.Matrix4).getInverse(n);n=[n,k];k=new THREE.Matrix4;k=k.multiply(n[0]).multiply(g).multiply(n[1]);n=new THREE.Matrix4;h.matrix.copy((null!==h.matrix?h.matrix:n).multiply(k));h.updateMatrixWorld(!0)};
function ke(e,f,g){f=Pd(f,e.scene3D,g,e.v);e.scene3D.scene.matrix.copy(f);e.scene3D.scene.matrixWorldNeedsUpdate=!0}z.kg=function(e){null!==this.ae&&this.qf();void 0==e&&(e=.25);this.ae=new af(this.scene3D,e);this.scene3D.sf.dc(this.ae)};z.qf=function(){this.ae&&(this.ae.stop(),this.ae=null)};z.oe=function(e){(this.Me=e)&&this.yc&&(this.yc=!1);return this.yc};z.ne=function(e){(this.yc=e)&&this.Me&&(this.Me=!1);return this.Me};
z.ab=function(e){for(var f in this.scene3D.ka)if(this.scene3D.ka[f].Uc()===e)return[this.scene3D.ka[f]]};
function je(e,f,g,h){var k=[];if(void 0===g)for(var l in e.scene3D.ka)e.scene3D.ka[l].Uc().toUpperCase()===f.toUpperCase()&&(k=k.concat(We(e.scene3D.ka[l])));else if(void 0===h)for(l in e.scene3D.ka){if(e.scene3D.ka[l].Uc().toUpperCase()===f.toUpperCase()){var n=We(e.scene3D.ka[l]),r;for(r in n)g.toUpperCase()===n[r].ea.type.toUpperCase()&&k.push(n[r])}}else for(l in e.scene3D.ka)if(e.scene3D.ka[l].Uc().toUpperCase()===f.toUpperCase())for(r in n=We(e.scene3D.ka[l]),n)if(g.toUpperCase()===n[r].ea.type.toUpperCase()&&
h.toUpperCase()===n[r].ea.id.toUpperCase())return[n[r]];return k}z.oc=function(e,f,g,h,k){e=je(this,e,f,g)[0];if(null!==e){f=e.ea.ia;for(var l in f)if(g=f[l],g.sa()==h)return[e.oc(g,k)]}return null};z.od=function(e,f,g,h,k,l){e=je(this,e,f,g)[0];if(null!==e){f=e.ea.xa();for(var n in f)if(f[n].id===h&&(null==k||f[n].ld===k)&&(g=e.oc(f[n].mb(),l),null!==g&&void 0!==g))return[g.od(f[n],l)]}return null};
function bf(e){this.u=null;this.scene3D=e;this.u=new THREE.DirectionalLight(16777215,1);this.u.position.set(this.scene3D.camera.position.x,this.scene3D.camera.position.y,this.scene3D.camera.position.z);this.u.matrixAutoUpdate=!0;this.scene3D.Qb.add(this.u)}function cf(e){this.ra=te();this.duration=e;this.Oa=0}cf.prototype.moveTo=function(e){if(1<e||0>e||isNaN(e))return 0;this.Oa=this.duration*e};function df(e){new THREE.Clock;this.ra=te();this.zc=[];this.pause=!1;this.scene3D=e}df.prototype.dc=function(e){this.zc.push(e)};
function ef(e,f,g){if(!e.pause||g){g=e.zc.length;for(var h=0;h<g;h++){var k=e.zc[h];k.kd(f);-1!=k.duration&&k.Oa>=k.duration&&(e.zc.splice(h,1),g--)}}}function ff(e,f,g,h){cf.call(this);this.duration=g;this.scene3D=f;this.se=new THREE.Matrix4;this.Hi=new THREE.Matrix4;this.Hi.copy(this.scene3D.scene.matrix);e=Pd(e,this.scene3D,h);this.se.copy(e)}ff.prototype=Object.create(cf.prototype);ff.prototype.constructor=ff;
ff.prototype.kd=function(e){this.Oa+=e;e=this.Oa/this.duration;1<e&&(e=1);var f=new THREE.Matrix4;f.lerp(this.Hi,this.se,e);this.scene3D.scene.matrix.copy(f);this.scene3D.scene.matrixWorldNeedsUpdate=!0};function gf(e,f,g,h){cf.call(this);this.r=e;this.g=f;this.b=g;this.duration=h;this.Yi=this.ra.bgColor.r;this.zi=this.ra.bgColor.g;this.ni=this.ra.bgColor.b}gf.prototype=Object.create(cf.prototype);gf.prototype.constructor=gf;
gf.prototype.kd=function(e){this.Oa+=e;e=this.Oa/this.duration;1<e?this.ra.Ld(new THREE.Color(this.r,this.g,this.b)):this.ra.Ld(new THREE.Color(this.Yi+(this.r-this.Yi)*e,this.zi+(this.g-this.zi)*e,this.ni+(this.b-this.ni)*e))};function hf(e){cf.call(this);this.Oa=0;this.duration=e}hf.prototype=Object.create(cf.prototype);hf.prototype.constructor=hf;hf.prototype.kd=function(e){this.Oa+=e};
function jf(e,f){cf.call(this);this.duration=e;this.Ha=f;this.Uf=[];this.b=this.g=this.r=null;this.wh=!1;this.map=null}jf.prototype=Object.create(cf.prototype);z=jf.prototype;z.constructor=jf;z.init=function(){var e=this.Ha.ga.geometry,f=e.attributes.color,e=e.attributes.color.array;if(0===f.count)this.Ha.ga.material.color=this.Ha.ga.material.color.clone(),this.Uf.push(this.Ha.ga.material.color);else for(var f=f.count,g=0;g<f;g++){var h=(new THREE.Color(e[3*g],e[3*g+1],e[3*g+2])).clone();this.Uf.push(h)}};
z.ig=function(e,f,g){1<e?this.r=e/255:this.r=e;1<f?this.g=f/255:this.g=f;1<g?this.b=g/255:this.b=g;this.init()};z.lf=function(e){this.wh=!0;this.map=e;this.init()};
z.kd=function(e){this.Oa+=e;e=this.Oa/this.duration;1<e&&(e=1);for(var f=this.Ha.ga.geometry.attributes.color,g=new Float32Array(f.array.length),h=this.Uf.length,k=0;k<h;k++){var l=this.Uf[k];if(1===e)if(this.wh){var n=this.map[k];null!=n?(g[3*k]=n.r,g[3*k+1]=n.g,g[3*k+2]=n.b):(g[3*k]=l.r,g[3*k+1]=l.g,g[3*k+2]=l.b)}else g[3*k]=this.r,g[3*k+1]=this.g,g[3*k+2]=this.b;else this.wh?(n=this.map[k],null!=n?(g[3*k]=l.r+(n.r-l.r)*e,g[3*k+1]=l.g+(n.g-l.g)*e,g[3*k+2]=l.b+(n.b-l.b)*e):(g[3*k]=l.r,g[3*k+1]=l.g,
g[3*k+2]=l.b)):(g[3*k]=l.r+(this.r-l.r)*e,g[3*k+1]=l.g+(this.g-l.g)*e,g[3*k+2]=l.b+(this.b-l.b)*e)}f.set(g);f.needsUpdate=!0};
function kf(e,f,g,h){cf.call(this);this.duration=e;this.target=f;this.scene3D=g;this.kh=new THREE.Matrix4;this.kh.copy(this.target.matrix);this.zk=new THREE.Vector3;this.Ii=new THREE.Quaternion;this.Ji=new THREE.Vector3;this.kh.decompose(this.zk,this.Ii,this.Ji);this.se=h;this.Vj=new THREE.Vector3;this.wi=new THREE.Quaternion;this.xi=new THREE.Vector3;this.se.decompose(this.Vj,this.wi,this.xi);e=this.target.Pc();this.Eh=new THREE.Vector3(-e.x,-e.y,-e.z);this.Dh=(new THREE.Matrix4).setPosition(this.Eh);
this.fg=e.clone();this.bj=(new THREE.Matrix4).setPosition(this.fg);this.Nh=new THREE.Vector3;f=new THREE.Matrix4;f.multiply(this.kh).multiply((new THREE.Matrix4).setPosition(e));this.Nh.setFromMatrixPosition(f);f=new THREE.Vector3;g=new THREE.Matrix4;g.multiply(this.se).multiply((new THREE.Matrix4).setPosition(e));f.setFromMatrixPosition(g);this.nj=new THREE.Vector3;this.nj.subVectors(this.Nh,e);this.pi=new THREE.Vector3;this.pi.subVectors(f,this.Nh)}kf.prototype=Object.create(cf.prototype);
kf.prototype.constructor=kf;
kf.prototype.kd=function(e){this.Oa+=e;e=this.Oa/this.duration;if(1<e||isNaN(e))this.target.matrix.copy(this.se);else{var f=new THREE.Quaternion;THREE.Quaternion.slerp(this.Ii,this.wi,f,e);var f=(new THREE.Matrix4).makeRotationFromQuaternion(f),g=new THREE.Vector3;g.lerp(this.pi,e);(new THREE.Matrix4).setPosition(g);var h=new THREE.Vector3;h.lerpVectors(this.Ji,this.xi,e);(new THREE.Matrix4).scale(h);e=(new THREE.Matrix4).setPosition(g.add(this.fg).add(this.nj));e.multiply(f);e.multiply(this.Dh);
this.target.matrix.copy(e)}this.target.matrixWorldNeedsUpdate=!0};hf=function(e,f,g){cf.call(this);this.jh=null;this.opacity=e;this.Ha=g;this.Oa=0;this.duration=f;this.Ha.ga.material.transparent=!0;this.jh=this.Ha.ga.material.opacity};hf.prototype=Object.create(cf.prototype);hf.prototype.constructor=hf;hf.prototype.kd=function(e){this.Oa+=e;e=this.Oa/this.duration;1<e&&(e=1);this.Ha.ga.material.opacity=1===e?this.opacity:1===e?this.opacity:this.jh+(this.opacity-this.jh)*e};
function af(e,f){cf.call(this);this.duration=-1;this.speed=f;this.target=e;var g=this.target.Pc();this.Eh=new THREE.Vector3(-g.x,-g.y,-g.z);this.Dh=(new THREE.Matrix4).setPosition(this.Eh);this.fg=g.clone();this.bj=(new THREE.Matrix4).setPosition(this.fg)}af.prototype=Object.create(cf.prototype);af.prototype.constructor=af;
af.prototype.kd=function(e){var f=new THREE.Matrix4;f.copy(this.target.matrixWorld);var g=new THREE.Matrix4;g.getInverse(f);var f=new THREE.Vector3(g.elements[0],g.elements[1],g.elements[2]),h=new THREE.Vector3(g.elements[4],g.elements[5],g.elements[6]),k=(new THREE.Vector3).crossVectors(f,h),g=new THREE.Matrix4;Xd(g,e/1E3*this.speed*2*Math.PI,h.x,h.y,h.z);e=new THREE.Matrix4;Xd(e,0,f.x,f.y,f.z);f=new THREE.Matrix4;Xd(f,0,k.x,k.y,k.z);k=new THREE.Matrix4;k=f.multiply(e).multiply(g);g=(new THREE.Matrix4).multiply(this.bj).multiply(k).multiply(this.Dh);
this.target.matrix.copy(this.target.matrix.multiply(g))};af.prototype.stop=function(){this.duration=0};function lf(e,f,g,h){cf.call(this);this.duration=g;this.scene3D=f;this.text=e;this.position=h}lf.prototype=Object.create(cf.prototype);lf.prototype.constructor=lf;lf.prototype.kd=function(e){this.Oa+=e;this.Oa>=this.duration&&(this.scene3D.zd[this.position]=void 0,this.scene3D.uc.remove(this.text),this.scene3D.renderer.render(this.scene3D.uc,this.scene3D.Kd))};
function mf(e,f){nf.call(this,e,f);(this.Ai="getGamepads"in navigator)||console.warn("Gamepad API not supported, you can't use any 3D device to control BiovizJS");var g=this;this.te=new fa;this.kb=null;this.oh=this.nh=this.sh=this.th=!1;window.addEventListener("gamepadconnected",function(e){of(g,e.kb)});window.addEventListener("gamepaddisconnected",function(e){e=e.kb;console.log("Gamepad disconnected at index %d: %s.",e.index,e.id);g.kb.index==e.index&&(g.kb=null);g.te.remove(e.index)});this.lk="GamepadEvent"in
window;var h=window.chrome,k=window.navigator.vendor,l=-1<window.navigator.userAgent.indexOf("OPR"),n=-1<window.navigator.userAgent.indexOf("Edge");this.Dk=null!==h&&void 0!==h&&"Google Inc."===k&&0==l&&0==n}mf.prototype=Object.create(nf.prototype);mf.prototype.constructor=mf;
mf.prototype.update=function(){if(this.Ai){if(!this.lk||this.Dk)for(var e=navigator.getGamepads(),f=0;f<e.length;f++){var g=e[f];g&&(this.te.Dc(g.index)?this.te.set(g.index,g):of(this,g))}if(null!=this.kb){(e=this.kb.buttons[0])&&e.pressed?this.nh||(this.th=!this.th,this.nh=!0):this.nh=!1;(e=this.kb.buttons[1])&&e.pressed?this.oh||(this.sh=!this.sh,this.oh=!0):this.oh=!1;var e=this.kb.axes[0]*pf,f=this.kb.axes[1]*pf,g=this.kb.axes[2]*pf,h=this.kb.axes[3]*qf,k=this.kb.axes[4]*qf,l=this.kb.axes[5]*
qf;if(0!==e||0!==f||0!==g||0!==h||0!==k||0!==l)this.sh||this.scene3D.ba.rotate(-l,h,k),this.th||this.scene3D.ba.translate(e,-g,f)}}};function of(e,f){console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",f.index,f.id,f.buttons.length,f.axes.length);f.vb=function(){return this.index+":"+this.id};e.te.set(f.index,f);if(null==e.kb||f.id===te().af)e.kb=f}
function nf(e,f){this.scene3D=e;this.domElement=f;this.Ea=new THREE.Vector3;this.ta=new THREE.Vector3;this.da=new THREE.Vector3;this.za=new THREE.Vector3;this.fa=new THREE.Vector3;this.aa=new THREE.Vector3;this.maxDistance=Infinity}var Ze=.4,qf=.1,pf=1.5;
function yf(e,f){nf.call(this,e,f);this.u={NONE:-1,dd:0,fe:1,ce:2,ge:3};this.v=this.u.NONE;var g=this,h;this.rh=!1;this.mousedown=function(e){dd(g.scene3D.ba.ca);h=e.timeStamp;zf(!1);if(g.v===g.u.NONE)g.v=e.button;else if(g.v===g.u.dd||g.v===g.u.ce)g.v=g.u.ge;g.v===g.u.dd?g.Ea=g.za=Af(g,e.clientX,e.clientY):g.v===g.u.fe||g.v===g.u.ge?g.ta=g.fa=Af(g,e.clientX,e.clientY):g.da=g.aa=Af(g,e.clientX,e.clientY)};this.mouseup=function(e){zf(!0);g.v=g.u.NONE;h=e.timeStamp-h;if(300>h&&5>Math.abs(g.aa.x-g.da.x)&&
5>Math.abs(g.aa.y-g.da.y)){var f=[],n;for(n in g.scene3D.ka)f=f.concat(Bf(g.scene3D.ka[n]));var r=e.offsetX/$("#content").width()*2-1,q=2*-(e.offsetY/$("#content").height())+1,f=Qd(g.scene3D,f,r,q);if(2==e.button)n=g.scene3D.ba.ca,e={target:null!=f?f:null,pageX:e.pageX,pageY:e.pageY},n.contextMenu.menu.getMenu()[0].parentElement!==n.Ug[0]?(e.Oi=!0,f=n.ti.offset(),e.pageX+=f.left,e.pageY+=f.top):e.Oi=!1,n.contextMenu.div.contextmenu("open",n.Lj,e);else if(0==e.button){for(n in g.callback)g.callback[n](f);
if(null!=f&&g.rh&&(e=g.scene3D,f!=e.ke)){if(e.ba.Xa!==e)throw"In order to measure, you must have the scene as camera target";n=f.mb().ea;r=n.Ec();q=je(e.ba,r.sa(),n.type,n.id)[0];void 0!=e.ke&&(je(e.ba,r.sa(),n.type,n.id),e.jc=e.ke.pos.clone(),e.jc.applyMatrix4(q.matrixWorld),e.jc.applyMatrix4((new THREE.Matrix4).getInverse(e.scene.matrixWorld)));e.jc?e.jd||(e.jd=f.pos.clone(),e.jd.applyMatrix4(q.matrixWorld),e.jd.applyMatrix4((new THREE.Matrix4).getInverse(e.scene.matrixWorld)),f=new THREE.Geometry,
f.vertices.push(e.jc),f.vertices.push(e.jd),f.computeLineDistances(),n=new THREE.LineDashedMaterial({color:16760576,dashSize:.7,gapSize:.3,linewidth:1.5}),f=new THREE.Line(f,n),e.scene.add(f),n=e.jc.distanceTo(e.jd).toFixed(2),n=Ae(n),n=new THREE.SpriteMaterial({map:n}),n.depthTest=!1,n.depthWrite=!1,r=new THREE.Sprite(n),q=(new THREE.Vector3).addVectors(e.jc,e.jd).multiplyScalar(.5),r.position.set(q.x,q.y,q.z),r.scale.set(n.map.image.width/40,n.map.image.height/40,1),e.scene.add(r),e.Ze.push(f),
e.Ze.push(r),e.jc=null,e.jd=null):(e.jc=f.pos.clone(),e.jc.applyMatrix4(q.matrixWorld),e.jc.applyMatrix4((new THREE.Matrix4).getInverse(e.scene.matrixWorld)))}}}};this.Ic=function(e){e.preventDefault()};this.mousemove=function(e){if(g.v===g.u.NONE){var f=[],h;for(h in g.scene3D.ka)f=f.concat(Bf(g.scene3D.ka[h]));h=e.offsetX/$("#content").width()*2-1;e=2*-(e.offsetY/$("#content").height())+1;f=Qd(g.scene3D,f,h,e);e=null;null!=f&&(e=f.jk());g.scene3D.ba.Pg(e)}else g.v===g.u.dd?g.za=Af(g,e.clientX,e.clientY):
g.v===g.u.fe||g.v===g.u.ge?g.fa=Af(g,e.clientX,e.clientY):g.v===g.u.ce&&(g.aa=Af(g,e.clientX,e.clientY))};this.pc=function(e){e.preventDefault();e.stopPropagation();!0===e.ctrlKey?Cf(g.scene3D,g.scene3D.$g+.05*e.deltaY):g.scene3D.ba.translate(0,0,-e.deltaY*e.deltaFactor*Ze)};this.update=function(){if(g.v!==g.u.NONE)if(g.v===g.u.dd){var e=.025*(this.za.x-this.Ea.x),f=.025*(this.za.y-this.Ea.y);g.scene3D.ba.rotate(e,f,0);this.Ea=this.za}else g.v===g.u.fe||g.v===g.u.ge?(e=this.fa.y-this.ta.y,e=this.v===
this.u.ge?2*e:e*Ze,g.scene3D.ba.translate(0,0,1*e),this.ta=this.fa):g.v===g.u.ce&&(e=.2*(this.aa.x-this.da.x),f=.2*(this.aa.y-this.da.y),g.scene3D.ba.translate(e,-f,0),this.da=this.aa)};this.callback=[];this.Ci=function(e){this.callback.push(e)};this.Zi=function(){this.callback=[]};this.xb=function(e){var f=[],h;for(h in g.scene3D.ka)f=f.concat(Bf(g.scene3D.ka[h]));h=e.offsetX/$("#content").width()*2-1;var r=2*-(e.offsetY/$("#content").height())+1,f=Qd(g.scene3D,f,h,r);null!==f?(f=g.scene3D.ba.ab(f.mb().ea.Ec().sa())[0],
!0===e.ctrlKey&&(g.scene3D.ba.Xa=f),g.scene3D.ba.Ja=f,Ge(g.scene3D.ba)):(g.scene3D.ba.Xa=g.scene3D,g.scene3D.ba.Ja=null)};$(this.domElement).on("mousemove",this.mousemove);$(this.domElement).on("mousedown",this.mousedown);$(this.domElement).on("mouseup",this.mouseup);$(document.body).on("dragstart ondrop",function(){return!1});$(this.domElement).on("click",function(){clearTimeout(void 0)});$(this.domElement).on("dblclick",function(e){e.preventDefault();e.stopPropagation();clearTimeout(void 0);g.xb(e);
return!1});$(this.domElement).on("contextmenu",this.Ic);$(this.domElement).on("mousewheel",this.pc)}yf.prototype=Object.create(nf.prototype);yf.prototype.constructor=yf;function Af(e,f,g){e=e.domElement.getBoundingClientRect();return{x:f-e.left,y:g-e.top}}
function Df(e,f){nf.call(this,e,f);this.u={NONE:-1,dd:0,fe:1,ce:2,ge:3};this.v=this.u.NONE;var g=this,h=new Hammer.Manager(this.domElement),k=new Hammer.Swipe({direction:Hammer.DIRECTION_ALL}),l=new Hammer.Pan({direction:Hammer.DIRECTION_ALL,pointers:0,threshold:50}),n=new Hammer.Pinch({enable:!0,threshold:.3}),r=new Hammer.Tap({enable:!0});h.add(k);h.add(l);h.add(n);h.add(r);l.recognizeWith(k);this.xb=function(e){if(g.v===g.u.NONE&&"mouse"!==e.pointerType)switch(e.type){case "panstart":if(.5<Math.abs(e.velocity)||
0===e.velocity)break;var f=e.center;g.da={x:f.x,y:f.y};g.aa={x:f.x,y:f.y};g.v=1===e.pointers.length?g.u.dd:g.u.ce;break;case "pinchstart":g.ta=e.scale;g.fa=e.scale;g.v=g.u.fe;break;case "swipeup":g.scene3D.ba.ca.ad.show();break;case "swipeleft":g.scene3D.ba.ca.Mk.show(!0);break;case "swiperight":g.scene3D.ba.ca.Fj.show();break;case "swipedown":g.scene3D.ba.ca.ad.hide(),g.scene3D.ba.ca.Mk.show(!1),g.scene3D.ba.ca.Fj.hide()}};this.za=function(){g.v=g.u.NONE};this.Ea=function(e){if("mouse"!==e.pointerType)switch(e.type){case "panmove":e=
g.v===g.u.dd?{x:e.pointers[0].clientX,y:e.pointers[0].clientY}:e.center;g.aa={x:e.x,y:e.y};break;case "pinchmove":g.fa=e.scale}};this.update=function(){if(this.v!==this.u.NONE)if(this.v===this.u.dd){var e=.0125*(this.aa.x-this.da.x),f=.0125*(this.aa.y-this.da.y);this.scene3D.ba.rotate(e,f,0);this.da=this.aa}else this.v===this.u.fe?(this.scene3D.ba.translate(0,0,30*(this.fa-this.ta)),this.ta=this.fa):this.v===this.u.ce&&(e=.1*(this.aa.x-this.da.x),f=.1*(this.aa.y-this.da.y),this.scene3D.ba.translate(e,
-f,0),this.da=this.aa)};h.on("panstart pinchstart swipeleft swiperight swipeup swipedown press tap",this.xb);h.on("panend pinchend",this.za);h.on("panmove pinchmove",this.Ea)}Df.prototype=Object.create(nf.prototype);Df.prototype.constructor=Df;function Ef(e){this.Da=e;this.oa=this.Da.oa;this.Aa=this.Da.qa;this.parent=this.Da;this.ra=te();this.ra.subscribe(this);this.visible=!0;this.ga=null;this.u=[];this.v=null}z=Ef.prototype;
z.Ua=function(){throw"This method must be defined by childrens of Representation";};z["delete"]=function(){var e=this.ra;void 0!==this.update&&e.Vd.splice(e.Vd.indexOf(this));null!=this.ga&&(this.parent.remove(this.ga),this.ga.geometry.dispose(),this.ga.material.dispose())};z.yd=function(){this.Da instanceof Ff?this.color(Gf.Va):this.Da instanceof Hf?this.color(Gf.Gb):this.color(Gf.Va)};
z.tb=function(e,f){null==this.ga&&(this.show(),this.hide());var g=this.ga.geometry.attributes.highlight;if(null!=g){var h=e?1:0,k=g.array.slice();if(null!=f){for(var l=[],n=this.ga.geometry.attributes.atomIndex.array,r=0;r<f.length;r++)l.push(this.oa.indexOf(f[r]));for(var r=g.count,q=0;q<r;q++)-1!==l.indexOf(n[q])&&(k[q]=h)}else k.fill(h);g.set(k);g.needsUpdate=!0}};z.show=function(){null===this.ga&&this.Ua();null!==this.ga&&(this.visible=this.ga.visible=!0)};
z.hide=function(){null!==this.ga&&(this.visible=this.ga.visible=!1)};
z.color=function(e){this.v=e;if("string"===typeof e){var f,g;switch(e){case "white":If(this,1,1,1);break;case "black":If(this,0,0,0);break;case "grey":If(this,.5,.5,.5);break;case "lightgrey":If(this,.7,.7,.7);break;case "darkgrey":If(this,.3,.3,.3);break;case "red":If(this,1,0,0);break;case "darkred":If(this,.5,0,0);break;case "lightred":If(this,1,.5,.5);break;case "green":If(this,0,1,0);break;case "darkgreen":If(this,0,.5,0);break;case "lightgreen":If(this,.5,1,.5);break;case "blue":If(this,0,0,
1);break;case "darkblue":If(this,0,0,.5);break;case "lightblue":If(this,.5,.5,1);break;case "yellow":If(this,1,1,1);break;case "darkyellow":If(this,.5,.5,0);break;case "lightyellow":If(this,1,1,.5);break;case "cyan":If(this,0,1,1);break;case "darkcyan":If(this,0,.5,.5);break;case "lightcyan":If(this,.5,1,1);break;case "magenta":If(this,1,0,1);break;case "darkmagenta":If(this,.5,0,.5);break;case "lightmagenta":If(this,1,.5,1);break;case "orange":If(this,1,.5,0);break;case "darkorange":If(this,.5,.25,
0);break;case "lightorange":If(this,1,.75,.5);break;default:"#"==e.substring(0,1)?(e=e.replace("#",""),e=[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)],f=e[0],g=e[1],e=e[2],If(this,f,g,e)):"rgb("==e.substring(0,4)&&(e=e.replace("rgb(",""),e=e.replace(")",""),e=e.split(","),f=e[0],g=e[1],e=e[2],If(this,f,g,e))}}else{a:{for(f in Gf)if(Gf[f]===e){f=!0;break a}f=!1}if(f){if(null!==this.ga)if(f=this.ga.geometry,f instanceof THREE.BufferGeometry){g=f.attributes.color.array;
for(var h=f.attributes.atomIndex.array.length,k=0;k<h;k++){var l;l=e;var n=k;null==this.u[l.id]&&(this.u[l.id]=Jf(this,l));l=this.u[l.id][n];void 0!=l&&(g[3*k]=l.r,g[3*k+1]=l.g,g[3*k+2]=l.b);f.attributes.color.needsUpdate=!0}}else console.warn("Unknown type of geometry for coloring by atom ",f)}else f=e[0],g=e[1],e=e[2],If(this,f,g,e)}};
function Jf(e,f){var g=e.u,h=f.id,k;if(f===Gf.wg){var l=[];e.Da instanceof Ff?l=e.Da.ea.xa():e.Da instanceof Hf?l=e.Da.Cb.xa():e.Da instanceof Kf&&(l=[e.Da.Ll]);k=new fa;for(var n=l.length,r=0;r<n;r++)k.set(l[r],(new THREE.Color).setHSL(r/n*.8,1,.42));if(null!==e.ga){r=e.ga.geometry;l=[];if(r instanceof THREE.BufferGeometry)for(n=r.attributes.atomIndex.array,r=0;r<n.length;r++){var q=k.get(e.oa[n[r]]);l.push(q)}else console.warn("Unknown type of geometry for mapping by rainbow ",r);k=l}else k=void 0}else if(f===
Gf.ug)if(e.Da instanceof Ff?e.Da.ea.xa():e.Da instanceof Hf&&e.Da.Cb.xa(),n=e.ga.geometry,k=[],r="IVLFCMAGTWSYPHEZQDBNKR".split(""),l=[45,42,38,28,25,19,18,-4,-7,-9,-8,-13,-16,-32,-35,-35,-35,-35,-35,-35,-39,-45],null!=e.ga)for(n=n.attributes.atomIndex.array,q=0;q<n.length;q++){var t=null,t=e.oa[n[q]].mb();if("Peptide"==t.type||"Protein"==t.type||"Small Peptide"==t.type){var x;for(x=0;x<r.length&&r[x]!=t.Di().toUpperCase();x++);x==r.length?t=new THREE.Color(1,1,1):(t=l[x],t=0<t?new THREE.Color(1,
1-t/45,1-t/45):new THREE.Color(1-t/-45,1-t/-45,1))}else t=new THREE.Color(1,1,1);k.push(t)}else k=void 0;else if(null!==e.ga){k=e.ga.geometry.attributes.atomIndex.array;r=k.length;l=[];for(n=0;n<r;n++){var q=e,t=k[n],w=x=x=x=void 0,w=void 0;switch(f){case Gf.Vb:x=q.oa[t].mb().ea.id.toUpperCase();x=ye(q.ra,x,"M");break;case Gf.Gb:x=q.oa[t].mb().Vc().toUpperCase();x=ye(q.ra,x,"R");break;case Gf.Va:w=q.oa[t];w=w.symbol.charAt(0).toUpperCase()+w.symbol.slice(1).toLowerCase();x=ye(q.ra,w,"A");break;case Gf.sg:w=
q.oa[t];"C"===w.symbol&&(w=w.symbol.charAt(0).toUpperCase()+w.symbol.slice(1).toLowerCase(),x=ye(q.ra,w,"A"));break;case Gf.tg:w=q.oa[t];"C"!==w.symbol&&(w=w.symbol.charAt(0).toUpperCase()+w.symbol.slice(1).toLowerCase(),x=ye(q.ra,w,"A"));break;case Gf.yg:w=q.oa[t],x=ye(q.ra,w.mb().ob.name,"SST")}l.push(x)}k=l}else k=void 0;g[h]=k;return e.u[f.id]}
function If(e,f,g,h){1<f&&(f=f/255);1<g&&(g=g/255);1<h&&(h=h/255);if(null!==e.ga)if(e=e.ga.geometry,e instanceof THREE.BufferGeometry){for(var k=e.attributes.color.array,l=k.length/3,n=0;n<l;n++)k[3*n]=f,k[3*n+1]=g,k[3*n+2]=h;e.attributes.color.needsUpdate=!0}else console.warn("Unknown type of geometry for coloring by atom ",e)}z.ig=function(e,f,g,h){if(null!==this.ga)if(void 0===h)If(this,e,f,g);else return h=new jf(h,this),h.ig(e,f,g),h;return null};
z.lf=function(e,f){if(null!==this.ga)if(void 0===f)this.color(e);else{var g=Jf(this,e),h=new jf(f,this);h.lf(g);return h}return null};z.hg=function(e,f){if(null!==this.ga)if(void 0===f||0===f)this.ga.material.transparent=!0,this.ga.material.opacity=e;else return new hf(e,f,this);return null};z.update=function(e){if(e.lj){e=e.Jj;if(void 0!==e){if("Amino Acids"===e||"Nucleic Acids"===e)e=Gf.Gb;this.u[e]=null}else this.u=[];this.color(this.v)}};
var Gf={Vb:{name:"Molecules",id:"molecule"},Gb:{name:"Residues",id:"residue"},Va:{name:"Atoms",id:"atom"},sg:{name:"Carbon atom",id:"carbon"},tg:{name:"Hetero atom",id:"heteroatom"},yg:{name:"Secondary Structure Type",id:"sse"},wg:{name:"Rainbow",id:"rainbow"},ug:{name:"Hydrophobicity",id:"hydrophobicity"},gk:function(){var e=[],f;for(f in this){var g=this[f];this.hasOwnProperty(f)&&"object"===typeof g&&e.push(g.name)}return e},ek:function(e){for(var f in this)if(this[f].id===e)return this[f];return null},
fk:function(e){for(var f in this)if(this[f].name===e)return this[f];return null}};function Lf(e,f,g){this.name=e;this.Kj=f;this.Ha=g;var h=arguments.length-3;1<=h&&(this.Kk=arguments[3]);2<=h&&(this.xl=arguments[4])}var P={};P.NONE=new Lf("","NONE",null);P.Tf=function(e){for(var f in P)if(P[f].Kj===e)return P[f]};var Mf=Object;
Mf.Wj=function(e,f){for(var g=null,h=Nf(e),k=h.length,l=0;l<k;l++)g=h[l],g.bb=!1,g.alpha=THREE.GeometryUtils.pl(g.a,g.b,g.c,g.d),g.Gc=g.alpha>f;for(var n=new fa,h=Nf(e),k=h.length,l=0;l<k;l++){for(var g=h[l],r=[],q=Of(g),t=0;4>t;t++){var x=Pf(g,t);r.push(Mf.Ak(g,x[3],q[t],x[0],x[1],x[2],f))}n.set(g,r)}x=[];h=Nf(e);k=h.length;for(l=0;l<k;l++)if(g=h[l],g.bb=!1,g.Gc=!1,null==g.wb||null==g.zb||null==g.Ab||null==g.Bb){q=Of(g);r=n.get(g);for(t=0;4>t;t++)null!=q[t]||r[t]||(g.Gc=!0);g.Gc&&x.push(g)}for(;0!==
x.length;)for(l=x[x.length-1],x.splice(x.length-1),l.bb=!0,l.Gc=!0,q=Of(l),r=n.get(l),t=0;4>t;t++)null==q[t]||q[t].bb||r[t]||x.push(q[t]);h=Nf(e);k=h.length;for(l=0;l<k;l++)if(g=h[l],g.bb=!1,!g.Gc)for(q=Of(g),r=n.get(g),t=0;4>t;t++)null==q[t]||q[t].Gc||(r[t]=!1);return n};
Mf.Mj=function(e,f,g){g=Mf.Wj(f,g);f=Nf(f);for(var h=[],k=Array(3),l=f.length,n=0;n<l;n++){for(var r=f[n],q=Of(r),t=g.get(r),q=q.length,x=0;x<q;x++)if(t[x]){for(var w=Pf(r,x),C=0;3>C;C++){var F=w[C],G=h.indexOf(F);-1===G&&(G=h.push(F)-1,Td(e,F.x,F.y,F.z));k[C]=G}r.Gc?Ud(e,k[2],k[1],k[0]):Ud(e,k[0],k[1],k[2])}r.bb=!0}return h};
Mf.Ak=function(e,f,g,h,k,l,n){if(null==e)throw"!!";var r=e.Gc,q=null==g||g.Gc;return r!=q||r&&q&&(null==g||0<THREE.GeometryUtils.Gi(h,k,l,Qf(e,g)))&&0<THREE.GeometryUtils.Gi(h,k,l,f)&&n>=THREE.GeometryUtils.rl(h,k,l)?!0:!1};function Rf(){this.Wi=1.4;this.alpha=0;this.mi=new fa}function Sf(){this.Aa=[];this.yi=[];this.Of=0}function Tf(e){return e.Aa.length-e.Of}function Uf(e,f,g){THREE.Vector3.call(this);this.ph=!0;this.x=e;this.y=f;this.z=g;this.radius=this.weight=1;this.yb=[]}
Uf.prototype.set=function(e,f){this.weight=e;this.radius=f};Uf.prototype.toString=function(){return this.x+":"+this.y+":"+this.z};Uf.prototype.vb=function(){return this.x+":"+this.y+":"+this.z};function Vf(e,f,g,h){for(var k=e.yb.length,l=0;l<k;l++){var n=e.yb[l];if(Wf(n,g)&&Wf(n,h)&&n!=f)return n}return null}Uf.prototype.remove=function(){for(var e=[],f=this.yb.length,g=0;g<f;g++)e.push(this.yb[g]);f=e.length;for(g=0;g<f;g++)e[g].disconnect()};
function Xf(){this.oi=this.Cc=this.md=this.fc=this.max=this.min=null;this.bf=0;this.Bc=[];this.Jd=[];this.Wa=[];this.iterator=null;this.Lk=0}Xf.prototype.toString=function(){return"Tesselation"};function Yf(e,f){var g=Math.trunc((f.x-e.min.x)*e.fc/(e.max.x-e.min.x)),h=Math.trunc((f.y-e.min.y)*e.md/(e.max.y-e.min.y)),k=Math.trunc((f.z-e.min.z)*e.Cc/(e.max.z-e.min.z));0>g&&(g=0);g>=e.fc&&(g=e.fc-1);0>h&&(h=0);h>=e.md&&(h=e.md-1);0>k&&(k=0);k>=e.Cc&&(k=e.Cc-1);return g+h*e.fc+k*e.fc*e.Cc}
function Zf(e,f,g){f.Le=!0;e.Jd.push(f);var h=f.wb;null==h||void 0===h||h.bb||(h.bb=!0,0<$f(h,g)&&Zf(e,h,g));h=f.zb;null==h||void 0===h||h.bb||(h.bb=!0,0<$f(h,g)&&Zf(e,h,g));h=f.Ab;null==h||void 0===h||h.bb||(h.bb=!0,0<$f(h,g)&&Zf(e,h,g));h=f.Bb;null==h||void 0===h||h.bb||(h.bb=!0,0<$f(h,g)&&Zf(e,h,g))}
function ag(e,f){f.bb=!1;var g;g=f.wb;null!=g&&void 0!==g&&g.bb&&ag(e,g);g=f.zb;null!=g&&void 0!==g&&g.bb&&ag(e,g);g=f.Ab;null!=g&&void 0!==g&&g.bb&&ag(e,g);g=f.Bb;null!=g&&void 0!==g&&g.bb&&ag(e,g)}function Nf(e){var f=0;e.iterator=new bg(e);for(var g=[];null!=e.iterator.Sa;){var h=e.iterator.next();void 0!==h&&g.push(h);f++}return g}
function bg(e){this.Ad=e;this.Fb=this.Hb=0;for(this.Sa=this.Ad.Bc[this.Hb];this.Hb<this.Ad.bf&&(null==this.Sa||void 0==this.Sa||0==Tf(this.Sa));)this.Hb++,this.Sa=this.Hb<this.Ad.bf?this.Ad.Bc[this.Hb]:null;if(null!=this.Sa&&void 0!=this.Sa)for(;this.Fb<this.Sa.Aa.length&&(null==this.Sa.Aa[this.Fb]||void 0==this.Sa.Aa[this.Fb]);)this.Fb++}
bg.prototype.next=function(){var e=this.Ad.Bc[this.Hb].Aa[this.Fb];for(this.Fb++;this.Fb<this.Sa.Aa.length&&(null==this.Sa.Aa[this.Fb]||void 0===this.Sa.Aa[this.Fb]);)this.Fb++;if(this.Fb>=this.Sa.Aa.length){this.Fb=0;for(this.Hb++;this.Hb<this.Ad.bf;){this.Sa=this.Ad.Bc[this.Hb];if(null!==this.Sa&&void 0!==this.Sa&&0<Tf(this.Sa))break;this.Hb++}this.Hb>=this.Ad.bf&&(this.Sa=null)}if(null!=this.Sa&&void 0!=this.Sa)for(;this.Fb<this.Sa.Aa.length&&null==this.Sa.Aa[this.Fb];)this.Fb++;return e};
function cg(){this.bb=!1;this.Gc=null;this.alpha=-1;this.Le=!1;this.box=this.d=this.c=this.b=this.a=this.zh=null;this.Hb=-1;this.id=this.Bb=this.Ab=this.zb=this.wb=null}cg.prototype.toString=function(){return this.zh+":"+this.id};cg.prototype.vb=function(){return this.zh+":"+this.id};
cg.prototype.set=function(e,f,g,h,k,l){this.zh=e;this.a=f;this.b=g;this.c=h;this.d=k;this.Le=!1;this.id=e.Lk++;var n=new THREE.Vector3((this.a.x+this.b.x+this.c.x+this.d.x)/4,(this.a.y+this.b.y+this.c.y+this.d.y)/4,(this.a.z+this.b.z+this.c.z+this.d.z)/4),n=Yf(e,n);if(void 0===e.Bc[n]||null===e.Bc[n])e.Bc[n]=new Sf;e=e.Bc[n];this.box=e;e=this.box;n=0<e.Of?e.yi[--e.Of]:e.Aa.length;e.Aa[n]=this;this.Hb=n;f.yb.push(this);g.yb.push(this);h.yb.push(this);k.yb.push(this);null!=l?this.wb=l:this.wb=Vf(this.a,
this,this.b,this.c);null!=this.wb&&dg(this.wb,this.a,this.b,this.c,this);this.zb=Vf(this.a,this,this.c,this.d);null!=this.zb&&dg(this.zb,this.a,this.c,this.d,this);this.Ab=Vf(this.a,this,this.d,this.b);null!=this.Ab&&dg(this.Ab,this.a,this.d,this.b,this);this.Bb=Vf(this.b,this,this.d,this.c);null!=this.Bb&&dg(this.Bb,this.b,this.d,this.c,this)};
function $f(e,f){var g=e.a.x-f.x,h=e.a.y-f.y,k=e.a.z-f.z,l=e.b.x-f.x,n=e.b.y-f.y,r=e.b.z-f.z,q=e.c.x-f.x,t=e.c.y-f.y,x=e.c.z-f.z,w=e.d.x-f.x,C=e.d.y-f.y,F=e.d.z-f.z;return-THREE.GeometryUtils.sign(THREE.GeometryUtils.Tj(g,h,k,g*g+h*h+k*k+(f.weight-e.a.weight),l,n,r,l*l+n*n+r*r+(f.weight-e.b.weight),q,t,x,q*q+t*t+x*x+(f.weight-e.c.weight),w,C,F,w*w+C*C+F*F+(f.weight-e.d.weight)))}
function dg(e,f,g,h,k){if(f===e.a||g===e.a||h===e.a)if(f===e.c||g===e.c||h===e.c)f===e.b||g===e.b||h===e.b?e.wb=k:e.zb=k;else{if(f!==e.d&&g!==e.d&&h!==e.d)throw"This tetrahedron doesn't have the right vertices";e.Ab=k}else if(f===e.b||g===e.b||h===e.b)e.Bb=k;else throw"This tetrahedron doesn't have the right vertices - ("+f+"),("+g+"),("+h+") - ("+a+"),("+b+"),("+c+"),("+d+")";}function Of(e){var f=[];f.push(e.wb);f.push(e.zb);f.push(e.Ab);f.push(e.Bb);return f}
function Pf(e,f){if(0==f)return[e.c,e.b,e.a,e.d];if(1==f)return[e.d,e.c,e.a,e.b];if(2==f)return[e.b,e.d,e.a,e.c];if(3==f)return[e.c,e.d,e.b,e.a];throw"i :"+f+" not between 0 and 3";}function Wf(e,f){return e.a.x===f.x&&e.a.y===f.y&&e.a.z===f.z||e.b.x===f.x&&e.b.y===f.y&&e.b.z===f.z||e.c.x===f.x&&e.c.y===f.y&&e.c.z===f.z||e.d.x===f.x&&e.d.y===f.y&&e.d.z===f.z}
cg.prototype.disconnect=function(){var e=this.box,f=this.Hb;e.Aa[f]=null;e.yi[e.Of++]=f;null!=this.wb&&dg(this.wb,this.a,this.b,this.c,null);null!=this.zb&&dg(this.zb,this.a,this.c,this.d,null);null!=this.Ab&&dg(this.Ab,this.a,this.d,this.b,null);null!=this.Bb&&dg(this.Bb,this.b,this.d,this.c,null);this.a.yb.splice(this.a.yb.indexOf(this),1);this.b.yb.splice(this.b.yb.indexOf(this),1);this.c.yb.splice(this.c.yb.indexOf(this),1);this.d.yb.splice(this.d.yb.indexOf(this),1);this.Bb=this.Ab=this.zb=this.wb=
this.d=this.c=this.b=this.a=null};function Qf(e,f){if(f.wb==e)return f.d;if(f.zb==e)return f.b;if(f.Ab==e)return f.c;if(f.Bb==e)return f.a;throw"getOtherVertex: Tetrahedra "+e+" and "+f+" not touching";}function eg(e,f){Ef.call(this,e);this.wireframe=f;this.ra.subscribe(this)}eg.prototype=Object.create(Ef.prototype);eg.prototype.constructor=eg;P.uf=new Lf("Alpha Shape","ASHAPE",eg,!1);P.qg=new Lf("Alpha Shape Wireframe","ASHAPEM",eg,!0);
eg.prototype.Ua=function(){var e=De(),f=null;if(this.wireframe)e.wireframe=!0,e.wireframeLinewidth=2,f=fg(this.Da,P.uf),null===f.ga&&(f.Ua(),f.hide()),f=f.ga.geometry.clone();else{e.side=THREE.DoubleSide;e.shading=THREE.FlatShading;for(var f=new Rf,g=this.oa,h=[],k=g.length,l=0;l<k;l++){var n=g[l];f.mi.set(n.pos,n);var r=Ce(te(),n),q=(r+f.Wi)*(r+f.Wi),n=new Uf(n.pos.x,n.pos.y,n.pos.z);n.set(q,r);h.push(n)}n=new Xf;if(4>h.length)throw"Too few points to tesselate";n.min=new THREE.Vector3(Infinity,Infinity,
Infinity);n.max=new THREE.Vector3(-Infinity,-Infinity,-Infinity);k=h.length;for(l=0;l<k;l++)r=h[l],n.min.x=Math.min(n.min.x,r.x),n.min.y=Math.min(n.min.y,r.y),n.min.z=Math.min(n.min.z,r.z),n.max.x=Math.max(n.max.x,r.x),n.max.y=Math.max(n.max.y,r.y),n.max.z=Math.max(n.max.z,r.z);var q=(n.min.x+n.max.x)/2,t=(n.min.y+n.max.y)/2,x=(n.min.z+n.max.z)/2,w=n.min.distanceTo(n.max);n.fc=8;n.md=8;n.Cc=8;n.oi=Math.max(n.fc,Math.max(n.md,n.Cc));n.bf=n.fc*n.md*n.Cc;k=new Uf(q-w,t-w,x-w);l=new Uf(q+w,t+w,x-w);r=
new Uf(q-w,t+w,x+w);q=new Uf(q+w,t-w,x+w);(new cg).set(n,k,l,r,q,null);t=h.length;for(x=0;x<t;x++){var w=n,C=h[x];w.Jd=[];var F=!1,G=w.Bc[Yf(w,C)];if(void 0!==G&&null!==G){var I=void 0;for(I in G.Aa){var D=G.Aa[I];if(null!=D){var K=$f(D,C);0===K&&console.warn(">1 point on the same power sphere");if(null!==D&&void 0!==D&&0<K){D.bb=!0;Zf(w,D,C);ag(w,D);F=!0;break}}}}if(!F)for(var G=!1,K=Math.trunc((C.x-w.min.x)*w.fc/(w.max.x-w.min.x)),H=Math.trunc((C.y-w.min.y)*w.md/(w.max.y-w.min.y)),L=Math.trunc((C.z-
w.min.z)*w.Cc/(w.max.z-w.min.z)),F=1;F<w.oi&&!G;F++)for(var O=-F;O<=F&&!G;O++)for(var S=-F;S<=F&&!G;S++)for(var X=-F;X<=F&&!G;X++)if(Math.abs(X)==F||Math.abs(S)==F||Math.abs(O)==F){var D=K+X,pa=H+S,na=L+O;if(!(0>D||D>=w.fc||0>pa||pa>=w.md||0>na||na>=w.Cc)&&(D=w.Bc[Math.trunc(D+pa*w.fc+na*w.fc*w.Cc)],null!=D))for(I in pa=D.Aa,pa)if(D=pa[I],null!=D&&void 0!=D&&0<$f(D,C)){D.bb=!0;Zf(w,D,C);ag(w,D);G=!0;break}}w.Wa=[];G=w.Jd.length;for(F=0;F<G;F++)D=w.Jd[F],null!=D.wb&&D.wb.Le||(w.Wa.push(D.wb),w.Wa.push(D.a),
w.Wa.push(D.b),w.Wa.push(D.c)),null!=D.zb&&D.zb.Le||(w.Wa.push(D.zb),w.Wa.push(D.a),w.Wa.push(D.c),w.Wa.push(D.d)),null!=D.Ab&&D.Ab.Le||(w.Wa.push(D.Ab),w.Wa.push(D.a),w.Wa.push(D.d),w.Wa.push(D.b)),null!=D.Bb&&D.Bb.Le||(w.Wa.push(D.Bb),w.Wa.push(D.b),w.Wa.push(D.d),w.Wa.push(D.c));for(F=0;F<G;F++)D=w.Jd[F],D.disconnect();D=0;G=w.Wa.length;for(F=0;F<G;F+=4)K=w.Wa[F],H=w.Wa[F+1],L=w.Wa[F+2],O=w.Wa[F+3],S=(new THREE.Vector3((H.x+L.x+O.x)/3,(H.y+L.y+O.y)/3,(H.z+L.z+O.z)/3)).sub(C),S=0>THREE.Vector3.u(H,
L,O).dot(S),X=D<w.Jd.length?w.Jd[D++]:new cg,S?X.set(w,H,L,O,C,K):X.set(w,O,L,H,C,K)}k.remove();l.remove();r.remove();q.remove();I=new Sd(!0);h=Mf.Mj(I,n,f.alpha);k=h.length;for(n=0;n<k;n++){l=h[n];r=f.mi.get(l);q=g.indexOf(r);if(void 0===r)throw"Couldn't get atom for position :"+l.x+", "+l.y+", "+l.z;I.Nc.push(q)}f=Vd(I);f.computeVertexNormals()}e=new THREE.Mesh(f,e);e.Ha=this;this.parent.add(e);this.ga=e;this.color(Gf.Va)};function gg(e){Ef.call(this,e)}gg.prototype=Object.create(Ef.prototype);
gg.prototype.constructor=gg;P.Bd=new Lf("Atoms","ATOMS",gg);
gg.prototype.Ua=function(){for(var e=new THREE.BufferGeometry,f=[],g=[],h=[],k=this.oa.length,l=0;l<k;l++){var n=this.oa[l],r=n.pos.clone();r.qa=n;r.x-=.5;var q=n.pos.clone();q.qa=n;q.x+=.5;var t=n.pos.clone();t.qa=n;t.y-=.5;var x=n.pos.clone();x.qa=n;x.y+=.5;var w=n.pos.clone();w.qa=n;w.z-=.5;var C=n.pos.clone();C.qa=n;C.z+=.5;f.push(r.x,r.y,r.z,q.x,q.y,q.z,t.x,t.y,t.z,x.x,x.y,x.z,w.x,w.y,w.z,C.x,C.y,C.z);for(n=0;18>n;n++)g.push(1);for(n=0;6>n;n++)h.push(l)}f=new Float32Array(f);g=new Float32Array(g);
h=new Float32Array(h);e.addAttribute("position",new THREE.BufferAttribute(f,3));g=new THREE.BufferAttribute(g,3);g.dynamic=!0;e.addAttribute("color",g);e.addAttribute("atomIndex",new THREE.BufferAttribute(h,1));e.sd();h=new THREE.LineBasicMaterial({linewidth:this.ra.gj,vertexColors:THREE.VertexColors});e=new THREE.LineSegments(e,h);e.Ha=this;this.parent.add(e);this.ga=e;this.yd()};gg.prototype.update=function(e){Ef.prototype.update.call(this,e);e.gj&&(this.parent.remove(this.ga),this.ga=null,this.Ua())};
function hg(e){Ef.call(this,e)}hg.prototype=Object.create(Ef.prototype);hg.prototype.constructor=hg;P.be=new Lf("Balls & sticks","BSTICKS",hg);
hg.prototype.Ua=function(){var e=ze(this.ra),f=De(),g=(new THREE.BufferGeometry).fromGeometry(e),h=this.oa.length,k=g.attributes.position.array.length/g.attributes.position.itemSize,l=h*k,n=fg(this.Da,P.ac);null===n.ga&&(n.Ua(),n.hide());for(var e=new THREE.BufferGeometry,n=n.ga.geometry,r=Array(3*l),q=Array(3*l),t=Array(3*l),x=Array(2*l),l=Array(l),w=0;w<h;w++){var C=this.oa[w],F=new THREE.Matrix4;F.setPosition(C.pos);C=g.clone();C.applyMatrix(F);for(var G=C.attributes.position.array,F=0;F<G.length;F++)r[w*
G.length+F]=G[F];G=C.attributes.normal.array;for(F=0;F<G.length;F++)q[w*G.length+F]=G[F];G=C.attributes.color.array;for(F=0;F<G.length;F++)t[w*G.length+F]=G[F];C=C.attributes.uv.array;for(F=0;F<C.length;F++)x[w*C.length+F]=C[F];for(F=0;F<k;F++)l[w*k+F]=w}g=new Float32Array(r);h=new Float32Array(q);t=new Float32Array(t);x=new Float32Array(x);l=new Float32Array(l);k=new Float32Array(g.length+n.attributes.position.array.length);k.set(n.attributes.position.array);k.set(g,n.attributes.position.array.length);
g=new Float32Array(h.length+n.attributes.normal.array.length);g.set(n.attributes.normal.array);g.set(h,n.attributes.normal.array.length);h=new Float32Array(t.length+n.attributes.color.array.length);h.set(n.attributes.color.array);h.set(t,n.attributes.color.array.length);t=new Float32Array(x.length+n.attributes.uv.array.length);t.set(n.attributes.uv.array);t.set(x,n.attributes.uv.array.length);x=new Float32Array(l.length+n.attributes.atomIndex.array.length);x.set(n.attributes.atomIndex.array);x.set(l,
n.attributes.atomIndex.array.length);e.addAttribute("position",new THREE.BufferAttribute(k,3));e.addAttribute("normal",new THREE.BufferAttribute(g,3));G=new THREE.BufferAttribute(h,3);G.dynamic=!0;e.addAttribute("color",G);e.addAttribute("uv",new THREE.BufferAttribute(t,2));e.addAttribute("atomIndex",new THREE.BufferAttribute(x,1));e.sd();f=new THREE.Mesh(e,f);f.Ha=this;this.parent.add(f);this.ga=f;this.yd()};
hg.prototype.update=function(e){Ef.prototype.update.call(this,e);e.bg&&(e=fg(this.Da,P.ac),e.parent.remove(e.ga),e.ga=null,this.parent.remove(this.ga),this.ga=null,this.Ua())};function ig(e){Ef.call(this,e)}ig.prototype=Object.create(Ef.prototype);ig.prototype.constructor=ig;P.Pe=new Lf("Cartoon","CARTOON",ig);ig.ta=.075;ig.fa=1.2;ig.da=.25;ig.xb=1.3;ig.Ea=.5;ig.aa=.175;ig.v=.175;ig.za=34;ig.pc=12;
ig.prototype.Ua=function(){var e=ye(this.ra,this.Da.ea.id,"M"),f=null;if(this.Aa.td()){var g=this.Aa;g.ki();var h=[],f=[];h.push(f);for(var k=g.ia,g=g.xa(),l=["N","CA","C"],n=null,r=k.length,q=0;q<r;q++){var t=k[q];if(null!==n){var x=0;isNaN(parseFloat(t.sa()))||(x+=parseFloat(t.sa()));isNaN(parseFloat(n.sa()))||(x-=parseFloat(n.sa()));isNaN(t.lb().charCodeAt(0))||(x+=t.lb().charCodeAt(0));isNaN(n.lb().charCodeAt(0))||(x-=n.lb().charCodeAt(0));1<x&&(f=[],h.push(f))}for(var w in l)if(n=t.hc(l[w]),
void 0!==n&&null!==n){var x=new jg(n),C=g.indexOf(n);x.Xb=e;x.qa=n;x.Ia=C;x.cd="CA"!==n.name;switch(t.ob.name){case E.u.name:x.width=ig.ta;x.height=ig.fa;x.gc=ig.da;break;case E.aa.name:case E.v.name:x.width=ig.xb;x.height=ig.Ea;x.ub=!0;x.Qd=ig.za;break;default:x.width=ig.aa,x.height=ig.v}f.push(x)}n=t}f=h}else if(this.Aa.ye()){g=this.Aa;w=[];f=[];w.push(f);k=g.ia;g=g.xa();l=["P","O5'","O3'"];n=null;r=k.length;for(q=0;q<r;q++){t=k[q];null!==n&&1<t.sa()-n.sa()+t.lb().charCodeAt(0)-n.lb().charCodeAt(0)&&
(f=[],w.push(f));for(h in l)n=t.hc(l[h]),null!==n&&void 0!==n&&(x=new jg(n),C=g.indexOf(n),x.Xb=e,x.qa=n,x.Ia=C,x.cd=!0,x.width=ig.ta,x.height=ig.fa,x.gc=ig.da,x.Qd=ig.pc,f.push(x));n=t}f=w}w=new Sd(!0);if(null!==f){var h=new kg,F;for(F in f)2<f[F].length&&lg(h,w,f[F],e);e=Vd(w);F=De();e=new THREE.Mesh(e,F);e.qa=this.Aa;e.Ha=this;this.parent.add(e);this.ga=e;this.color(Gf.Vb)}};ig.prototype.yd=function(){this.color(Gf.Vb)};function Q(e){Ef.call(this,e)}Q.prototype=Object.create(Ef.prototype);
Q.prototype.constructor=Q;P.rg=new Lf("Cylinder","CYLINDER",Q);Q.ta=.075;Q.fa=1.2;Q.da=.25;Q.xb=1.3;Q.Ea=.5;Q.aa=.175;Q.v=.175;Q.za=34;Q.pc=12;Q.u=20;Q.Ic=2.5;
Q.prototype.Ua=function(){var e=ye(this.ra,this.Da.ea.id,"M"),f=null,g=[],h=[],k=[],l=[],n=[],r=[],q=[],t=[];if(this.Aa.td()){var x=this.Aa;x.ki();for(var w=x.ia,C=x.xa(),F=[],G=[],I=[],D=[],K=[],H=[],L=[],O=[],S=!1,X=!1,pa=["N","CA","C"],na=null,Hb=w.length,Tb=0;Tb<Hb;Tb++){var ba=w[Tb];if(null!==na){var Y=0;isNaN(parseFloat(ba.sa()))||(Y+=parseFloat(ba.sa()));isNaN(parseFloat(na.sa()))||(Y-=parseFloat(na.sa()));isNaN(ba.lb().charCodeAt(0))||(Y+=ba.lb().charCodeAt(0));isNaN(na.lb().charCodeAt(0))||
(Y-=na.lb().charCodeAt(0));1<Y&&(S?(I.push(D),S=!1):X&&(F.push(G),X=!1))}for(var wa in pa){var Ib=ba.hc(pa[wa]);if(void 0!==Ib&&null!==Ib){var V=new jg(Ib),m=C.indexOf(Ib);V.Xb=e;V.qa=Ib;V.Ia=m;V.cd="CA"!==Ib.name;switch(ba.ob.name){case E.u.name:S||(X&&(K.push(F.length),H.push(I.length),F.push(G),X=!1),D=[],S=!0);D.push(Ib);break;case E.aa.name:case E.v.name:V.width=Q.xb;V.height=Q.Ea;V.ub=!0;V.Qd=Q.za;S?(O.push(I.length),L.push(F.length),I.push(D),S=!1,G=[],X=!0):X||(G=[],X=!0);G.push(V);break;
default:V.width=Q.aa,V.height=Q.v,S?(O.push(I.length),L.push(F.length),I.push(D),S=!1,G=[],X=!0):X||(G=[],X=!0),G.push(V)}}}na=ba}S?I.push(D):X&&F.push(G);f=[F,I,K,H,L,O];g=f[0];h=f[1];k=f[2];l=f[3];n=f[4];r=f[5]}else this.Aa.ye()&&console.warn("Cylinder representation not available for nucleic molecules");var y=new Sd(!0);if(null!==g){var Jb=new kg,oa;for(oa in h){var yb=null,tc=null;if(2<h[oa].length){var bb,ta=y,zb=h[oa],hd=e;console.assert(2<zb.length,"Helix number must be > 2");for(var Ub,cb=
zb,nb=0,db=0,ob=0,ra=0,eb=0,Na=0,pb=0,Ab=0,Oa=0,qa=cb.length,N=null,R=0;R<qa;R++)N=cb[R],nb+=N.pos.x,db+=N.pos.y,ob+=N.pos.z,ra+=N.pos.x*N.pos.x,eb+=N.pos.y*N.pos.y,Na+=N.pos.z*N.pos.z,pb+=N.pos.x*N.pos.y,Ab+=N.pos.y*N.pos.z,Oa+=N.pos.z*N.pos.x;for(var qb=qa*ra-nb*nb,Ia=(qa*pb-nb*db)/qb,Vb=(-nb*pb+ra*db)/qb,Jc=qa*eb-db*db,hc=(qa*Ab-db*ob)/Jc,Wb=(-db*Ab+eb*ob)/Jc,Kc=qa*Na-ob*ob,ic=(qa*Oa-ob*nb)/Kc,Bb=(-ob*Oa+Na*nb)/Kc,jc=1-Ia*hc*ic,Ja=(hc*ic*Vb+ic*Wb+Bb)/jc,Wa=(Vb+Ia*ic*Wb+Ia*Bb)/jc,fb=(hc*Vb+Wb+Ia*
hc*Bb)/jc,ia=void 0,Z=void 0,ca=void 0,Ca=0,Cb=0,rb=Number.POSITIVE_INFINITY,sb=0;180>=sb;sb+=10)for(var Ka=Math.PI*sb/180,Db=0;360>Db;Db+=10){for(var sa=Math.PI*Db/180,ia=Math.cos(sa)*Math.sin(Ka),Z=Math.sin(sa)*Math.sin(Ka),ca=Math.cos(Ka),Pa=0,R=0;R<qa;R++)var N=cb[R],la=(ia*(N.pos.x-Ja)+Z*(N.pos.y-Wa)+ca*(N.pos.z-fb))/(ia*ia+Z*Z+ca*ca),Xa=ia*la+Ja,ua=Z*la+Wa,gb=ca*la+fb,Pa=Pa+((N.pos.x-Xa)*(N.pos.x-Xa)+(N.pos.y-ua)*(N.pos.y-ua)+(N.pos.z-gb)*(N.pos.z-gb));Pa<rb&&(rb=Pa,Ca=Ka,Cb=sa)}for(var uc=
Ca,vc=Cb,Xb=-10;10>=Xb;Xb++)for(var Ka=uc+Math.PI*Xb/180,xa=-10;10>=xa;xa++){sa=vc+Math.PI*xa/180;ia=Math.cos(sa)*Math.sin(Ka);Z=Math.sin(sa)*Math.sin(Ka);ca=Math.cos(Ka);for(R=Pa=0;R<qa;R++)N=cb[R],la=(ia*(N.pos.x-Ja)+Z*(N.pos.y-Wa)+ca*(N.pos.z-fb))/(ia*ia+Z*Z+ca*ca),Xa=ia*la+Ja,ua=Z*la+Wa,gb=ca*la+fb,Pa+=(N.pos.x-Xa)*(N.pos.x-Xa)+(N.pos.y-ua)*(N.pos.y-ua)+(N.pos.z-gb)*(N.pos.z-gb);Pa<rb&&(rb=Pa,Ca=Ka,Cb=sa)}for(var ia=Math.cos(Cb)*Math.sin(Ca),Z=Math.sin(Cb)*Math.sin(Ca),ca=Math.cos(Ca),ma=[],ya=
[],Lc=!1;!Lc;){for(R=0;R<cb.length;R++)N=cb[R],la=(ia*(N.pos.x-Ja)+Z*(N.pos.y-Wa)+ca*(N.pos.z-fb))/(ia*ia+Z*Z+ca*ca),ya[R]=la,Xa=ia*la+Ja,ua=Z*la+Wa,gb=ca*la+fb,ma[R]=new THREE.Vector3(Xa,ua,gb);ya[0]>ya[ya.length-1]?(ia=-ia,Z=-Z,ca=-ca):Lc=!0}for(R=0;R<cb.length;R++)for(var Da=R+1;Da<cb.length;Da++)ya[R]>ya[Da]&&(Ka=ya[R],ya[R]=ya[Da],ya[Da]=Ka,sa=ma[R],ma[R]=ma[Da],ma[Da]=sa);Ub=[ma,ia,Z,ca];var Kb=Ub[0],Mc=Ub[1],Nc=Ub[2],Yb=Ub[3],Qa=Kb[0],La=Kb[Kb.length-1],kc=La.clone().sub(Qa).normalize(),wc=
ae(kc.clone()),lc=kc.clone().cross(wc).normalize(),hb=ta.kc.length/3,Lb=NaN,Ya=0,Mb=Qa.clone();Mb.qa=zb[0];var mc=this.oa.indexOf(zb[0]);Mb.Ia=mc;Td(ta,Mb.x,Mb.y,Mb.z,hd);ta.Nc.push(Mb.Ia);var hb=ta.kc.length/3,Eb=hb-1;mg(this,ta,wc,lc,Qa,zb[0],hd);for(var Ya=hb,hb=ta.kc.length/3,va=0;va<Q.u;va++){var Ra=(va+1)%Q.u;Ud(ta,Eb,Ya+va,Ya+Ra)}for(var A=1;A<zb.length;A++){var tb=zb[A],La=Kb[A];mg(this,ta,wc,lc,La,tb,hd);Lb=Ya;Ya=hb;hb=ta.kc.length/3;for(va=0;va<Q.u;va++)Ra=(va+1)%Q.u,Ud(ta,Lb+va,Ya+va,Ya+
Ra),Ud(ta,Lb+va,Ya+Ra,Lb+Ra)}var ga=La.clone();ga.qa=zb[zb.length-1];mc=this.oa.indexOf(zb[zb.length-1]);ga.Ia=mc;Td(ta,ga.x,ga.y,ga.z,hd);ta.Nc.push(ga.Ia);hb=ta.kc.length/3;for(va=0;va<Q.u;va++)Ra=(va+1)%Q.u,Ud(ta,hb-1,Ya+Ra,Ya+va);Qa.add((new THREE.Vector3(Mc,Nc,Yb)).multiplyScalar(.3));La.add((new THREE.Vector3(-Mc,-Nc,-Yb)).multiplyScalar(.3));bb=[Qa,La];yb=bb[0];tc=bb[1]}q.push(yb);t.push(tc)}for(oa=0;oa<k.length;oa++){var Zb=k[oa],J=l[oa];if(null!=q[J]){var za=g[Zb],Aa=h[J],Sa=Aa[0],W=new jg(Sa),
Ta=this.oa.indexOf(Sa);W.Xb=e;W.qa=Sa;W.Ia=Ta;W.width=Q.aa;W.height=Q.v;W.pos=q[J];za.push(W.clone());za.push(W.clone());za.push(W.clone())}}for(oa=0;oa<n.length;oa++)J=r[oa],Zb=n[oa],null!=q[J]&&(za=g[Zb],Aa=h[J],Sa=Aa[Aa.length-1],W=new jg(Sa),Ta=this.oa.indexOf(Sa),W.Xb=e,W.qa=Sa,W.Ia=Ta,W.width=Q.aa,W.height=Q.v,W.pos=t[J],za.splice(0,0,W.clone()),za.splice(0,0,W.clone()),za.splice(0,0,W.clone()));for(oa in g)2<g[oa].length&&lg(Jb,y,g[oa],e);var Fb=Vd(y),id=De();id.vertexColors=THREE.FaceColors;
var $b=new THREE.Mesh(Fb,id);$b.qa=this.Aa;$b.Ha=this;this.parent.add($b);this.ga=$b;this.color(Gf.Vb)}};function mg(e,f,g,h,k,l,n){for(var r=0;r<Q.u;r++){var q=r*Math.PI*2/Q.u,t=Q.Ic*Math.sin(q),q=Q.Ic*Math.cos(q),t=g.clone().multiplyScalar(t).add(h.clone().multiplyScalar(q)),t=k.clone().add(t);t.qa=l;t.Ia=e.oa.indexOf(l);Td(f,t.x,t.y,t.z,n);f.Nc.push(t.Ia)}}Q.prototype.yd=function(){this.color(Gf.Vb)};function Fg(e){Ef.call(this,e);this.ec=this.Da.qa.ec()}Fg.prototype=Object.create(Ef.prototype);
Fg.prototype.constructor=Fg;P.LINES=new Lf("Lines","LINES",Fg);
Fg.prototype.Ua=function(){for(var e=new THREE.BufferGeometry,f=[],g=[],h=[],k=this.oa.length,l=0;l<k;l++){var n=this.oa[l],r=this.ec.findNode(n);if(r){var q=r.Qc();if(q)for(var t=q.length,x=0;x<t;x++){var w=gd(q[x],r).Dd;if(this.oa.includes(w)){var C=n.pos,w=w.pos,w=new THREE.Vector3((C.x+w.x)/2,(C.y+w.y)/2,(C.z+w.z)/2);f.push(C.x);f.push(C.y);f.push(C.z);f.push(w.x);f.push(w.y);f.push(w.z);for(C=0;6>C;C++)g.push(1);h.push(l);h.push(l)}}}}f=new Float32Array(f);g=new Float32Array(g);h=new Float32Array(h);
e.addAttribute("position",new THREE.BufferAttribute(f,3));g=new THREE.BufferAttribute(g,3);g.dynamic=!0;e.addAttribute("color",g);e.addAttribute("atomIndex",new THREE.BufferAttribute(h,1));e.sd();h=new THREE.LineBasicMaterial({linewidth:this.ra.lineWidth,vertexColors:THREE.VertexColors});e=new THREE.LineSegments(e,h);e.Ha=this;this.ga=e;this.parent.add(e);this.yd()};Fg.prototype.update=function(e){Ef.prototype.update.call(this,e);e.lineWidth&&(this.parent.remove(this.ga),this.ga=null,this.Ua())};
var Gg=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,
10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,
1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,
9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,
6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,
6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,
2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,
0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,
9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],
[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,
2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,
7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]];function kg(){this.lg=24;this.Ph=2;this.ol=3;this.Vk=!1;this.xj=3;this.yh=20;this.wd=new THREE.Color(16777215)}
function jg(e){e instanceof Ea?this.pos=e.pos.clone():this.pos=e;this.Xb=null;this.qa=e;this.height=this.width=1;this.gc=0;this.ub=this.hf=!1;this.cd=!0;this.Qd=0;this.Ya=this.nd=this.ua=null;this.pe=0}jg.prototype.clone=function(){var e=new jg;e.pos=this.pos.clone();e.Xb=this.Xb;e.qa=this.qa;e.Ia=this.Ia;e.width=this.width;e.height=this.height;e.gc=this.gc;e.hf=this.hf;e.ub=this.ub;e.cd=this.cd;e.Qd=this.Qd;e.ua=this.ua;e.nd=this.nd;e.Ya=this.Ya;e.pe=this.pe;return e};
function lg(e,f,g,h){if(!(2>g.length)){e.wd=h;Hg(e,g);Ig(g);Jg(e,g);Kg(g);Lg(e,g);g=Mg(e,g);g.forEach(function(e){var f=e.Ya.clone().cross(e.ua).normalize();e.nd=f});h=0;for(var k=g.length-1;0<=k;k--){var l=g[k];l.ub?(1<k&&(h+=l.pos.distanceTo(g[k-1].pos)),l.pe=h):h=0}Ng(e,f,g)}}
function Hg(e,f){for(var g=f.length,h=0;h<e.ol;h++){var k=[];if(e.Vk)for(var l=0;l<g;l++)f[l].cd&&(k[l]=f[l-1].pos.clone().add(f[l+1].pos.clone()).multiplyScalar(.5));else for(f[1].cd&&(k[1]=f[0].pos.clone().add(f[1].pos.clone()).multiplyScalar(.5)),f[g-1].cd&&(k[g-1]=f[g-2].pos.add(f[g-1].pos.clone()).multiplyScalar(.5)),l=2;l<g-2;l++)f[l].cd&&(k[l]=(new THREE.Vector3).ib(f[l-2].pos.clone(),-.25).ib(f[l-1].pos.clone(),.5).ib(f[l].pos.clone(),.5).ib(f[l+1].pos.clone(),.5).ib(f[l+2].pos.clone(),-.25));
for(l=1;l<g-1;l++){var n=k[l];void 0!==n&&null!==n&&(f[l].pos=n.clone())}}for(var r=0,h=0;h<g;h++)k=f[h].Qd,k>r&&(r=k);for(h=0;h<r;h++){k=[];for(l=1;l<g-1;l++)f[l].Qd>h&&(k[l]=f[l].pos.clone().add(f[l-1].pos.clone().add(f[l+1].pos.clone()).multiplyScalar(.5)).multiplyScalar(.5));for(l=1;l<g-1;l++)n=k[l],null!==n&&void 0!==n&&(f[l].pos=n.clone())}}
function Lg(e,f){for(var g=f.length,h=0;h<e.xj;h++)for(var k=[],l=1;l<g-1;l++)k[l]=f[l-1].Ya.clone().add(f[l+1].Ya.clone()).ib(f[l].Ya.clone(),2).normalize(),be(k[l],f[l-1].ua.clone(),f[l+1].ua.clone(),.5).normalize()}
function Mg(e,f){var g=f.length;if(1<e.Ph){var h=[],k=0;h[k++]=f[0];for(var l=0;l<g-3;l++)for(var n=0;n<e.Ph;n++){var r=h,q=k++,t=f[l+1],x=f[l+2],w=f[l+3],C=n/e.Ph,w=THREE.Vector3.aa(f[l].pos.clone(),t.pos.clone(),x.pos.clone(),w.pos.clone(),C),w=new jg(w);w.qa=.5>C?t.qa:x.qa;w.Ia=.5>C?t.Ia:x.Ia;t.ub==x.ub?(w.width=THREE.Math.qc(t.width,x.width,C),w.height=THREE.Math.qc(t.height,x.height,C),w.gc=THREE.Math.qc(t.gc,x.gc,C),w.Xb=THREE.Color.qc(t.Xb,x.Xb,C),w.ub=t.ub):(w.width=t.ub?x.width:t.width,w.height=
t.ub?x.height:t.height,w.gc=t.ub?x.gc:t.gc,w.Xb=t.ub?x.Xb:t.Xb,w.ub=!1);w.hf=t.hf;w.nd=THREE.Vector3.qc(t.nd,x.nd,C).normalize();w.Ya=THREE.Vector3.qc(t.Ya,x.Ya,C).normalize();null!==t.ua&&null!==x.ua&&null!==w.Ya&&void 0!==t.ua&&void 0!==x.ua&&void 0!==w.Ya?w.ua=be(w.Ya.clone(),t.ua,x.ua,C):w.ua=THREE.Vector3.qc(t.ua,x.ua,C).normalize();r[q]=w}h[k++]=f[g-1];return h}return f}
function Ig(e){e[0].Ya=e[1].pos.clone().sub(e[0].pos).normalize();for(var f=e.length,g=1;g<f-1;g++)e[g].Ya=e[g+1].pos.clone().sub(e[g-1].pos).normalize();e[f-1].Ya=e[f-1].pos.clone().sub(e[f-2].pos).normalize()}
function Jg(e,f){for(var g=f.length,h=0;h<g;h++){var k=f[h];if(k.width!==k.height){for(var l=new THREE.Vector3,n=0,r=new THREE.Vector3,q=0,t=0,x=h-1;0<=x;x--){var t=t+f[x].pos.distanceTo(f[x+1].pos),w=(e.yh-t)/t*t;if(0>=w)break;l=l.ib(f[x].pos,w);n+=w}t=0;for(x=h+1;x<g;x++){t+=f[x].pos.distanceTo(f[x-1].pos);w=(e.yh-t)/t*t;if(0>=w)break;r=r.ib(f[x].pos,w);q+=w}r=r.multiplyScalar(1/q);l=l.multiplyScalar(1/n);0===n&&(r=l);0===q&&(l=r);k.ua=k.pos.clone().sub(r).add(k.pos.clone().sub(l)).multiplyScalar(1/
e.yh);n=k.ua.clone().cross(k.Ya.clone());if(.1>Math.sqrt(n.x*n.x+n.y*n.y+n.z*n.z))k.ua=null;else if(k.ua=k.Ya.clone().cross(k.ua.clone()).cross(k.Ya.clone()).normalize(),0===k.gc)for(n=h-1;0<=n;n--)if(q=f[n].ua,l=k.ua,null!==q&&void 0!==q){0>l.x*q.x+l.y*q.y+l.z*q.z&&(f[h].ua=l.multiplyScalar(-1));break}}}}
function Kg(e){for(var f=[],g=e.length,h=0;h<g;h++){var k=e[h];if(null===k.ua||void 0===k.ua){for(var l=h;0<=l&&(null===e[l].ua||void 0===e[l].ua);)l--;for(var n=h;n<g&&(null===e[n].ua||void 0===e[n].ua);)n++;n===g&&(n=-1);if(0>l&&0>n)f[h]=ae(k.Ya);else if(0<=l&&0<=n){var r=(h-l)/(n-l),k=k.Ya.clone();f[h]=be(k,e[l].ua,e[n].ua,r)}else f[h]=0<=l?e[l].ua.clone():e[n].ua.clone()}}g=f.length;for(h=0;h<g;h++)l=f[h],null!==l&&void 0!==l&&(n=l.clone(),n.qa=l.qa,n.Ia=l.Ia,e[h].ua=n)}
function Ng(e,f,g){var h=Og(g[0],e.lg,!0),k=!1;Pg(e,f,h,!1);for(var l=g.length,n=1;n<l;n++){var r=g[n],q=Og(r,e.lg,!0),t=r.ub&&r.pe<2*r.width;if(t&&!k)k=Og(r,e.lg,!1),r=Og(r,e.lg,!0),Qg(e,f,h,k),Qg(e,f,k,r);else{for(var k=q.length,x=0;x<k;x++).01>=q[x].clone().sub(h[x].clone()).dot(r.Ya.clone())&&(q[x]=h[x].clone(),q[x].normal=h[x].normal,q[x].qa=h[x].qa,q[x].Ia=h[x].Ia);Qg(e,f,h,q)}h=q;k=t}Pg(e,f,h,!0)}
function Rg(e,f,g){for(var h=g.length,k=f.kc.length/3,l=0;l<h;l++){var n=g[l];Td(f,n.x,n.y,n.z,e.wd);f.Nc.push(n.Ia)}return k}function Qg(e,f,g,h){if(g.length!==h.length)throw"meshFill impossible, a.length !== b.length";g=g.length;e=Rg(e,f,h);for(h=0;h<g;h++){var k=(h+1)%g,l=e-g+h,n=e-g+k,k=e+k;Ud(f,l,e+h,k);Ud(f,l,k,n)}}function Pg(e,f,g,h){var k=g.length;e=Rg(e,f,g);for(g=0;g<k-1;g++){var l=e+g,n=e+g+1,r=e+k-g-1;h?Ud(f,l,r,n):Ud(f,l,n,r)}}
function Og(e,f,g){for(var h=[],k=0;k<f;k++){var l=2*(k+.5)*Math.PI/f,n;if(e.hf){n=f/4;var r=n+2,q=3*f/4,t=q+2,x=.1*e.width;k==n||k==n+1||k==t||k==t+1?(n=k==n||k==n+1?x:-x,l=e.height-2*e.width):k==r||k==r+1||k==q||k==q+1?(n=k==r||k==r+1?x:-x,l=2*e.width-e.height):k<n||k>t?(n=Math.sin(2*l)*e.width,l=e.height-e.width+Math.cos(2*l)*e.width):(n=Math.sin(Math.PI+2*l)*e.width,l=e.width-e.height+Math.cos(Math.PI+2*l)*e.width)}else n=Math.sin(l)*e.width,l=Math.cos(l)*e.height,e.ub?(r=e.width,e.ub&&e.pe<2*
e.width&&g&&(r=e.pe),n=r*(0<=n?1:-1),l=e.height*(0<=l?1:-1)):n+=e.gc*Math.cos(Math.PI*l/e.height);r=null;e.pos instanceof Ea?r=e.pos.pos.clone().ib(e.ua,n).ib(e.nd,l):r=e.pos.clone().ib(e.ua,n).ib(e.nd,l);r.qa=e.qa;r.Ia=e.Ia;h.push(r)}for(k=0;k<f;k++)g=(k+f-1)%f,l=(k+1)%f,n=new THREE.Vector3,n=h[l].clone().sub(h[g].clone()),h[k].normal=n.cross(e.Ya).normalize();return h}function Sg(e,f){Ef.call(this,e);this.mj=null==f?!0:f}Sg.prototype=Object.create(Ef.prototype);Sg.prototype.constructor=Sg;
P.Qe=new Lf("Spheres","SPHERES",Sg);P.oj=new Lf("Balls","BALLS",Sg,!1);
Sg.prototype.Ua=function(){var e;this.mj?(e=this.ra,null===e.Ea&&("HIGH"===e.Qa?e.Ea=new THREE.SphereGeometry(e.v.la.radius,e.v.la.widthSegments,e.v.la.heightSegments,e.v.la.phiStart,e.v.la.phiLength,e.v.la.thetaStart,e.v.la.thetaLength):"MEDIUM"===e.Qa?e.Ea=new THREE.SphereGeometry(e.v.na.radius,e.v.na.widthSegments,e.v.na.heightSegments,e.v.na.phiStart,e.v.na.phiLength,e.v.na.thetaStart,e.v.na.thetaLength):"LOW"===e.Qa&&(e.Ea=new THREE.SphereGeometry(e.v.ma.radius,e.v.ma.widthSegments,e.v.ma.heightSegments,
e.v.ma.phiStart,e.v.ma.phiLength,e.v.ma.thetaStart,e.v.ma.thetaLength))),e=e.Ea):e=ze(this.ra);var f=(new THREE.BufferGeometry).fromGeometry(e),g=this.oa.length,h=f.attributes.position.array.length/f.attributes.position.itemSize,k=g*h;e=new THREE.BufferGeometry;for(var l=new Float32Array(3*k),n=new Float32Array(3*k),r=new Float32Array(3*k),q=new Float32Array(2*k),k=new Float32Array(k),t=0;t<g;t++){var x=this.oa[t],w=new THREE.Matrix4;w.setPosition(x.pos);x=Ce(0,x);if(this.mj){var C=new THREE.Matrix4;
C.makeScale(x,x,x);w.multiply(C)}var F=f.clone();F.applyMatrix(w);for(var w=F.attributes.position.array,x=F.attributes.normal.array,C=F.attributes.color.array,F=F.attributes.uv.array,G=w.length/3,I=0;I<G;I++){for(var D=0;3>D;D++)l[t*w.length+3*I+D]=w[3*I+D],n[t*x.length+3*I+D]=x[3*I+D],r[t*C.length+3*I+D]=C[3*I+D];for(D=0;2>D;D++)q[t*F.length+2*I+D]=F[2*I+D];k[t*h+I]=t}}e.addAttribute("position",new THREE.BufferAttribute(l,3));e.addAttribute("normal",new THREE.BufferAttribute(n,3));C=new THREE.BufferAttribute(r,
3);C.dynamic=!0;e.addAttribute("color",C);e.addAttribute("uv",new THREE.BufferAttribute(q,2));e.addAttribute("atomIndex",new THREE.BufferAttribute(k,1));e.sd();f=De();e=new THREE.Mesh(e,f);e.Ha=this;this.parent.add(e);this.ga=e;this.yd()};Sg.prototype.update=function(e){Ef.prototype.update.call(this,e);e.bg&&(this.parent.remove(this.ga),this.ga=null,this.Ua())};function Tg(e){Ef.call(this,e)}Tg.prototype=Object.create(Ef.prototype);Tg.prototype.constructor=Tg;P.ac=new Lf("Sticks","STICKS",Tg);
Tg.prototype.Ua=function(){var e=null;this.Da instanceof Ff?e=this.Da.ea.bc.ec():this.Da instanceof Hf?e=this.Da.Cb.ea.bc.ec():console.warn("Sticks representation unavailable for this data type");var f;f=this.ra;null===f.za&&("HIGH"===f.Qa?f.za=new THREE.CylinderGeometry(f.aa.la.radiusTop,f.aa.la.radiusBottom,f.aa.la.height,f.aa.la.xd,f.aa.la.gf,f.aa.la.openEnded):"MEDIUM"===f.Qa?f.za=new THREE.CylinderGeometry(f.aa.na.radiusTop,f.aa.na.radiusBottom,f.aa.na.height,f.aa.na.xd,f.aa.na.gf,f.aa.na.openEnded):
"LOW"===f.Qa&&(f.za=new THREE.CylinderGeometry(f.aa.ma.radiusTop,f.aa.ma.radiusBottom,f.aa.ma.height,f.aa.ma.xd,f.aa.ma.gf,f.aa.ma.openEnded)));f=f.za;var g=(new THREE.BufferGeometry).fromGeometry(f);f=this.ra;null===f.pc&&("HIGH"===f.Qa?f.pc=new THREE.SphereGeometry(f.da.la.radius,f.da.la.widthSegments,f.da.la.heightSegments,f.da.la.phiStart,f.da.la.phiLength,f.da.la.thetaStart,f.da.la.thetaLength):"MEDIUM"===f.Qa?f.pc=new THREE.SphereGeometry(f.da.na.radius,f.da.na.widthSegments,f.da.na.heightSegments,
f.da.na.phiStart,f.da.na.phiLength,f.da.na.thetaStart,f.da.na.thetaLength):"LOW"===f.Qa&&(f.pc=new THREE.SphereGeometry(f.da.ma.radius,f.da.ma.widthSegments,f.da.ma.heightSegments,f.da.ma.phiStart,f.da.ma.phiLength,f.da.ma.thetaStart,f.da.ma.thetaLength)));f=f.pc;var h=(new THREE.BufferGeometry).fromGeometry(f),k=h.attributes.position.array.length/h.attributes.position.itemSize,l=g.attributes.position.array.length/g.attributes.position.itemSize;f=new THREE.BufferGeometry;var n=[],r=[],q=[],t=[],x=
[],w=new THREE.Matrix4;w.makeRotationX(.5*Math.PI);for(var C=this.oa.length,F=0;F<C;F++){var G=this.oa[F],I=e.findNode(G);if("HOH"!==this.oa[F].Vc()){var D=new THREE.Matrix4;D.setPosition(G.pos);var K=h.clone();K.applyMatrix(D);for(var H=K.attributes.position.array,L=0;L<H.length;L++)n.push(H[L]);H=K.attributes.normal.array;for(L=0;L<H.length;L++)r.push(H[L]);H=K.attributes.color.array;for(L=0;L<H.length;L++)q.push(H[L]);H=K.attributes.uv.array;for(L=0;L<H.length;L++)t.push(H[L]);for(L=0;L<k;L++)x.push(F)}if(K=
I.Qc())for(var D=K.length,O=0;O<D;O++)if(L=gd(K[O],I).Dd,this.oa.includes(L)){var H=G.pos,S=L.pos,L=H.clone(),X=new THREE.Vector3((H.x+S.x)/2,(H.y+S.y)/2,(H.z+S.z)/2),S=L.distanceTo(X),pa=X.clone().add(L).divideScalar(2),H=new THREE.Matrix4;H.lookAt(L,X,new THREE.Vector3(0,1,0));H.multiply(w);H.setPosition(pa);L=new THREE.Matrix4;L.makeScale(1,S,1);H.multiply(L);S=g.clone();S.applyMatrix(H);H=S.attributes.position.array;for(L=0;L<H.length;L++)n.push(H[L]);H=S.attributes.normal.array;for(L=0;L<H.length;L++)r.push(H[L]);
H=S.attributes.color.array;for(L=0;L<H.length;L++)q.push(H[L]);H=S.attributes.uv.array;for(L=0;L<H.length;L++)t.push(H[L]);for(L=0;L<l;L++)x.push(F)}}e=new Float32Array(n);g=new Float32Array(r);q=new Float32Array(q);t=new Float32Array(t);x=new Float32Array(x);f.addAttribute("position",new THREE.BufferAttribute(e,3));f.addAttribute("normal",new THREE.BufferAttribute(g,3));H=new THREE.BufferAttribute(q,3);H.dynamic=!0;f.addAttribute("color",H);f.addAttribute("uv",new THREE.BufferAttribute(t,2));f.addAttribute("atomIndex",
new THREE.BufferAttribute(x,1));f.sd();e=De();f=new THREE.Mesh(f,e);f.Ha=this;this.parent.add(f);this.ga=f;this.yd()};Tg.prototype.update=function(e){Ef.prototype.update.call(this,e);if(e=e.bg)e=void 0===this.Da.Xd.pd(P.be);e&&(this.parent.remove(this.ga),this.ga=null,this.Ua())};function Ug(e,f,g){Ef.call(this,e);this.di=g;this.wireframe=f;this.Gf=Ug.v;this.startTime=null}Ug.v=0;Ug.u=1.4;Ug.prototype=Object.create(Ef.prototype);Ug.prototype.constructor=Ug;
P.pg=new Lf("Accessible Surface Wireframe","ASM",Ug,!0,!0);P.tf=new Lf("Accessible Surface","AS",Ug,!1,!0);P.vg=new Lf("Molecular Surface Wireframe","MSM",Ug,!0,!1);P.vf=new Lf("Molecular Surface","MS",Ug,!1,!1);
Ug.prototype.Ua=function(){if("Solvent"!==this.Aa.type){if(this.wireframe){var e=De();e.wireframe=!0;var f=this.di?fg(this.Da,P.tf):fg(this.Da,P.vf);null===f.ga&&(f.Ua(),f.hide());f=f.ga.geometry.clone()}else{e=De();this.startTime=(new Date).getTime();this.di&&(this.Gf=Ug.u);var g;f=this.ra;g="LOW"===f.Qa?.5:"MEDIUM"===f.Qa?1:"HIGH"===f.Qa?1.5:void 0;var h=this.Aa.xa(),f=this.mc(h),k=f[0],f=f[1],l=6*Math.ceil(g)+1;k.x-=l;f.x+=l;k.y-=l;f.y+=l;k.z-=l;f.z+=l;for(var n=Math.round((f.x-k.x)*g),r=Math.round((f.y-
k.y)*g),q=Math.round((f.z-k.z)*g),f=Array(n),l=0;l<n;l++)for(var t=0;t<r;t++)for(var x=0;x<q;x++)void 0===f[l]&&(f[l]=Array(r)),void 0===f[l][t]&&(f[l][t]=Array(q)),f[l][t][x]=new THREE.Vector3(l/g+k.x,t/g+k.y,x/g+k.z),f[l][t][x].cb=[],f[l][t][x].state=0;n=h.length;l=null;for(r=0;r<n;r++)for(var q=h[r],w=Ce(0,q),C=Math.round((w+this.Gf)*g+1),F=Math.round((q.pos.x-k.x)*g),G=Math.round((q.pos.y-k.y)*g),I=Math.round((q.pos.z-k.z)*g),D=F-C;D<=F+C;D++)for(var K=G-C;K<=G+C;K++)for(var H=I-C;H<=I+C;H++)l=
D/g+k.x,t=K/g+k.y,x=H/g+k.z,q.Ka().distanceTo(new THREE.Vector3(l,t,x))<w+this.Gf&&(l=f[D][K][H],l.cb.push(q),l.qa=q,l.Ia=r,l.state=1);g=new Sd(!0);h=f.length;for(k=1;k<h;k++)for(l=f[k].length,t=1;t<l;t++)for(x=f[k][t].length,n=1;n<x;n++){w=0;1===f[k-1][t][n].state&&(w|=128);1===f[k][t][n].state&&(w|=64);1===f[k][t-1][n].state&&(w|=32);1===f[k-1][t-1][n].state&&(w|=16);1===f[k-1][t][n-1].state&&(w|=8);1===f[k][t][n-1].state&&(w|=4);1===f[k][t-1][n-1].state&&(w|=2);1===f[k-1][t-1][n-1].state&&(w|=
1);for(var r=g,C=f[k-1][t-1][n-1],F=f[k][t-1][n-1],G=f[k][t][n-1],I=f[k-1][t][n-1],D=f[k-1][t-1][n],K=f[k][t-1][n],H=f[k][t][n],L=f[k-1][t][n],q=[C,F,G,I,D,K,H,L,C,F,G,I],C=[F,G,I,C,K,H,L,D,D,K,H,L],F=Gg[w],G=0,I=F.length,w=0;w<I;w++){D=F[w];K=q[D];H=C[D];D=void 0;for(L=0;8>L;L++)if(D=new THREE.Vector3((K.x+H.x)/2,(K.y+H.y)/2,(K.z+H.z)/2),D.cb=[],0<K.cb.length)Vg(this,D,K.cb)?(D.cb=D.cb.concat(K.cb),K=D):Vg(this,D,H.cb)||(H=D);else if(0<H.cb.length)Vg(this,D,H.cb)?(D.cb=D.cb.concat(H.cb),H=D):Vg(this,
D,K.cb)||(K=D);else break;D.cb=D.cb.concat(K.cb);D.cb=D.cb.concat(H.cb);for(var H=K=D,L=D.cb,O=Infinity,S=null,X=L.length,pa=0;pa<X;pa++){var na=L[pa],Hb=H.distanceTo(na.Ka());Hb<O&&(O=Hb,S=na)}K.qa=S;D.Ia=this.oa.indexOf(D.qa);Td(r,D.x,D.y,D.z);r.Nc.push(D.Ia);G++}q=G/3;C=r.kc.length/3;for(w=0;w<q;w++)Ud(r,C-3*w-3,C-3*w-1,C-3*w-2)}f=Vd(g)}e=new THREE.Mesh(f,e);e.qa=this.Aa;e.Ha=this;this.parent.add(e);this.ga=e;this.color(Gf.Va)}};
Ug.prototype.mc=function(e){for(var f=new THREE.Vector3(Infinity,Infinity,Infinity),g=new THREE.Vector3(-Infinity,-Infinity,-Infinity),h=e.length,k=0;k<h;k++){var l=e[k].pos;f.x=Math.min(f.x,l.x);f.y=Math.min(f.y,l.y);f.z=Math.min(f.z,l.z);g.x=Math.max(g.x,l.x);g.y=Math.max(g.y,l.y);g.z=Math.max(g.z,l.z)}return[f,g]};function Vg(e,f,g){for(var h=g.length,k=!1,l=0;l<h;l++){var n=g[l];if(n.Ka().distanceTo(f)<parseFloat(Ua.Fc(n.symbol)[7]+e.Gf)){k=!0;break}}return k}
Ug.prototype.update=function(e){Ef.prototype.update.call(this,e);e.bg&&(this.parent.remove(this.ga),this.ga=null,this.Ua())};
self.onmessage=function(e){var f=e.data[0];e=e.data[1];console.log(f,e);importScripts("/BioVizJS-ng/3DLibrary/three.min.js");importScripts("/BioVizJS-ng/data/elemental_radii.js");var g=new THREE.Geometry;new THREE.MeshLambertMaterial({vertexColors:THREE.VertexColors});for(var h=0,k=f.length,l=0;l<k;l++){var n=new THREE.Matrix4;n.setPosition(new THREE.Vector3(f[l][0],f[l][1],f[l][2]));var r=Ua[f[l][3]][7],q=new THREE.Matrix4;q.makeScale(r,r,r);n.multiply(q);g.merge(e,n);for(n=g.vertices.length;h<n;h++)g.vertices[h].qa=
f[l];h=g.vertices.length}console.log(g)};function Wg(){THREE.Object3D.call(this);this.matrixAutoUpdate=!1;this.matrixWorldNeedsUpdate=!0;this.Da=this;this.Xd=new ja;this.labels=new THREE.Object3D;this.add(this.labels)}Wg.prototype=Object.create(THREE.Object3D.prototype);Wg.prototype.constructor=Wg;function Xg(){this.map=[]}Xg.prototype.get=function(e){return this.map[e.constructor]};Xg.prototype.add=function(e,f){this.map[e]=f};var Yg=new Xg;z=Wg.prototype;
z["delete"]=function(){for(var e=this.Xd.keys(),f=0,g=e.length;f<g;f++)e[f]["delete"]()};z.show=function(e){if(void 0!==e){if(e=fg(this,e),null!=e)return e.show(),e}else this.visible=!0};z.hide=function(e){void 0!==e?(e=fg(this,e),null!=e&&e.hide()):this.visible=!1};z.tb=function(e,f,g){if(void 0!==f)f=fg(this,f),null!=f&&f.tb(e,g);else{f=this.Jb();for(var h=0;h<f.length;h++)f[h].tb(e,g)}};
function fg(e,f){if(null!==f){var g=e.Xd.pd(f);void 0===g&&-1!==Yg.get(e).indexOf(f)&&(void 0!==f&&null!==f?(g=new f.Ha(e,f.Kk,f.xl),g.$c=f.name):g=void 0,void 0!==g&&(g.kf=void 0),e.Xd.set(g,f));return g}}z.Wf=function(e){var f=this.Xd.pd(e);return void 0===f||-1===Yg.get(this).indexOf(e)?!1:f.visible};z.Jb=function(){var e=[],f=this.Xd.keys(),g;for(g in f){var h=f[g];h.visible&&e.push(h)}return e};
function Bf(e,f){var g=[];if(void 0===f||null===f)f=e;var h=f.children.length;if(0!==h)for(var k=0;k<h;k++)!(f.children[k]instanceof THREE.Mesh||f.children[k]instanceof THREE.Line)||void 0===f.children[k].qa&&0===f.children[k].material.vertexColors?g=g.concat(Bf(e,f.children[k])):g.push(f.children[k]);else if((f.children[k]instanceof THREE.Mesh||f.children[k]instanceof THREE.Line)&&void 0!==f.children[k].qa)return[f.children[k]];return g}
function Kf(e,f){Wg.call(this);this.ra=te();this.qe=f;this.cg=e;this.cg.add(this);this.oa=[f];this.qa=this.qe;this.updateMatrixWorld()}Kf.prototype=Object.create(Wg.prototype);Kf.prototype.constructor=Kf;Yg.add(Kf,[P.Qe,P.Bd]);z=Kf.prototype;z["delete"]=function(){Wg.prototype["delete"].call(this);this.parent.remove(this)};z.ab=function(){return this.cg.ab()};z.hb=function(){return this.cg.hb()};z.oc=function(){return this.cg};z.Pc=function(){return this.qe.Ka()};z.qb=function(){return this.qe.mc()};
function Ff(e,f){Wg.call(this);this.rf=e;this.rf.add(this);this.ea=f;this.ra=te();this.Ee=new fa;this.oa=this.ea.xa();this.qa=this.ea;this.updateMatrixWorld()}Ff.prototype=Object.create(Wg.prototype);Ff.prototype.constructor=Ff;Yg.add(Ff,[P.Qe,P.be,P.LINES,P.ac,P.Bd,P.Pe,P.rg,P.vf,P.vg,P.tf,P.pg,P.uf,P.qg]);z=Ff.prototype;z["delete"]=function(){Wg.prototype["delete"].call(this);for(var e=this.Ee.values(),f=0,g=e.length;f<g;f++)e[f]["delete"]();this.parent.remove(this)};z.ab=function(){return this.rf};
z.clear=function(e){e=fg(this,e);null!==e&&void 0!==e&&e.clear()};function Zg(e){if(null!==e.ea.type)switch(e.ea.type){case "Protein":case "Peptide":return P.Pe;case "Small Peptide":return P.be;case "RNA":case "DNA":return P.Pe;case "Ligand":return P.ac;case "Ion":return P.Bd;case "Solvent":return P.NONE}console.warn("Error, cannot draw : ",e.ea.type);return null}function Xe(e){e=fg(e,Zg(e));null!==e&&void 0!==e&&e.show()}
z.oc=function(e,f){"string"===typeof e&&(e=this.ea.mb(e.split(":")[1]));if(e.ea!==this.ea)throw e.toString()+" don't belongs to "+this.ea.toString();var g=this.Ee.get(e);null==g&&f&&(g=new Hf(this,e),this.Ee.set(e,g));return g};z.reset=function(){var e=this.Jb(),f;for(f in e){var g=e[f];g.yd();g.tb(!1);g.hide();if(g=e[f].ga)g.material.opacity=1,g.material.transparent=!1}Xe(this);e=this.Ee.values();g=e.length;for(f=0;f<g;f++)this.remove(e[f]);this.Ee.clear()};
z.Yd=function(){this.matrix.identity();this.matrixWorldNeedsUpdate=!0};z.Pc=function(){return jd(this.ea.mc())};z.qb=function(){return this.ea.mc()};z.vb=function(){return this.ea.vb()};function Hf(e,f){Wg.call(this);this.ra=te();this.Cb=f;this.vh=e;this.If=new fa;this.vh.add(this);this.oa=this.Cb.xa();this.qa=this.Cb;this.updateMatrixWorld()}Hf.prototype=Object.create(Wg.prototype);Hf.prototype.constructor=Hf;Yg.add(Hf,[P.Qe,P.be,P.LINES,P.ac,P.Bd]);z=Hf.prototype;
z["delete"]=function(){Wg.prototype["delete"].call(this);for(var e=this.If.values(),f=0,g=e.length;f<g;f++)e[f]["delete"]();this.parent.remove(this)};z.ab=function(){return this.vh.rf};z.hb=function(){return this.vh};z.od=function(e,f){"string"===typeof e&&(e=this.Cb.Zj(e.split(":")[1]));if(e.wa!==this.Cb)throw e.toString()+" don't belongs to "+this.Cb.toString();var g=this.If.get(e);null==g&&f&&(g=new Kf(this,e),this.If.set(e,g));return g};z.Pc=function(){return jd(this.Cb.mc())};z.qb=function(){return this.Cb.mc()};
function Fe(e){function f(){requestAnimationFrame(f);var e=k.getDelta();h.Eb.Hc?0!==h.sf.zc.length&&ef(h.sf,1E3*e):h.Eb.update(1E3*e);h.Wd.update();h.Ui.update();h.Qk.update();h.ba.Me?(h.renderer.clear(),h.Ah.render(h.Qb,h.camera)):h.ba.yc?(h.renderer.clear(),h.yc.render(h.Qb,h.camera)):(h.renderer.clear(),h.renderer.render(h.Qb,h.camera),h.Qb.overrideMaterial=h.Rk,h.renderer.render(h.Qb,h.camera),h.Qb.overrideMaterial=null);null!=h.uc&&(h.renderer.clearDepth(),h.renderer.render(h.uc,h.Kd))}THREE.Group.call(this);
this.Qb=new THREE.Scene;this.scene=this;this.scene.qa=this;this.Qb.add(this);this.Zb=e.ca.content;this.ka=[];this.light=this.camera=this.renderer=null;this.$g=.5;this.ra=te();this.animations=new df(this);this.sf=new df(this);this.Eb=new ScriptEngine(this);this.ba=e;this.uc=this.Kd=null;this.zd=[];this.jd=this.jc=this.ke=null;this.Ze=[];if(this.ba.ca.fj){this.Za={enabled:!0};this.Lf=1;e=THREE.ShaderLib.depthRGBA;var g=THREE.UniformsUtils.clone(e.uniforms);new THREE.ShaderMaterial({fragmentShader:e.fragmentShader,
vertexShader:e.vertexShader,uniforms:g,blending:THREE.NoBlending})}this.Vi=new THREE.Plane(new THREE.Vector3(0,0,-1),0);this.vi=new THREE.Plane(new THREE.Vector3(0,0,1),0);this.init();cd.Ub.yj()&&cd.Ub.zj({element:$(this.renderer.domElement.parent).get(0),ca:this.ba.ca});this.Tg=new THREE.EffectComposer(this.renderer);e=new THREE.RenderPass(this.Qb,this.camera);g=new THREE.ShaderPass(THREE.CopyShader);g.renderToScreen=!0;this.Tg.addPass(e);this.Tg.addPass(g);e=this.Zb.width()||2;g=this.Zb.height()||
2;this.Ah=new THREE.StereoEffect(THREE.StereoEffect.Types.PARALLAX_BARRIER,this.renderer,e,g);this.yc=new THREE.StereoEffect(THREE.StereoEffect.Types.ANAGLYPH,this.renderer,e,g);cd.ee.bind(this.Ah,this.Zb);cd.ee.bind(this.yc,this.Zb);Cf(this,this.$g);this.Rk=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone({scale:{type:"f",value:.2}}),vertexShader:"uniform float scale;\nattribute float highlight;\nvarying float doHighlight;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 pNormal = projectionMatrix * vec4( normalize( normalMatrix * normal ), 0.0 );\nvec2 xyNormal = pNormal.xy * scale;\ndoHighlight = highlight;\ngl_Position = projectionMatrix * mvPosition + vec4( xyNormal, 0.15 , 0.0 );\n}",
fragmentShader:"varying float doHighlight;\nvoid main() {\nif (doHighlight > 0.99) {\ngl_FragColor = vec4( 0.9, 0.8, 0.2, 1.0 );\n} else {\ndiscard;\n}\n}"});this.Ui=new mf(this,this.renderer.domElement);this.Wd=new yf(this,this.renderer.domElement);this.Qk=new Df(this,this.renderer.domElement);var h=this,k=new THREE.Clock;requestAnimationFrame(f);this.ra.subscribe(this)}Fe.prototype=Object.create(THREE.Group.prototype);Fe.prototype.constructor=Fe;var $g=Object;$g.location=[];$g.location.da="CENTER";
$g.location.fa="TOP";$g.location.u="BOTTOM";$g.location.LEFT="LEFT";$g.location.RIGHT="RIGHT";$g.location.ta="TOP_LEFT";$g.location.v="BOTTOM_LEFT";$g.location.aa="BOTTOM_RIGHT";$g.location.za="TOP_RIGHT";function Cf(e,f){e.$g=f;e.Ah.setSeparation(f);e.yc.setSeparation(f)}function $e(e,f,g){var h=1.5*e.qb().length();null!=f&&(e.Vi.constant=-(e.camera.near-e.camera.position.z+f/100*(h-e.camera.near)));null!=g&&(e.vi.constant=e.camera.near-e.camera.position.z+g/100*(h-e.camera.near))}
function ah(e,f){for(var g=e.ka.length,h=f.Uc(),k=0,l=0;l<g;l++)e.ka[l].Uc().substring(0,4)===h&&k++;0<k&&f.pa.bd(h+"_"+k);e.add(f);e.ka.push(f)}z=Fe.prototype;
z.init=function(){this.camera=this.ba.camera;this.camera.position.set(0,0,30);this.light=new bf(this);this.scene.matrixAutoUpdate=!1;var e=new THREE.AmbientLight(6710886);this.Qb.add(e);this.Qb.fog=new THREE.Fog(this.ra.bgColor,0,0);this.renderer=new THREE.WebGLRenderer({antialias:this.ra.dg.antialias,preserveDrawingBuffer:!0});this.renderer.autoClear=!1;this.renderer.setSize(this.Zb.width(),this.Zb.height());this.renderer.setPixelRatio(window.devicePixelRatio);this.renderer.setClearColor(this.ra.bgColor,
1);this.renderer.domElement.className+=" hasContextMenu";this.Zb.prepend(this.renderer.domElement);this.renderer.getContext();this.renderer.clippingPlanes=[this.Vi,this.vi];cd.ee.bind(this.renderer,this.Zb,this.camera,this);this.ba.ca.fj&&(this.Za.scene=new THREE.Scene,this.Za.camera=new THREE.OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-1E4,1E4),this.Za.camera.position.z=1,e={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter},this.Za.bl=
new THREE.WebGLRenderTarget(window.innerWidth*this.Lf,window.innerHeight*this.Lf,e),this.Za.al=new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,e),e=THREE.SSAOShader,this.Za.ssao_uniforms=THREE.UniformsUtils.clone(e.uniforms),this.Za.ssao_uniforms.tDiffuse.value=this.Za.al,this.Za.ssao_uniforms.tDepth.value=this.Za.bl,this.Za.ssao_uniforms.size.value.set(window.innerWidth*this.Lf,window.innerHeight*this.Lf),this.Za.ssao_uniforms.cameraNear.value=this.camera.near,this.Za.ssao_uniforms.cameraFar.value=
this.camera.far,this.Za.ssao_uniforms.onlyAO.value=!1,this.Za.Pk=new THREE.ShaderMaterial({uniforms:this.Za.ssao_uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.Za.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(window.innerWidth,window.innerHeight),this.Za.Pk),this.Za.quad.position.z=-500,this.Za.scene.add(this.Za.quad),new SSAOConfig(this.renderer,this.Za))};z.clear=function(){for(var e in this.ka)this.scene.remove(this.ka);this.ka=[]};
z.Ld=function(e,f){null==f&&(f=.1);var g=new gf(e.r,e.g,e.b,f);this.animations.dc(g)};function ne(e,f,g,h){void 0===f&&(f=e.ka[0]);void 0===g&&(g=1E3);void 0===h&&(h=!0);g=new ff(f,e,g,h);e.sf.dc(g);h&&(e.ba.Ja=f)}function bh(e,f,g,h){void 0===f&&(f=e.ka[0]);void 0===h&&(h=1E3);f=new kf(h,f,e,g);e.animations.dc(f)}z.toString=function(){return"scene"};z.update=function(e){e.bgColor&&(this.renderer.setClearColor(this.ra.bgColor,1),this.Qb.fog.color=this.ra.bgColor)};
z.gg=function(e,f,g,h,k){function l(e){return"#"===e.charAt(0)?e.substring(1,7):"x"===e.charAt(1)?e.substring(2,8):e}var n=this.Zb.height(),r=this.Zb.width();null==f&&(f=$g.location.za);null!=g?"string"===typeof g&&g.endsWith("%")&&(g=n*g.substr(0,g.length-1)/100):g=n*this.ra.me/100;null==h&&(h="#00ff00");null==k&&(k=2E3);if(null===this.uc){this.Kd=new THREE.OrthographicCamera(-r/2,r/2,n/2,-n/2,1,10);this.Kd.position.z=10;this.uc=new THREE.Scene;cd.ee.bind(this.renderer,this.Zb,this.Kd,this);var q=
new THREE.RenderPass(this.uc,this.Kd);this.Tg.addPass(q,1)}""===e?void 0!==this.zd[f]&&(this.uc.remove(this.zd[f]),this.zd[f]=void 0,this.renderer.render(this.uc,this.Kd)):void 0!==e&&(e=Be(e,{fontsize:g,bh:{r:parseInt(l(h).substring(0,2),16),g:parseInt(l(h).substring(2,4),16),b:parseInt(l(h).substring(4,6),16),a:1},maxWidth:r,maxHeight:n}),h=new THREE.SpriteMaterial({map:e}),e=h.map.image.width,g=h.map.image.height,h=new THREE.Sprite(h),h.scale.set(e,g,1),void 0!==this.zd[f]&&this.uc.remove(this.zd[f]),
this.zd[f]=h,ch(this),this.uc.add(h),void 0!==k&&(f=new lf(h,this,k,f),this.Eb.Hc?this.sf.dc(f):this.animations.dc(f)))};
function ch(e){var f=e.Zb.width()/2,g=e.Zb.height()/2,h;for(h in $g.location){var k=$g.location[h],l=e.zd[k];if(void 0!==l){var n=l.material.map.image.width/2,r=l.material.map.image.height/2;switch(k){case $g.location.da:l.position.set(0,0,1);break;case $g.location.fa:l.position.set(0,g-r,1);break;case $g.location.u:l.position.set(0,-g+r,1);break;case $g.location.LEFT:l.position.set(-f+n,0,1);break;case $g.location.RIGHT:l.position.set(f-n,0,1);break;case $g.location.ta:l.position.set(-f+n,g-r,1);
break;case $g.location.v:l.position.set(-f+n,-g+r,1);break;case $g.location.aa:l.position.set(f-n,-g+r,1);break;default:l.position.set(f-n,g-r,1)}}}}z.eg=function(){for(var e in this.ka)this.ka[e].eg()};z.De=function(){for(var e in this.ka)this.ka[e].De()};z.Ch=function(){this.scene.matrix.identity();for(var e in this.ka)this.ka[e].Yd();this.scene.updateMatrixWorld(!0);ke(this.ba,this.ba.Xa,!0)};
z.reset=function(){this.scene.matrix.identity();for(var e in this.ka)this.ka[e].reset();this.scene.updateMatrixWorld(!0);ke(this.ba,this.ba.Xa,!0)};z.Ka=function(){return new THREE.Vector3};z.Pc=function(){return jd(this.qb())};z.qb=function(){for(var e=null,f=this.ka.length,g=0;g<f;g++){var h=this.ka[g],k=h.qb().clone();k.applyMatrix4(h.matrix);e=null===e?k:e.merge(k)}f=new THREE.Vector3;return null!==e?e:new Va(f,f)};z.mf=function(e){this.Wd.rh=!0;void 0!=e?this.ke=e:this.ke=null};
z.pf=function(){this.ke=null;this.Wd.rh=!1};z.Jf=function(){for(var e=this.Ze.length,f=0;f<e;f++)this.scene.remove(this.Ze[f]);this.Ze.splice()};function M(e){Wg.call(this);this.Jk=!0;this.pa=e;this.qa=this.pa.Qf();this.ra=te();this.ya=new ja;this.updateMatrixWorld();this.Mc=new fa}M.prototype=Object.create(Wg.prototype);z=M.prototype;z.constructor=M;z.ab=function(){return this};
z["delete"]=function(){Wg.prototype["delete"].call(this);for(var e=this.ya.values(),f=0,g=e.length;f<g;f++)e[f]["delete"]();this.parent.remove(this)};z.show=function(e){for(var f in this.ya.keys())this.ya.get(this.ya.keys()[f]).show(e)};z.hide=function(e){for(var f in this.ya.keys())this.ya.get(this.ya.keys()[f]).hide(e)};z.Wf=function(e){var f=!0,g=this.ya.keys(),h;for(h in g)if(f=this.ya.get(g[h]).Wf(e),!f)break;return f};
z.Jb=function(){for(var e=[],f=this.ya.values(),g=0,h=f.length;g<h;g++){var k=f[g].Xd.keys(),l;for(l in k){var n=k[l];n.visible&&e.push(n)}}return e};z.Pc=function(){return jd(this.qb())};z.qb=function(){var e=null,f;for(f in this.ya.keys()){var g=this.ya.get(this.ya.keys()[f]),h=g.qb().clone();h.applyMatrix4(g.matrix);e=null===e?h:e.merge(h)}return e};z.toString=function(){return this.pa.ci};z.vb=function(){return this.toString()};z.Uc=function(){return this.pa._id};
function We(e){var f=[],g=e.ya.keys(),h;for(h in g)f.push(e.ya.get(g[h]));return f}z.hb=function(e){var f=this.ya.get(e);void 0===f&&(f=new Ff(this,e),this.ya.set(e,f));return f};z.reset=function(){qe(this);this.Yd();this.De();this.eg()};z.eg=function(){var e=We(this);this.show();for(var f in e){e[f].tb(!1);var g=e[f].Ee.values(),h;for(h in g){g[h].tb(!1);var k=g[h].If.values(),l;for(l in k)k[l].tb(!1)}}};z.Yd=function(){this.matrix.identity();this.matrixWorldNeedsUpdate=!0;var e=We(this),f;for(f in e)e[f].Yd()};
z.De=function(){qe(this);var e=We(this);this.show();for(var f in e)e[f].reset()};
z.Mb=function(e,f,g,h){var k,l;if(e instanceof Tc||void 0==e)switch(f){case void 0:case M.u.xf:dh(this,this.pa,this.pa.toString(),this.pa.Ka(),this,g,h);break;case M.u.Vb:e=this.ya.keys();for(var n in e)l=this.ya.get(e[n]),dh(this,l.ea,l.ea.toString(),l.ea.Ka(),l,g,h);break;case M.u.Gb:e=this.ya.keys();for(n in e){l=this.ya.get(e[n]);f=l.ea.ia;for(var r=0;r<f.length;r++)k=f[r],dh(this,k,k.toString(),k.dh(),l,g,h)}break;case M.u.Va:case M.u.vc:for(n in e=this.ya.keys(),e)for(l=this.ya.get(e[n]),k=
l.ea.xa(),r=0;r<k.length;r++){var q=k[r];f===M.u.Va?dh(this,q,q.toString(),q.Ka(),l,g,h):dh(this,q,Ua.Fc(q.symbol)[7],q.Ka(),l,g,h)}}else if(e instanceof vb)switch(f){case M.u.Va:case M.u.vc:k=e.xa();l=this.hb(e);for(n=0;n<k.length;n++)q=k[n],f===M.u.Va?dh(this,q,q.toString(),q.Ka(),l,g,h):dh(this,q,Ua.Fc(q.symbol)[7],q.Ka(),l,g,h);break;case M.u.Gb:f=e.ia;l=this.hb(e);for(n=0;n<f.length;n++)k=f[n],dh(this,k,k.toString(),k.dh(),l,g,h);break;case M.u.Vb:case void 0:l=this.hb(e),dh(this,e,e.toString(),
e.Ka(),l,g,h)}else if(e instanceof rc)switch(f){case void 0:case M.u.Gb:l=this.hb(e.ea);dh(this,e,e.toString(),e.dh(),l,g,h);break;case M.u.Va:case M.u.vc:for(this.hb(e.ea),k=e.xa(),n=0;n<k.length;n++)q=k[n],f===M.u.Va?dh(this,q,q.toString(),q.Ka(),l,g,h):dh(this,q,Ua.Fc(q.symbol)[7],q.Ka(),l,g,h)}else if(e instanceof Ea)switch(f){case void 0:case M.u.Va:case M.u.vc:l=this.hb(e.wa.ea),f===M.u.Va||void 0===f?dh(this,e,e.toString(),e.Ka(),l,g,h):dh(this,e,Ua.Fc(e.symbol)[7],e.Ka(),l,g,h)}};
function dh(e,f,g,h,k,l,n){void 0==e.Mc.get(f)&&(g=e.yf(g,l,n,h),k.labels.add(g),e.Mc.set(f,g))}z.yf=function(e,f,g,h){e=Ae(e,f);return Rd(e,h)};function qe(e,f){var g,h;if(void 0===f){var k=e.Mc.keys();for(h=0;h<k.length;h++)g=e.Mc.get(k[h]),g.parent.remove(g);e.Mc.clear()}else if(Array.isArray(f))for(h=0;h<f.length;h++)g=e.Mc.get(f[h]),null!=g&&(e.Mc.remove(f[h]),g.parent.remove(g));else g=e.Mc.remove(f),null!=g&&g.parent.remove(g)}M.u={xf:"structure",Vb:"molecule",Gb:"residue",Va:"atom",vc:"vdw"};
function eh(){}eh.prototype.$a=function(){};
function fh(e,f,g){var h=[],k,l=P.Bd;switch(f.type){case gh:e=We(f.ab(e)[0]);for(var n in e)if(f=e[n],k=f.Jb(),void 0===g)0===k.length&&(k=fg(f,l)),h=h.concat(k);else for(var r in k)k[r].$c===g.name&&h.push(k[r]);break;case hh:e=f.Wc(e);for(n in e)if(f=e[n],k=f.Jb(),void 0===g)0===k.length&&(k=fg(f,l)),h=h.concat(k);else for(r in k)k[r].$c===g.name&&h.push(k[r]);break;case ih:f=f.hb(e)[0];k=f.Jb();if(void 0===g)0===k.length&&(k=fg(f,l)),h=h.concat(k);else for(r in k)k[r].$c===g.name&&h.push(k[r]);
break;case jh:n=f.oc(e)[0];if(null!==n&&void 0!==n)if(k=n.Jb(),void 0===g)0===k.length&&(k=fg(n,l)),h=h.concat(k);else for(r in k)k[r].$c===g.name&&h.push(k[r]);break;case kh:if(n=f.od(e)[0],null!==n&&void 0!==n&&(k=n.Jb()),void 0===g)0===k.length&&(k=fg(n,l)),h=h.concat(k);else for(r in k)k[r].$c===g.name&&h.push(k[r])}return h}function lh(){this.li=this.Og=this.rb=this.Yc=this.Ob=this.rc=this.type=null;this.$i="\x00"}lh.prototype=Object.create(eh.prototype);lh.prototype.constructor=lh;
var gh="STRUCTURE",hh="MOL_TYPE",ih="MOLECULE",jh="RESIDUE",kh="ATOM";z=lh.prototype;z.$a=function(e){console.log(this.Wc(e))};z.Wc=function(e){switch(this.type){case "SCENE":return e;case gh:return e.ab(this.Ob);case hh:return je(e,this.Ob,this.rc);case ih:return je(e,this.Ob,this.rc,this.Yc);case jh:return e.oc(this.Ob,this.rc,this.Yc,this.rb,this.$i,!0);case kh:return e.od(this.Ob,this.rc,this.Yc,this.Og,this.li,!0);default:return null}};z.ab=function(e){return e.ab(this.Ob)};
z.hb=function(e){return je(e,this.Ob,this.rc,this.Yc)};z.oc=function(e){return e.oc(this.Ob,this.rc,this.Yc,this.rb,this.$i,!0)};z.od=function(e){return e.od(this.Ob,this.rc,this.Yc,this.Og,this.li,!0)};function mh(e){this.v=nh;this.ba=e;this.u=[];new EventTarget(mh.prototype)}function ScriptEngine(e){this.scene3D=e;this.u=this.scene3D.animations;this.Hc=!0;this.u.pause=this.Hc;this.v=this.fa=this.aa=this.currentTime=this.da=null;new EventTarget(ScriptEngine.prototype)}z=ScriptEngine.prototype;
z.update=function(e){if(!this.Hc){this.currentTime+=e;if(0<this.da)this.da-=e;else for(var f=0;this.v.length;f++){var g=this.v.remove();if(!1===g){console.log("Finish script");break}else void 0!==g&&void 0!==g.$a||console.warn("WARNING : the command didn't return a class with execute function");if(g instanceof oh){this.da=g.duration;break}else try{g.$a(this.scene3D.ba)}catch(h){console.warn("Error on parsing script : "+h+"\nOn stack : "+(h.stack?h.stack:"Unknown")+"\nComing from command "+g.constructor.name);
break}}0!==this.u.zc.length&&ef(this.u,e);this.currentTime>this.aa&&this.pb("endScript");this.pb({type:"timeChanged",data:{currentTime:this.currentTime,progress:this.currentTime/this.aa}})}};
function ph(e,f){qh(e);var g=e.u;g.zc.splice(0,g.zc.length);e.currentTime=f.value*e.aa;for(var h=0,g=[],k=0;e.v.length;k++){var l=e.v.remove();if(!1===l){console.log("Finish script");break}else void 0!==l&&void 0!==l.$a||console.warn("The command didn't return a class with execute function");if(l instanceof oh){for(var l=l.duration,n=g.length,k=0;k<n;k++)try{g[k].$a(e.scene3D.ba)}catch(r){console.warn("Error on parsing script : "+r+"\nOn stack : "+(r.stack?r.stack:"Unknown")+"\nComing from command "+
g[k].constructor.name);break}g.splice(0,g.length);if(h+l>e.currentTime){h=e.currentTime-h;ef(e.u,h,!0);e.da=l-h;break}else ef(e.u,l,!0),h+=l}else g.push(l)}n=g.length;if(0<n){for(k=0;k<n;k++)try{g[k].$a(e.scene3D.ba)}catch(r){console.warn("Error on parsing script : "+r+"\nOn stack : "+(r.stack?r.stack:"Unknown")+"\nComing from command "+g[k].constructor.name);break}e.pb("endScript")}}z.dc=function(e){this.u.dc(e)};
z.play=function(){this.Hc=!1;this.u.pause=this.Hc;ph(this,{type:"update",value:this.currentTime/this.aa})};z.stop=function(){this.Hc=!0;this.u.pause=this.Hc;qh(this);var e=this.u;e.zc.splice(0,e.zc.length);this.scene3D.reset();this.pb({type:"timeChanged",data:{currentTime:this.currentTime,progress:this.currentTime/this.aa}})};z.pause=function(){this.Hc=!0;this.u.pause=this.Hc};function qh(e){e.currentTime=0;e.da=0;e.v=e.fa.slice(0);e.v.add=e.v.push;e.v.remove=e.v.shift}
function rh(e,f,g){this.ai=e;this.lc=f;this.Zh=g?g.get("full"):!1;this.Yh=g?g.get("duration"):0}rh.prototype=Object.create(eh.prototype);rh.prototype.constructor=rh;
rh.prototype.$a=function(e){var f;f=this.ai.hb(e)[0];var g=this.lc.hb(e)[0],h=new Bd,k=f.ea,l=g.ea;h.v=null;h.aa=null;h.u=NaN;if(k&&l)if(k!==l){var n;n=k.td()?new fc:new fc(zd);var r=[];r.push(Dd("SRC:",k));r.push(Dd("DST:",l));n=n.da(r);h.v=n;k=Cd(k,h.v.Rd("SRC:"+k.toString()));l=Cd(l,h.v.Rd("DST:"+l.toString()));if(null===k||null===l||k.length!==l.length)throw"Illegal argument exception";n=[];for(var r=[],q=k.length,t=0;t<q;t++){var x=k[t],w=l[t];null!==x&&null!==w&&(n.push([x.x,x.y,x.z]),r.push([w.x,
w.y,w.z]))}r=[n,r];n=r[0];r=r[1];if(3>k.length)console.error("Need at least 3 paired coordinates. Found only "+k.length);else{r=numeric.transpose(r);r=numeric.dot(r,n);n=numeric.svd(r);r=[[1,0,0],[0,1,0],[0,0,Math.sign(numeric.det(r))]];r=numeric.dot(numeric.dot(n.V,r),numeric.transpose(n.U));n=new THREE.Matrix4;n.set(r[0][0],r[1][0],r[2][0],0,r[0][1],r[1][1],r[2][1],0,r[0][2],r[1][2],r[2][2],0,0,0,0,1);h.u=0;r=k.length;for(q=0;q<r;q++)x=k[q],t=l[q],null!==x&&null!==t&&(x=x.clone().applyMatrix4(n),
t=t.clone(),h.u+=x.distanceToSquared(t));h.aa=n;h.u=Math.sqrt(h.u/k.length)}}else console.warn("Same src and dst molecule, resolving alignement"),n=[],n.push(Dd("SRC:",k)),n.push(Dd("DST:",l)),h.v=new ld(n),h.aa=new THREE.Matrix4,h.u=0;else console.error("Source ("+k+") or dest ("+l+") is not a polymer");h=h.aa;null!==h?(l=sh(this,e).matrixWorld,k=(new THREE.Matrix4).getInverse(l),t=f.matrixWorld,q=g.matrixWorld,l=(new THREE.Matrix4).extractRotation(l),n=(new THREE.Matrix4).extractRotation(q),r=this.Zh?
(new THREE.Matrix4).extractRotation((new THREE.Matrix4).getInverse(f.matrix)):new THREE.Matrix4,f=f.ea.Ka().clone().applyMatrix4(t),q=g.ea.Ka().clone().applyMatrix4(q),g=new THREE.Vector3,g.setFromMatrixPosition((new THREE.Matrix4).multiply(k).multiply((new THREE.Matrix4).setPosition(f))),f=(new THREE.Vector3).subVectors(q,f),f=(new THREE.Matrix4).multiply((new THREE.Matrix4).setPosition(Wd(k,f))).multiply((new THREE.Matrix4).setPosition(g)).multiply((new THREE.Matrix4).getInverse(l)).multiply(n).multiply(h).multiply(r).multiply((new THREE.Matrix4).setPosition(g.clone().negate()))):
f=null;g=sh(this,e);0<=this.Yh?(f=g.matrix.clone().multiply(f),bh(e.scene3D,g,f,this.Yh)):(g.matrix.multiply(f),g.matrixWorldNeedsUpdate=!0)};function sh(e,f){var g=e.ai.hb(f)[0];return e.Zh?g.ab():g}function th(e,f,g,h){this.alpha=f;this.target=e;this.sc=h;this.duration=g?g.get("duration"):void 0}th.prototype=Object.create(eh.prototype);th.prototype.constructor=th;th.prototype.$a=function(e){e=fh(e,this.target,this.sc);for(var f in e)e[f].hg(this.alpha,this.duration)};
function uh(e,f,g){this.target=e;this.zoom=g;this.duration=f?f.get("duration"):0}uh.prototype=Object.create(eh.prototype);uh.prototype.constructor=uh;uh.prototype.$a=function(e){var f=this.target.ab(e)[0];if(void 0!==f)if(0>=this.duration)ke(e,f,this.zoom);else{e=e.scene3D;var g=this.duration,h=this.zoom;void 0===f&&(f=e.ka[0]);void 0===g&&(g=1E3);void 0===h&&(h=!0);f=new ff(f,e,g,h);e.animations.dc(f)}};function vh(e,f,g,h){this.target=e;this.duration=h?h.get("duration"):void 0}vh.prototype=Object.create(eh.prototype);
vh.prototype.constructor=vh;vh.prototype.$a=function(){console.log("Clip Command not supported yet")};function wh(e,f,g,h){this.target=e;this.color=f;this.sc=g;this.duration=h?h.get("duration"):void 0}wh.prototype=Object.create(eh.prototype);wh.prototype.constructor=wh;
wh.prototype.$a=function(e){var f=fh(e,this.target,this.sc);if(this.color.startsWith("#")){var g=new THREE.Color(this.color),h;for(h in f){var k=f[h].ig(255*g.r,255*g.g,255*g.b,this.duration);null!=k&&e.scene3D.animations.dc(k)}}else if(g=Gf.ek(this.color),0<this.duration)for(h in f)k=f[h].lf(g,this.duration),null!=k&&e.scene3D.animations.dc(k);else for(h in f)k=f[h].lf(g),null!=k&&e.scene3D.animations.dc(k)};
function xh(e,f){this.name="display";this.text=e;this.position=null==f?void 0:f.get("location");this.size=null==f?void 0:f.get("size");this.color=null==f?void 0:f.get("color");this.duration=null==f?void 0:f.get("duration")}xh.prototype=Object.create(eh.prototype);xh.prototype.constructor=xh;xh.prototype.$a=function(e){e.scene3D.gg(this.text,this.position,this.size,this.color,this.duration)};function yh(e,f,g){this.target=e;this.sc=f;this.enable=g}yh.prototype=Object.create(eh.prototype);
yh.prototype.constructor=yh;yh.prototype.$a=function(e){var f=this.target.Wc(e);switch(this.target.type){case gh:f=We(f);for(e=0;e<f.length;e++)f[e].tb(this.enable,this.sc);break;case hh:case ih:for(e=0;e<f.length;e++)f[e].tb(this.enable,this.sc);break;case jh:e=f[0];e.tb(this.enable,this.sc);f=e.hb();f.tb(this.enable,this.sc,e.Cb.xa());break;case kh:var g=f[0];g.tb(this.enable,this.sc);e=g.oc();e.tb(this.enable,this.sc,[g.qe]);f=g.hb();f.tb(this.enable,this.sc,[g.qe])}};
function zh(e,f){this.name="load";this.hh=e;this.hi=f}zh.prototype=Object.create(eh.prototype);zh.prototype.constructor=zh;zh.prototype.$a=function(e){e.Jc(this.hh,this.hi)};function Ah(e,f,g){this.target=e;this.matrix=f;this.duration=g?g.get("duration"):0}Ah.prototype=Object.create(eh.prototype);Ah.prototype.constructor=Ah;
Ah.prototype.$a=function(e){var f;if("SCENE"==this.target.type)f=e.scene3D;else if(this.target.type==gh)f=this.target.ab(e)[0];else if(this.target.type==ih)f=this.target.Wc(e)[0];else throw"MoveCommand only applies to Scene, Structure and Molecule targets";var g=new THREE.Matrix4;g.set(this.matrix[0],this.matrix[4],this.matrix[8],this.matrix[12],this.matrix[1],this.matrix[5],this.matrix[9],this.matrix[13],this.matrix[2],this.matrix[6],this.matrix[10],this.matrix[14],this.matrix[3],this.matrix[7],
this.matrix[11],this.matrix[15]);void 0!==f&&bh(e.scene3D,f,g,this.duration)};function Bh(e){this.hh=e}Bh.prototype=Object.create(eh.prototype);Bh.prototype.constructor=Bh;Bh.prototype.$a=function(e){var f=e.ab(this.hh);void 0!==f&&void 0!==f[0].remove&&oe(e,f[0])};function Ch(e,f,g){this.target=e;this.Ha=f;this.enable=g}Ch.prototype=Object.create(eh.prototype);Ch.prototype.constructor=Ch;
Ch.prototype.$a=function(e){e=this.target.Wc(e);for(var f in e){var g;e[f].Jk?g=We(e[f]):g=[e[f]];for(var h in g)this.enable?g[h].show(this.Ha):g[h].hide(this.Ha)}};function Dh(){}Dh.prototype=Object.create(eh.prototype);Dh.prototype.constructor=Dh;Dh.prototype.$a=function(e){e.scene3D.reset()};function Eh(e,f,g){this.Fl=e;this.value=f;this.duration=null==g?void 0:g.get("duration")}Eh.prototype=Object.create(eh.prototype);Eh.prototype.constructor=Eh;
Eh.prototype.$a=function(e){switch(this.Fl){case "background":var f=new THREE.Color(this.value),g=this.duration;g&&0<g?e.scene3D.Ld(f,g):e.ra.Ld(f);break;case "quality":se(e.Lb,this.value)}};function Fh(e,f){this.target=e;this.show=f}Fh.prototype=Object.create(eh.prototype);Fh.prototype.constructor=Fh;Fh.prototype.$a=function(e){if("SCENE"==this.target.type){e=e.scene3D.ka;var f}else e=this.target.Wc(e);for(f in e)this.show?e[f].show():e[f].hide()};function oh(e){this.duration=e}oh.prototype=Object.create(eh.prototype);
oh.prototype.constructor=oh;oh.prototype.$a=function(){};
var nh=function(){function e(f,g,h,k){this.message=f;this.location=k;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}(function(e,g){function h(){this.constructor=e}h.prototype=g.prototype;e.prototype=new h})(e,Error);return{SyntaxError:e,parse:function(f){function g(e){var g=rf[e],h,k;if(g)return g;for(h=e-1;!rf[h];)h--;g=rf[h];for(g={line:g.line,jb:g.jb,$b:g.$b};h<e;)k=f.charAt(h),"\n"===k?(g.$b||g.line++,g.jb=1,g.$b=!1):"\r"===k||"\u2028"===k||
"\u2029"===k?(g.line++,g.jb=1,g.$b=!0):(g.jb++,g.$b=!1),h++;return rf[e]=g}function h(e,f){var h=g(e),k=g(f);return{start:{offset:e,line:h.line,jb:h.jb},end:{offset:f,line:k.line,jb:k.jb}}}function k(e){p<Za||(p>Za&&(Za=p,ng=[]),ng.push(e))}function l(){var e,f,g,h;e=p;f=[];for(g=n();g!==m;)f.push(g),g=n();if(f!==m){g=[];for(f=wa();f!==m;)g.push(f),f=wa();if(g!==m){f=[];for(h=n();h!==m;)f.push(h),h=n();if(f!==m){e=g;g=[];for(var k in e)g.push(e[k]);e=g}else p=e,e=m}else p=e,e=m}else p=e,e=m;if(e===
m)for(e=[],f=n();f!==m;)e.push(f),f=n();return e}function n(){var e;32===f.charCodeAt(p)?(e=oa,p++):(e=m,0===B&&k(yb));e===m&&(9===f.charCodeAt(p)?(e=tc,p++):(e=m,0===B&&k(bb)));return e}function r(){var e;Ia.test(f.charAt(p))?(e=f.charAt(p),p++):(e=m,0===B&&k(Vb));return e}function q(){var e;Jc.test(f.charAt(p))?(e=f.charAt(p),p++):(e=m,0===B&&k(hc));return e}function t(){var e,g,h;e=p;Wb.test(f.charAt(p))?(g=f.charAt(p),p++):(g=m,0===B&&k(Kc));g!==m?(h=G(),h!==m?e=g=[g,h]:(p=e,e=m)):(p=e,e=m);return e}
function x(){var e;32===f.charCodeAt(p)?(e=oa,p++):(e=m,0===B&&k(yb));e===m&&(33===f.charCodeAt(p)?(e=ic,p++):(e=m,0===B&&k(Bb)),e===m&&(35===f.charCodeAt(p)?(e=ra,p++):(e=m,0===B&&k(eb)),e===m&&(36===f.charCodeAt(p)?(e=jc,p++):(e=m,0===B&&k(Ja)),e===m&&(37===f.charCodeAt(p)?(e=Wa,p++):(e=m,0===B&&k(fb)),e===m&&(38===f.charCodeAt(p)?(e=ia,p++):(e=m,0===B&&k(Z)),e===m&&(40===f.charCodeAt(p)?(e=ca,p++):(e=m,0===B&&k(Ca)),e===m&&(41===f.charCodeAt(p)?(e=Cb,p++):(e=m,0===B&&k(rb)),e===m&&(42===f.charCodeAt(p)?
(e=sb,p++):(e=m,0===B&&k(Ka)),e===m&&(43===f.charCodeAt(p)?(e=Db,p++):(e=m,0===B&&k(sa)),e===m&&(44===f.charCodeAt(p)?(e=Pa,p++):(e=m,0===B&&k(la)),e===m&&(45===f.charCodeAt(p)?(e=Xa,p++):(e=m,0===B&&k(ua)),e===m&&(46===f.charCodeAt(p)?(e=gb,p++):(e=m,0===B&&k(uc)),e===m&&(47===f.charCodeAt(p)?(e=vc,p++):(e=m,0===B&&k(Xb)),e===m&&(Ia.test(f.charAt(p))?(e=f.charAt(p),p++):(e=m,0===B&&k(Vb)),e===m&&(58===f.charCodeAt(p)?(e=xa,p++):(e=m,0===B&&k(ma)),e===m&&(59===f.charCodeAt(p)?(e=db,p++):(e=m,0===
B&&k(ob)),e===m&&(60===f.charCodeAt(p)?(e=ya,p++):(e=m,0===B&&k(Lc)),e===m&&(61===f.charCodeAt(p)?(e=Da,p++):(e=m,0===B&&k(Kb)),e===m&&(62===f.charCodeAt(p)?(e=Mc,p++):(e=m,0===B&&k(Nc)),e===m&&(63===f.charCodeAt(p)?(e=Yb,p++):(e=m,0===B&&k(Qa)),e===m&&(64===f.charCodeAt(p)?(e=La,p++):(e=m,0===B&&k(kc)),e===m&&(wc.test(f.charAt(p))?(e=f.charAt(p),p++):(e=m,0===B&&k(lc)),e===m&&(91===f.charCodeAt(p)?(e=hb,p++):(e=m,0===B&&k(Lb)),e===m&&(92===f.charCodeAt(p)?(e=Ya,p++):(e=m,0===B&&k(Mb)),e===m&&(93===
f.charCodeAt(p)?(e=mc,p++):(e=m,0===B&&k(Eb)),e===m&&(94===f.charCodeAt(p)?(e=va,p++):(e=m,0===B&&k(Ra)),e===m&&(95===f.charCodeAt(p)?(e=A,p++):(e=m,0===B&&k(tb)),e===m&&(96===f.charCodeAt(p)?(e=ga,p++):(e=m,0===B&&k(Zb)),e===m&&(J.test(f.charAt(p))?(e=f.charAt(p),p++):(e=m,0===B&&k(za)),e===m&&(123===f.charCodeAt(p)?(e=Aa,p++):(e=m,0===B&&k(Sa)),e===m&&(47===f.charCodeAt(p)?(e=vc,p++):(e=m,0===B&&k(Xb)),e===m&&(125===f.charCodeAt(p)?(e=W,p++):(e=m,0===B&&k(Ta)),e===m&&(126===f.charCodeAt(p)?(e=Fb,
p++):(e=m,0===B&&k(id)))))))))))))))))))))))))))))))))));return e}function w(){var e;44===f.charCodeAt(p)?(e=Pa,p++):(e=m,0===B&&k(la));return e}function C(){var e,f,g,h,k;e=p;f=[];for(g=n();g!==m;)f.push(g),g=n();if(f!==m)if(g=w(),g!==m){h=[];for(k=n();k!==m;)h.push(k),k=n();h!==m?e=f=[f,g,h]:(p=e,e=m)}else p=e,e=m;else p=e,e=m;return e}function F(){var e,f;e=[];f=r();if(f!==m)for(;f!==m;)e.push(f),f=r();else e=m;e!==m&&(e=parseInt(e.join(""),10));return e}function G(){var e,g,h;e=p;43===f.charCodeAt(p)?
(g=Db,p++):(g=m,0===B&&k(sa));g===m&&(45===f.charCodeAt(p)?(g=Xa,p++):(g=m,0===B&&k(ua)));g===m&&(g=null);g!==m?(h=F(),h!==m?e=g=parseInt(g+h,10):(p=e,e=m)):(p=e,e=m);return e}function I(){var e,g,h,l,n,q,w;e=p;g=G();g!==m?(h=t(),h!==m?e=g=parseFloat(g+h.join("")):(p=e,e=m)):(p=e,e=m);if(e===m)if(e=p,43===f.charCodeAt(p)?(g=Db,p++):(g=m,0===B&&k(sa)),g===m&&(45===f.charCodeAt(p)?(g=Xa,p++):(g=m,0===B&&k(ua))),g===m&&(g=null),g!==m){l=h=p;n=[];for(q=r();q!==m;)n.push(q),q=r();n!==m?(46===f.charCodeAt(p)?
(q=gb,p++):(q=m,0===B&&k(uc)),q!==m?(w=F(),w!==m?l=n=[n,q,w]:(p=l,l=m)):(p=l,l=m)):(p=l,l=m);if(l===m){l=p;n=[];q=r();if(q!==m)for(;q!==m;)n.push(q),q=r();else n=m;n!==m?(46===f.charCodeAt(p)?(q=gb,p++):(q=m,0===B&&k(uc)),q!==m?l=n=[n,q]:(p=l,l=m)):(p=l,l=m)}h=l!==m?f.substring(h,p):l;h!==m?(l=t(),l===m&&(l=null),l!==m?e=g=parseFloat((g?g:"")+(h?h:"")+(l?l.join(""):"")):(p=e,e=m)):(p=e,e=m)}else p=e,e=m;return e}function D(){var e;e=I();e===m&&(e=G());return e}function K(){var e,g,h,l,q,r,t,w,y,x,
A,Aa,F,Sa,W,G,H,Ta,Fb;e=p;91===f.charCodeAt(p)?(g=hb,p++):(g=m,0===B&&k(Lb));if(g!==m){h=[];for(g=n();g!==m;)h.push(g),g=n();if(h!==m)if(g=D(),g!==m)if(h=C(),h!==m)if(h=D(),h!==m)if(l=C(),l!==m)if(l=D(),l!==m)if(q=C(),q!==m)if(q=D(),q!==m)if(r=C(),r!==m)if(r=D(),r!==m)if(t=C(),t!==m)if(t=D(),t!==m)if(w=C(),w!==m)if(w=D(),w!==m)if(y=C(),y!==m)if(y=D(),y!==m)if(x=C(),x!==m)if(x=D(),x!==m)if(A=C(),A!==m)if(A=D(),A!==m)if(Aa=C(),Aa!==m)if(Aa=D(),Aa!==m)if(F=C(),F!==m)if(F=D(),F!==m)if(Sa=C(),Sa!==m)if(Sa=
D(),Sa!==m)if(W=C(),W!==m)if(W=D(),W!==m)if(G=C(),G!==m)if(G=D(),G!==m)if(H=C(),H!==m)if(H=D(),H!==m){Ta=[];for(Fb=n();Fb!==m;)Ta.push(Fb),Fb=n();Ta!==m?(93===f.charCodeAt(p)?(Fb=mc,p++):(Fb=m,0===B&&k(Eb)),Fb!==m?e=g=[g,h,l,q,r,t,w,y,x,A,Aa,F,Sa,W,G,H]:(p=e,e=m)):(p=e,e=m)}else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=
e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m}else p=e,e=m;return e}function H(){var e,g;e=[];Jh.test(f.charAt(p))?(g=f.charAt(p),p++):(g=m,0===B&&k(Kh));if(g!==m)for(;g!==m;)e.push(g),Jh.test(f.charAt(p))?(g=f.charAt(p),p++):(g=m,0===B&&k(Kh));else e=m;e!==m&&(e=e.join(""));return e}function L(){var e,g,h,l;e=p;39===f.charCodeAt(p)?(g=Na,p++):(g=m,0===B&&k(pb));
if(g!==m){h=[];f.substr(p,2)===Ab?(l=Ab,p+=2):(l=m,0===B&&k(Oa));l===m&&(34===f.charCodeAt(p)?(l=qa,p++):(l=m,0===B&&k(N)),l===m&&(l=x()));for(;l!==m;)h.push(l),f.substr(p,2)===Ab?(l=Ab,p+=2):(l=m,0===B&&k(Oa)),l===m&&(34===f.charCodeAt(p)?(l=qa,p++):(l=m,0===B&&k(N)),l===m&&(l=x()));h!==m?(39===f.charCodeAt(p)?(l=Na,p++):(l=m,0===B&&k(pb)),l!==m?e=g=[g,h,l]:(p=e,e=m)):(p=e,e=m)}else p=e,e=m;if(e===m)if(e=p,34===f.charCodeAt(p)?(g=qa,p++):(g=m,0===B&&k(N)),g!==m){h=[];f.substr(p,2)===R?(l=R,p+=2):
(l=m,0===B&&k(qb));l===m&&(39===f.charCodeAt(p)?(l=Na,p++):(l=m,0===B&&k(pb)),l===m&&(l=x()));for(;l!==m;)h.push(l),f.substr(p,2)===R?(l=R,p+=2):(l=m,0===B&&k(qb)),l===m&&(39===f.charCodeAt(p)?(l=Na,p++):(l=m,0===B&&k(pb)),l===m&&(l=x()));h!==m?(34===f.charCodeAt(p)?(l=qa,p++):(l=m,0===B&&k(N)),l!==m?e=g=[g,h,l]:(p=e,e=m)):(p=e,e=m)}else p=e,e=m;return e}function O(){var e,g,h,l,r,t;g=p;var w,y,x;e=p;35===f.charCodeAt(p)?(h=ra,p++):(h=m,0===B&&k(eb));h===m&&(f.substr(p,2)===Lh?(h=Lh,p+=2):(h=m,0===
B&&k(Ej)));h!==m?(l=q(),l!==m?(r=q(),r!==m?(t=q(),t!==m?(w=q(),w!==m?(y=q(),y!==m?(x=q(),x!==m?e=h=[h,l,r,t,w,y,x]:(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m);h=e;e=g=h!==m?f.substring(g,p):h;if(e===m)if(e=p,f.substr(p,4)===Mh?(g=Mh,p+=4):(g=m,0===B&&k(Fj)),g!==m){h=[];for(g=n();g!==m;)h.push(g),g=n();if(h!==m)if(g=D(),g!==m)if(h=C(),h!==m)if(h=D(),h!==m)if(l=C(),l!==m)if(l=D(),l!==m){r=[];for(t=n();t!==m;)r.push(t),t=n();r!==m?(41===f.charCodeAt(p)?(t=Cb,p++):(t=m,
0===B&&k(rb)),t!==m?e=g="#"+("0"+g.toString(16)).slice(-2)+("0"+h.toString(16)).slice(-2)+("0"+l.toString(16)).slice(-2):(p=e,e=m)):(p=e,e=m)}else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m;else p=e,e=m}else p=e,e=m;return e}function S(){var e;e=O();e===m&&(e=H());return e}function X(){var e,g;e=p;var h,l,n,q;g=p;84===f.charCodeAt(p)?(h=$b,p++):(h=m,0===B&&k(Pb));h===m&&(116===f.charCodeAt(p)?(h=nc,p++):(h=m,0===B&&k(Ba)));h!==m?(82===f.charCodeAt(p)?(l=yc,p++):(l=m,0===B&&k(og)),
l===m&&(114===f.charCodeAt(p)?(l=sd,p++):(l=m,0===B&&k(Qb))),l!==m?(85===f.charCodeAt(p)?(n=Gj,p++):(n=m,0===B&&k(Hj)),n===m&&(117===f.charCodeAt(p)?(n=Ij,p++):(n=m,0===B&&k(Jj))),n!==m?(69===f.charCodeAt(p)?(q=zc,p++):(q=m,0===B&&k(Qc)),q===m&&(101===f.charCodeAt(p)?(q=oc,p++):(q=m,0===B&&k(pc))),q!==m?g=h=[h,l,n,q]:(p=g,g=m)):(p=g,g=m)):(p=g,g=m)):(p=g,g=m);g===m&&(g=p,79===f.charCodeAt(p)?(h=Ie,p++):(h=m,0===B&&k(Je)),h===m&&(111===f.charCodeAt(p)?(h=Ke,p++):(h=m,0===B&&k(Le))),h!==m?(78===f.charCodeAt(p)?
(l=Ac,p++):(l=m,0===B&&k(Rb)),l===m&&(110===f.charCodeAt(p)?(l=Bc,p++):(l=m,0===B&&k(Sb))),l!==m?g=h=[h,l]:(p=g,g=m)):(p=g,g=m));if(g===m){var r;g=p;70===f.charCodeAt(p)?(h=pg,p++):(h=m,0===B&&k(qg));h===m&&(102===f.charCodeAt(p)?(h=rg,p++):(h=m,0===B&&k(sg)));h!==m?(65===f.charCodeAt(p)?(l=Me,p++):(l=m,0===B&&k(Ne)),l===m&&(97===f.charCodeAt(p)?(l=Oe,p++):(l=m,0===B&&k(Pe))),l!==m?(76===f.charCodeAt(p)?(n=Qe,p++):(n=m,0===B&&k(Re)),n===m&&(108===f.charCodeAt(p)?(n=Se,p++):(n=m,0===B&&k(Te))),n!==
m?(83===f.charCodeAt(p)?(q=tg,p++):(q=m,0===B&&k(ug)),q===m&&(115===f.charCodeAt(p)?(q=vg,p++):(q=m,0===B&&k(wg))),q!==m?(69===f.charCodeAt(p)?(r=zc,p++):(r=m,0===B&&k(Qc)),r===m&&(101===f.charCodeAt(p)?(r=oc,p++):(r=m,0===B&&k(pc))),r!==m?g=h=[h,l,n,q,r]:(p=g,g=m)):(p=g,g=m)):(p=g,g=m)):(p=g,g=m)):(p=g,g=m);g===m&&(g=p,79===f.charCodeAt(p)?(h=Ie,p++):(h=m,0===B&&k(Je)),h===m&&(111===f.charCodeAt(p)?(h=Ke,p++):(h=m,0===B&&k(Le))),h!==m?(70===f.charCodeAt(p)?(l=pg,p++):(l=m,0===B&&k(qg)),l===m&&(102===
f.charCodeAt(p)?(l=rg,p++):(l=m,0===B&&k(sg))),l!==m?(70===f.charCodeAt(p)?(n=pg,p++):(n=m,0===B&&k(qg)),n===m&&(102===f.charCodeAt(p)?(n=rg,p++):(n=m,0===B&&k(sg))),n!==m?g=h=[h,l,n]:(p=g,g=m)):(p=g,g=m)):(p=g,g=m))}e=g!==m?f.substring(e,p):g;e!==m&&(e="true"===e.toLowerCase()||"on"===e.toLowerCase());return e}function pa(){var e;e=O();if(e===m){var g,h;e=p;g=D();g!==m?(37===f.charCodeAt(p)?(h=Wa,p++):(h=m,0===B&&k(fb)),h!==m?e=g=[g,h]:(p=e,e=m)):(p=e,e=m);e!==m&&(e=e.join(""));e===m&&(e=D(),e===
m&&(e=Y(),e===m&&(e=K(),e===m&&(e=L(),e===m&&(e=X(),e===m&&(e=H()))))))}return e}function na(){var e,g,h,l;e=p;40===f.charCodeAt(p)?(g=ca,p++):(g=m,0===B&&k(Ca));if(g!==m){var q,r;g=p;h=H();if(h!==m){l=[];for(q=n();q!==m;)l.push(q),q=n();if(l!==m)if(61===f.charCodeAt(p)?(q=Da,p++):(q=m,0===B&&k(Kb)),q!==m){q=[];for(l=n();l!==m;)q.push(l),l=n();if(q!==m)if(l=pa(),l!==m){q=[];for(r=n();r!==m;)q.push(r),r=n();q!==m?g=h=[h,l]:(p=g,g=m)}else p=g,g=m;else p=g,g=m}else p=g,g=m;else p=g,g=m}else p=g,g=m;
h=g;if(h!==m){g=[];for(l=Hb();l!==m;)g.push(l),l=Hb();if(g!==m)if(41===f.charCodeAt(p)?(l=Cb,p++):(l=m,0===B&&k(rb)),l!==m){e=new Map;e.set(h[0],h[1]);for(var t in g)h=g[t],e.set(h[0],h[1])}else p=e,e=m;else p=e,e=m}else p=e,e=m}else p=e,e=m;return e}function Hb(){var e,g,h,l,q;e=p;g=[];for(h=n();h!==m;)g.push(h),h=n();if(g!==m)if(h=w(),h!==m){h=[];for(g=n();g!==m;)h.push(g),g=n();if(h!==m)if(g=H(),g!==m){h=[];for(l=n();l!==m;)h.push(l),l=n();if(h!==m)if(61===f.charCodeAt(p)?(l=Da,p++):(l=m,0===B&&
k(Kb)),l!==m){l=[];for(h=n();h!==m;)l.push(h),h=n();if(l!==m)if(h=pa(),h!==m){l=[];for(q=n();q!==m;)l.push(q),q=n();l!==m?e=g=[g,h]:(p=e,e=m)}else p=e,e=m;else p=e,e=m}else p=e,e=m;else p=e,e=m}else p=e,e=m;else p=e,e=m}else p=e,e=m;else p=e,e=m;return e}function Tb(){var e,g,h,l,n,q,r,t;e=p;80===f.charCodeAt(p)?(g=xg,p++):(g=m,0===B&&k(yg));g===m&&(112===f.charCodeAt(p)?(g=zg,p++):(g=m,0===B&&k(Ag)));g!==m?(69===f.charCodeAt(p)?(h=zc,p++):(h=m,0===B&&k(Qc)),h===m&&(101===f.charCodeAt(p)?(h=oc,p++):
(h=m,0===B&&k(pc))),h!==m?(80===f.charCodeAt(p)?(l=xg,p++):(l=m,0===B&&k(yg)),l===m&&(112===f.charCodeAt(p)?(l=zg,p++):(l=m,0===B&&k(Ag))),l!==m?(84===f.charCodeAt(p)?(n=$b,p++):(n=m,0===B&&k(Pb)),n===m&&(116===f.charCodeAt(p)?(n=nc,p++):(n=m,0===B&&k(Ba))),n!==m?(73===f.charCodeAt(p)?(q=sf,p++):(q=m,0===B&&k(tf)),q===m&&(105===f.charCodeAt(p)?(q=uf,p++):(q=m,0===B&&k(vf))),q!==m?(68===f.charCodeAt(p)?(r=Bg,p++):(r=m,0===B&&k(Cg)),r===m&&(100===f.charCodeAt(p)?(r=Dg,p++):(r=m,0===B&&k(Eg))),r!==m?
(69===f.charCodeAt(p)?(t=zc,p++):(t=m,0===B&&k(Qc)),t===m&&(101===f.charCodeAt(p)?(t=oc,p++):(t=m,0===B&&k(pc))),t!==m?e=g=[g,h,l,n,q,r,t]:(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m);return e}function ba(){var e,g,h,l,q,r,t,w;e=p;80===f.charCodeAt(p)?(g=xg,p++):(g=m,0===B&&k(yg));g===m&&(112===f.charCodeAt(p)?(g=zg,p++):(g=m,0===B&&k(Ag)));g!==m?(82===f.charCodeAt(p)?(h=yc,p++):(h=m,0===B&&k(og)),h===m&&(114===f.charCodeAt(p)?(h=sd,p++):(h=m,0===B&&k(Qb))),h!==m?(79===
f.charCodeAt(p)?(l=Ie,p++):(l=m,0===B&&k(Je)),l===m&&(111===f.charCodeAt(p)?(l=Ke,p++):(l=m,0===B&&k(Le))),l!==m?(84===f.charCodeAt(p)?(q=$b,p++):(q=m,0===B&&k(Pb)),q===m&&(116===f.charCodeAt(p)?(q=nc,p++):(q=m,0===B&&k(Ba))),q!==m?(69===f.charCodeAt(p)?(r=zc,p++):(r=m,0===B&&k(Qc)),r===m&&(101===f.charCodeAt(p)?(r=oc,p++):(r=m,0===B&&k(pc))),r!==m?(73===f.charCodeAt(p)?(t=sf,p++):(t=m,0===B&&k(tf)),t===m&&(105===f.charCodeAt(p)?(t=uf,p++):(t=m,0===B&&k(vf))),t!==m?(78===f.charCodeAt(p)?(w=Ac,p++):
(w=m,0===B&&k(Rb)),w===m&&(110===f.charCodeAt(p)?(w=Bc,p++):(w=m,0===B&&k(Sb))),w!==m?e=g=[g,h,l,q,r,t,w]:(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m);e===m&&(e=Tb(),e===m&&(e=p,83===f.charCodeAt(p)?(g=tg,p++):(g=m,0===B&&k(ug)),g===m&&(115===f.charCodeAt(p)?(g=vg,p++):(g=m,0===B&&k(wg))),g!==m?(77===f.charCodeAt(p)?(h=Kj,p++):(h=m,0===B&&k(Lj)),h===m&&(109===f.charCodeAt(p)?(h=Mj,p++):(h=m,0===B&&k(Nj))),h!==m?(65===f.charCodeAt(p)?(l=Me,p++):(l=m,0===B&&k(Ne)),l===
m&&(97===f.charCodeAt(p)?(l=Oe,p++):(l=m,0===B&&k(Pe))),l!==m?(76===f.charCodeAt(p)?(q=Qe,p++):(q=m,0===B&&k(Re)),q===m&&(108===f.charCodeAt(p)?(q=Se,p++):(q=m,0===B&&k(Te))),q!==m?(76===f.charCodeAt(p)?(r=Qe,p++):(r=m,0===B&&k(Re)),r===m&&(108===f.charCodeAt(p)?(r=Se,p++):(r=m,0===B&&k(Te))),r!==m?(t=n(),t!==m?(w=Tb(),w!==m?e=g=[g,h,l,q,r,t,w]:(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m),e===m&&(e=p,82===f.charCodeAt(p)?(g=yc,p++):(g=m,0===B&&k(og)),g===m&&(114===f.charCodeAt(p)?
(g=sd,p++):(g=m,0===B&&k(Qb))),g!==m?(78===f.charCodeAt(p)?(h=Ac,p++):(h=m,0===B&&k(Rb)),h===m&&(110===f.charCodeAt(p)?(h=Bc,p++):(h=m,0===B&&k(Sb))),h!==m?(65===f.charCodeAt(p)?(l=Me,p++):(l=m,0===B&&k(Ne)),l===m&&(97===f.charCodeAt(p)?(l=Oe,p++):(l=m,0===B&&k(Pe))),l!==m?e=g=[g,h,l]:(p=e,e=m)):(p=e,e=m)):(p=e,e=m),e===m&&(e=p,68===f.charCodeAt(p)?(g=Bg,p++):(g=m,0===B&&k(Cg)),g===m&&(100===f.charCodeAt(p)?(g=Dg,p++):(g=m,0===B&&k(Eg))),g!==m?(78===f.charCodeAt(p)?(h=Ac,p++):(h=m,0===B&&k(Rb)),h===
m&&(110===f.charCodeAt(p)?(h=Bc,p++):(h=m,0===B&&k(Sb))),h!==m?(65===f.charCodeAt(p)?(l=Me,p++):(l=m,0===B&&k(Ne)),l===m&&(97===f.charCodeAt(p)?(l=Oe,p++):(l=m,0===B&&k(Pe))),l!==m?e=g=[g,h,l]:(p=e,e=m)):(p=e,e=m)):(p=e,e=m),e===m&&(e=p,76===f.charCodeAt(p)?(g=Qe,p++):(g=m,0===B&&k(Re)),g===m&&(108===f.charCodeAt(p)?(g=Se,p++):(g=m,0===B&&k(Te))),g!==m?(73===f.charCodeAt(p)?(h=sf,p++):(h=m,0===B&&k(tf)),h===m&&(105===f.charCodeAt(p)?(h=uf,p++):(h=m,0===B&&k(vf))),h!==m?(71===f.charCodeAt(p)?(l=Oj,
p++):(l=m,0===B&&k(Pj)),l===m&&(103===f.charCodeAt(p)?(l=Qj,p++):(l=m,0===B&&k(Rj))),l!==m?(65===f.charCodeAt(p)?(q=Me,p++):(q=m,0===B&&k(Ne)),q===m&&(97===f.charCodeAt(p)?(q=Oe,p++):(q=m,0===B&&k(Pe))),q!==m?(78===f.charCodeAt(p)?(r=Ac,p++):(r=m,0===B&&k(Rb)),r===m&&(110===f.charCodeAt(p)?(r=Bc,p++):(r=m,0===B&&k(Sb))),r!==m?(68===f.charCodeAt(p)?(t=Bg,p++):(t=m,0===B&&k(Cg)),t===m&&(100===f.charCodeAt(p)?(t=Dg,p++):(t=m,0===B&&k(Eg))),t!==m?e=g=[g,h,l,q,r,t]:(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=
e,e=m)):(p=e,e=m)):(p=e,e=m),e===m&&(e=p,73===f.charCodeAt(p)?(g=sf,p++):(g=m,0===B&&k(tf)),g===m&&(105===f.charCodeAt(p)?(g=uf,p++):(g=m,0===B&&k(vf))),g!==m?(79===f.charCodeAt(p)?(h=Ie,p++):(h=m,0===B&&k(Je)),h===m&&(111===f.charCodeAt(p)?(h=Ke,p++):(h=m,0===B&&k(Le))),h!==m?(78===f.charCodeAt(p)?(l=Ac,p++):(l=m,0===B&&k(Rb)),l===m&&(110===f.charCodeAt(p)?(l=Bc,p++):(l=m,0===B&&k(Sb))),l!==m?e=g=[g,h,l]:(p=e,e=m)):(p=e,e=m)):(p=e,e=m),e===m&&(e=p,83===f.charCodeAt(p)?(g=tg,p++):(g=m,0===B&&k(ug)),
g===m&&(115===f.charCodeAt(p)?(g=vg,p++):(g=m,0===B&&k(wg))),g!==m?(79===f.charCodeAt(p)?(h=Ie,p++):(h=m,0===B&&k(Je)),h===m&&(111===f.charCodeAt(p)?(h=Ke,p++):(h=m,0===B&&k(Le))),h!==m?(76===f.charCodeAt(p)?(l=Qe,p++):(l=m,0===B&&k(Re)),l===m&&(108===f.charCodeAt(p)?(l=Se,p++):(l=m,0===B&&k(Te))),l!==m?(86===f.charCodeAt(p)?(q=Sj,p++):(q=m,0===B&&k(Tj)),q===m&&(118===f.charCodeAt(p)?(q=Uj,p++):(q=m,0===B&&k(Vj))),q!==m?(69===f.charCodeAt(p)?(r=zc,p++):(r=m,0===B&&k(Qc)),r===m&&(101===f.charCodeAt(p)?
(r=oc,p++):(r=m,0===B&&k(pc))),r!==m?(78===f.charCodeAt(p)?(t=Ac,p++):(t=m,0===B&&k(Rb)),t===m&&(110===f.charCodeAt(p)?(t=Bc,p++):(t=m,0===B&&k(Sb))),t!==m?(84===f.charCodeAt(p)?(w=$b,p++):(w=m,0===B&&k(Pb)),w===m&&(116===f.charCodeAt(p)?(w=nc,p++):(w=m,0===B&&k(Ba))),w!==m?e=g=[g,h,l,q,r,t,w]:(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m))))))));e!==m&&(e=e.join(""));return e}function Y(){var e;f.substr(p,5)===Nh?(e=Nh,p+=5):(e=m,0===B&&k(Wj));e!==m&&(e=new lh,e.type=
"SCENE");if(e===m){var g,h;e=p;f.substr(p,9)===Oh?(g=Oh,p+=9):(g=m,0===B&&k(Xj));if(g!==m){h=[];for(g=n();g!==m;)h.push(g),g=n();h!==m?(g=H(),g!==m?(e=new lh,e.type=gh,e.Ob=g.toUpperCase()):(p=e,e=m)):(p=e,e=m)}else p=e,e=m;if(e===m){e=p;f.substr(p,7)===Ph?(g=Ph,p+=7):(g=m,0===B&&k(Yj));if(g!==m){h=[];for(g=n();g!==m;)h.push(g),g=n();h!==m?(g=H(),g!==m?(58===f.charCodeAt(p)?(h=xa,p++):(h=m,0===B&&k(ma)),h!==m?(h=ba(),h!==m?(e=new lh,e.type=hh,e.rc=h.toUpperCase(),e.Ob=g.toUpperCase()):(p=e,e=m)):
(p=e,e=m)):(p=e,e=m)):(p=e,e=m)}else p=e,e=m;if(e===m){var l;e=p;f.substr(p,8)===Qh?(g=Qh,p+=8):(g=m,0===B&&k(Zj));if(g!==m){h=[];for(g=n();g!==m;)h.push(g),g=n();h!==m?(g=H(),g!==m?(58===f.charCodeAt(p)?(h=xa,p++):(h=m,0===B&&k(ma)),h!==m?(h=ba(),h!==m?(58===f.charCodeAt(p)?(l=xa,p++):(l=m,0===B&&k(ma)),l!==m?(l=H(),l!==m?(e=new lh,e.type=ih,e.Ob=g.toUpperCase(),e.rc=h.toUpperCase(),e.Yc=l):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)}else p=e,e=m;if(e===m){var q,r,t,w;e=p;f.substr(p,
7)===Rh?(g=Rh,p+=7):(g=m,0===B&&k(ak));if(g!==m){h=[];for(g=n();g!==m;)h.push(g),g=n();h!==m?(g=H(),g!==m?(58===f.charCodeAt(p)?(h=xa,p++):(h=m,0===B&&k(ma)),h!==m?(h=ba(),h!==m?(58===f.charCodeAt(p)?(l=xa,p++):(l=m,0===B&&k(ma)),l!==m?(l=H(),l!==m?(58===f.charCodeAt(p)?(q=xa,p++):(q=m,0===B&&k(ma)),q!==m?(q=r=p,t=H(),t!==m?(58===f.charCodeAt(p)?(w=xa,p++):(w=m,0===B&&k(ma)),w!==m?q=t=[t,w]:(p=q,q=m)):(p=q,q=m),q===m&&(q=null),r=q!==m?f.substring(r,p):q,r!==m?(q=p,t=G(),q=t!==m?f.substring(q,p):t,
q!==m?(e=new lh,e.type=jh,e.Ob=g.toUpperCase(),e.rc=h.toUpperCase(),e.Yc=l,e.rb=parseInt(q)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)}else p=e,e=m;if(e===m)if(e=p,f.substr(p,4)===Sh?(g=Sh,p+=4):(g=m,0===B&&k(bk)),g!==m){h=[];for(g=n();g!==m;)h.push(g),g=n();h!==m?(g=H(),g!==m?(58===f.charCodeAt(p)?(h=xa,p++):(h=m,0===B&&k(ma)),h!==m?(h=ba(),h!==m?(58===f.charCodeAt(p)?(l=xa,p++):(l=m,0===B&&k(ma)),l!==m?(l=H(),l!==m?(58===f.charCodeAt(p)?(q=
xa,p++):(q=m,0===B&&k(ma)),q!==m?(q=r=p,t=H(),t!==m?(58===f.charCodeAt(p)?(w=xa,p++):(w=m,0===B&&k(ma)),w!==m?q=t=[t,w]:(p=q,q=m)):(p=q,q=m),q===m&&(q=null),r=q!==m?f.substring(r,p):q,r!==m?(q=p,t=G(),q=t!==m?f.substring(q,p):t,q!==m?(e=new lh,e.type=kh,e.Ob=g.toUpperCase(),e.rc=h.toUpperCase(),e.Yc=l,e.Og=parseInt(q)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)):(p=e,e=m)}else p=e,e=m}}}}return e}function wa(){var e,g,h,l,q;e=p;g=[];for(h=n();h!==m;)g.push(h),
h=n();if(g!==m){var r,t,w,y,x,A;r=p;f.substr(p,4)===Th?(t=Th,p+=4):(t=m,0===B&&k(ck));if(t!==m){w=[];for(y=n();y!==m;)w.push(y),y=n();if(w!==m)if(y=H(),y!==m){x=[];for(A=n();A!==m;)x.push(A),A=n();if(x!==m){var Aa,C,Sa,W;Aa=p;f.substr(p,2)===Uh?(C=Uh,p+=2):(C=m,0===B&&k(dk));if(C!==m){Sa=[];for(W=n();W!==m;)Sa.push(W),W=n();Sa!==m?(W=H(),W!==m?Aa=C=W:(p=Aa,Aa=m)):(p=Aa,Aa=m)}else p=Aa,Aa=m;A=Aa;A===m&&(A=null);A!==m?r=t=new zh(y.toUpperCase(),A):(p=r,r=m)}else p=r,r=m}else p=r,r=m;else p=r,r=m}else p=
r,r=m;h=r;if(h===m){var D,G,Fb,Ta,id,J,$b;D=p;f.substr(p,7)===Vh?(G=Vh,p+=7):(G=m,0===B&&k(ek));if(G!==m){Fb=[];for(Ta=n();Ta!==m;)Fb.push(Ta),Ta=n();if(Fb!==m)if(Ta=na(),Ta===m&&(Ta=null),Ta!==m){id=[];for(J=n();J!==m;)id.push(J),J=n();if(id!==m)if(J=p,$b=L(),J=$b!==m?f.substring(J,p):$b,J!==m){var N=J,N=N.substring(0).substring(N.length-1,1);D=G=new xh(N,Ta)}else p=D,D=m;else p=D,D=m}else p=D,D=m;else p=D,D=m}else p=D,D=m;h=D;if(h===m){var Pb,R,V,nc;Pb=p;f.substr(p,6)===Wh?(R=Wh,p+=6):(R=m,0===
B&&k(fk));if(R!==m){V=[];for(nc=n();nc!==m;)V.push(nc),nc=n();V!==m?(nc=H(),nc!==m?Pb=R=new Bh(nc.toUpperCase()):(p=Pb,Pb=m)):(p=Pb,Pb=m)}else p=Pb,Pb=m;h=Pb;if(h===m){var Ba,yc,ia,ca,oa,Z,pa,ba;Ba=p;f.substr(p,3)===Xh?(yc=Xh,p+=3):(yc=m,0===B&&k(gk));if(yc!==m){ia=[];for(ca=n();ca!==m;)ia.push(ca),ca=n();if(ia!==m)if(ca=H(),ca!==m){oa=[];for(Z=n();Z!==m;)oa.push(Z),Z=n();if(oa!==m)if(Z=na(),Z===m&&(Z=null),Z!==m){pa=[];for(ba=n();ba!==m;)pa.push(ba),ba=n();if(pa!==m)if(ba=O(),ba===m&&(ba=H()),ba!==
m){var ma=ca,va=Z,qa=ba;"background"===ma?yc=new Eh(ma,qa,va):"quality"===ma?(qa=qa.toUpperCase(),yc=new Eh(ma,qa,va)):yc=new Eh(ma,qa);Ba=yc}else p=Ba,Ba=m;else p=Ba,Ba=m}else p=Ba,Ba=m;else p=Ba,Ba=m}else p=Ba,Ba=m;else p=Ba,Ba=m}else p=Ba,Ba=m;h=Ba;if(h===m){var ga,la,xa,sa;ga=p;f.substr(p,4)===Yh?(la=Yh,p+=4):(la=m,0===B&&k(hk));la===m&&(f.substr(p,4)===Zh?(la=Zh,p+=4):(la=m,0===B&&k(ik)));if(la!==m){xa=[];for(sa=n();sa!==m;)xa.push(sa),sa=n();xa!==m?(sa=Y(),sa!==m?ga=la=new Fh(sa,"show"===la):
(p=ga,ga=m)):(p=ga,ga=m)}else p=ga,ga=m;h=ga;if(h===m){var jb,Ka,Pa,wa,Xa,ya,Ya,za;jb=p;f.substr(p,4)===$h?(Ka=$h,p+=4):(Ka=m,0===B&&k(jk));if(Ka!==m){Pa=[];for(wa=n();wa!==m;)Pa.push(wa),wa=n();if(Pa!==m)if(wa=Y(),wa!==m){Xa=[];for(ya=n();ya!==m;)Xa.push(ya),ya=n();if(Xa!==m)if(ya=H(),ya!==m){Ya=[];for(za=n();za!==m;)Ya.push(za),za=n();Ya!==m?(za=X(),za!==m?jb=Ka=new Ch(wa,P.Tf(ya.toUpperCase()),za):(p=jb,jb=m)):(p=jb,jb=m)}else p=jb,jb=m;else p=jb,jb=m}else p=jb,jb=m;else p=jb,jb=m}else p=jb,jb=
m;h=jb;if(h===m){var Fa,Wa,fb,ua,gb,Da,hb,Qb,ac,ra,Oa,Ja,bb,Na;Fa=p;f.substr(p,5)===ai?(Wa=ai,p+=5):(Wa=m,0===B&&k(kk));if(Wa!==m){fb=[];for(ua=n();ua!==m;)fb.push(ua),ua=n();if(fb!==m)if(ua=na(),ua===m&&(ua=null),ua!==m){gb=[];for(Da=n();Da!==m;)gb.push(Da),Da=n();if(gb!==m)if(Da=Y(),Da!==m){hb=[];for(Qb=n();Qb!==m;)hb.push(Qb),Qb=n();if(hb!==m){ac=Qb=p;ra=H();if(ra!==m){Oa=p;B++;Ja=p;bb=[];for(Na=n();Na!==m;)bb.push(Na),Na=n();bb!==m?(Na=S(),Na!==m?Ja=bb=[bb,Na]:(p=Ja,Ja=m)):(p=Ja,Ja=m);B--;Ja!==
m?(p=Oa,Oa=void 0):Oa=m;Oa!==m?ac=ra=[ra,Oa]:(p=ac,ac=m)}else p=ac,ac=m;ac===m&&(ac=null);Qb=ac!==m?f.substring(Qb,p):ac;if(Qb!==m){ac=[];for(ra=n();ra!==m;)ac.push(ra),ra=n();ac!==m?(ra=S(),ra!==m?Fa=Wa=new wh(Da,ra,P.Tf((Qb?Qb.toUpperCase():"").toUpperCase()),ua):(p=Fa,Fa=m)):(p=Fa,Fa=m)}else p=Fa,Fa=m}else p=Fa,Fa=m}else p=Fa,Fa=m;else p=Fa,Fa=m}else p=Fa,Fa=m;else p=Fa,Fa=m}else p=Fa,Fa=m;h=Fa;if(h===m){var kb,pb,Ab,Ca,Cb,Ra,Hb,Ia;kb=p;f.substr(p,4)===bi?(pb=bi,p+=4):(pb=m,0===B&&k(lk));if(pb!==
m){Ab=[];for(Ca=n();Ca!==m;)Ab.push(Ca),Ca=n();if(Ab!==m)if(Ca=na(),Ca===m&&(Ca=null),Ca!==m){Cb=[];for(Ra=n();Ra!==m;)Cb.push(Ra),Ra=n();if(Cb!==m)if(Ra=Y(),Ra!==m){Hb=[];for(Ia=n();Ia!==m;)Hb.push(Ia),Ia=n();if(Hb!==m){Ia=K();if(Ia===m){var rb;f.substr(p,6)===ci?(rb=ci,p+=6):(rb=m,0===B&&k(mk));rb!==m&&(rb=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);Ia=rb}Ia!==m?kb=pb=new Ah(Ra,Ia,Ca):(p=kb,kb=m)}else p=kb,kb=m}else p=kb,kb=m;else p=kb,kb=m}else p=kb,kb=m;else p=kb,kb=m}else p=kb,kb=m;h=kb;if(h===m){var lb,
Db,Kb,La,Mb,Za,Tb,eb;lb=p;f.substr(p,5)===di?(Db=di,p+=5):(Db=m,0===B&&k(nk));if(Db!==m){Kb=[];for(La=n();La!==m;)Kb.push(La),La=n();if(Kb!==m)if(La=na(),La===m&&(La=null),La!==m){Mb=[];for(Za=n();Za!==m;)Mb.push(Za),Za=n();if(Mb!==m)if(Za=Y(),Za!==m){Tb=[];for(eb=n();eb!==m;)Tb.push(eb),eb=n();Tb!==m?(eb=Y(),eb!==m?lb=Db=new rh(Za,eb,La):(p=lb,lb=m)):(p=lb,lb=m)}else p=lb,lb=m;else p=lb,lb=m}else p=lb,lb=m;else p=lb,lb=m}else p=lb,lb=m;h=lb;if(h===m){var Qa,Lb,Zb,qb;Qa=p;f.substr(p,4)===ei?(Lb=ei,
p+=4):(Lb=m,0===B&&k(ok));if(Lb!==m){Zb=[];for(qb=n();qb!==m;)Zb.push(qb),qb=n();Zb!==m?(qb=F(),qb!==m?Qa=Lb=new oh(qb):(p=Qa,Qa=m)):(p=Qa,Qa=m)}else p=Qa,Qa=m;h=Qa;if(h===m){var bc,Vb,hc,Wc,ic,sb;bc=p;f.substr(p,4)===fi?(Vb=fi,p+=4):(Vb=m,0===B&&k(pk));if(Vb!==m){hc=[];for(Wc=n();Wc!==m;)hc.push(Wc),Wc=n();if(hc!==m)if(Wc=na(),Wc===m&&(Wc=null),Wc!==m){ic=[];for(sb=n();sb!==m;)ic.push(sb),sb=n();ic!==m?(sb=Y(),sb!==m?bc=Vb=new uh(sb,Wc,!0):(p=bc,bc=m)):(p=bc,bc=m)}else p=bc,bc=m;else p=bc,bc=m}else p=
bc,bc=m;h=bc;if(h===m){var mb,Xb,mc,tb,sd,Rc,cc,Cc,Jb,yb,Wb,Bb;mb=p;f.substr(p,9)===gi?(Xb=gi,p+=9):(Xb=m,0===B&&k(qk));if(Xb!==m){mc=[];for(tb=n();tb!==m;)mc.push(tb),tb=n();if(mc!==m)if(tb=Y(),tb!==m){sd=[];for(Rc=n();Rc!==m;)sd.push(Rc),Rc=n();if(sd!==m){cc=Rc=p;Cc=H();if(Cc!==m){Jb=p;B++;yb=p;Wb=[];for(Bb=n();Bb!==m;)Wb.push(Bb),Bb=n();Wb!==m?(Bb=X(),Bb!==m?yb=Wb=[Wb,Bb]:(p=yb,yb=m)):(p=yb,yb=m);B--;yb!==m?(p=Jb,Jb=void 0):Jb=m;Jb!==m?cc=Cc=[Cc,Jb]:(p=cc,cc=m)}else p=cc,cc=m;cc===m&&(cc=null);
Rc=cc!==m?f.substring(Rc,p):cc;if(Rc!==m){cc=[];for(Cc=n();Cc!==m;)cc.push(Cc),Cc=n();cc!==m?(Cc=X(),Cc!==m?mb=Xb=new yh(tb,P.Tf((Rc?Rc.toUpperCase():"").toUpperCase()),Cc):(p=mb,mb=m)):(p=mb,mb=m)}else p=mb,mb=m}else p=mb,mb=m}else p=mb,mb=m;else p=mb,mb=m}else p=mb,mb=m;h=mb;if(h===m){var Ga,jc,uc,Xc,wc,Eb,Ac,Rb,Bc,Sb;Ga=p;f.substr(p,4)===hi?(jc=hi,p+=4):(jc=m,0===B&&k(rk));if(jc!==m){uc=[];for(Xc=n();Xc!==m;)uc.push(Xc),Xc=n();if(uc!==m)if(Xc=na(),Xc===m&&(Xc=null),Xc!==m){wc=[];for(Eb=n();Eb!==
m;)wc.push(Eb),Eb=n();if(wc!==m)if(Eb=Y(),Eb!==m){Ac=[];for(Rb=n();Rb!==m;)Ac.push(Rb),Rb=n();if(Ac!==m)if(Rb=I(),Rb!==m){Bc=[];for(Sb=n();Sb!==m;)Bc.push(Sb),Sb=n();Bc!==m?(Sb=I(),Sb!==m?Ga=jc=new vh(Eb,0,0,Xc):(p=Ga,Ga=m)):(p=Ga,Ga=m)}else p=Ga,Ga=m;else p=Ga,Ga=m}else p=Ga,Ga=m;else p=Ga,Ga=m}else p=Ga,Ga=m;else p=Ga,Ga=m}else p=Ga,Ga=m;h=Ga;if(h===m&&(h=Ib(),h===m)){var dc,tc,Jc,Yc,Kc,td;dc=p;f.substr(p,6)===ii?(tc=ii,p+=6):(tc=m,0===B&&k(sk));if(tc!==m){Jc=[];for(Yc=n();Yc!==m;)Jc.push(Yc),Yc=
n();if(Jc!==m)if(Yc=na(),Yc===m&&(Yc=null),Yc!==m){Kc=[];for(td=n();td!==m;)Kc.push(td),td=n();Kc!==m?(td=Y(),td!==m?dc=tc=new uh(td,Yc,!1):(p=dc,dc=m)):(p=dc,dc=m)}else p=dc,dc=m;else p=dc,dc=m}else p=dc,dc=m;h=dc;if(h===m){var Ha,vc,Lc,Zc,Mc,ud,Nc,Sc,ec,Dc,Yb,vd,kc,wd;Ha=p;f.substr(p,7)===ji?(vc=ji,p+=7):(vc=m,0===B&&k(tk));if(vc!==m){Lc=[];for(Zc=n();Zc!==m;)Lc.push(Zc),Zc=n();if(Lc!==m)if(Zc=na(),Zc===m&&(Zc=null),Zc!==m){Mc=[];for(ud=n();ud!==m;)Mc.push(ud),ud=n();if(Mc!==m)if(ud=Y(),ud!==m){Nc=
[];for(Sc=n();Sc!==m;)Nc.push(Sc),Sc=n();if(Nc!==m){ec=Sc=p;Dc=H();if(Dc!==m){Yb=p;B++;vd=p;kc=[];for(wd=n();wd!==m;)kc.push(wd),wd=n();kc!==m?(wd=I(),wd!==m?vd=kc=[kc,wd]:(p=vd,vd=m)):(p=vd,vd=m);B--;vd!==m?(p=Yb,Yb=void 0):Yb=m;Yb!==m?ec=Dc=[Dc,Yb]:(p=ec,ec=m)}else p=ec,ec=m;ec===m&&(ec=null);Sc=ec!==m?f.substring(Sc,p):ec;if(Sc!==m){ec=[];for(Dc=n();Dc!==m;)ec.push(Dc),Dc=n();ec!==m?(Dc=I(),Dc!==m?Ha=vc=new th(ud,Dc,Zc,P.Tf((Sc?Sc.toUpperCase():"").toUpperCase())):(p=Ha,Ha=m)):(p=Ha,Ha=m)}else p=
Ha,Ha=m}else p=Ha,Ha=m}else p=Ha,Ha=m;else p=Ha,Ha=m}else p=Ha,Ha=m;else p=Ha,Ha=m}else p=Ha,Ha=m;h=Ha;if(h===m){var lc;f.substr(p,5)===ki?(lc=ki,p+=5):(lc=m,0===B&&k(uk));lc!==m&&(lc=new Dh);h=lc;if(h===m&&(h=Ib(),h===m)){var $c,zc,Qc,xd;$c=p;f.substr(p,6)===li?(zc=li,p+=6):(zc=m,0===B&&k(vk));if(zc!==m){Qc=[];for(xd=n();xd!==m;)Qc.push(xd),xd=n();Qc!==m?(xd=Y(),xd!==m?$c=zc=xd:(p=$c,$c=m)):(p=$c,$c=m)}else p=$c,$c=m;h=$c}}}}}}}}}}}}}}}}if(h!==m){l=[];for(q=n();q!==m;)l.push(q),q=n();if(l!==m){var yd,
oc,pc;yd=p;59===f.charCodeAt(p)?(oc=db,p++):(oc=m,0===B&&k(ob));if(oc!==m){var ad;10===f.charCodeAt(p)?(ad=ta,p++):(ad=m,0===B&&k(zb));ad===m&&(13===f.charCodeAt(p)?(ad=hd,p++):(ad=m,0===B&&k(Ub)),ad===m&&(f.substr(p,2)===cb?(ad=cb,p+=2):(ad=m,0===B&&k(nb))));pc=ad;pc===m&&(pc=null);pc!==m?yd=oc=[oc,pc]:(p=yd,yd=m)}else p=yd,yd=m;q=yd;q!==m?e=g=h:(p=e,e=m)}else p=e,e=m}else p=e,e=m}else p=e,e=m;return e}function Ib(){var e,g,h;e=p;f.substr(p,6)===wf?(g=wf,p+=6):(g=m,0===B&&k(mi));if(g!==m){g=[];for(h=
n();h!==m;)g.push(h),h=n();g!==m?e=null:(p=e,e=m)}else p=e,e=m;return e}function Ib(){var e;f.substr(p,6)===wf?(e=wf,p+=6):(e=m,0===B&&k(mi));e!==m&&(e=!1);return e}var V=1<arguments.length?arguments[1]:{},m={},y={start:l},Jb=l,oa=" ",yb={type:"literal",value:" ",description:'" "'},tc="\t",bb={type:"literal",value:"\t",description:'"\\t"'},ta="\n",zb={type:"literal",value:"\n",description:'"\\n"'},hd="\r",Ub={type:"literal",value:"\r",description:'"\\r"'},cb="\r\n",nb={type:"literal",value:"\r\n",
description:'"\\r\\n"'},db=";",ob={type:"literal",value:";",description:'";"'},ra="#",eb={type:"literal",value:"#",description:'"#"'},Na="'",pb={type:"literal",value:"'",description:'"\'"'},Ab="\\'",Oa={type:"literal",value:"\\'",description:'"\\\\\'"'},qa='"',N={type:"literal",value:'"',description:'"\\""'},R='\\"',qb={type:"literal",value:'\\"',description:'"\\\\\\""'},Ia=/^[0-9]/,Vb={type:"class",value:"[0-9]",description:"[0-9]"},Jc=/^[0-9, A-F, a-f]/,hc={type:"class",value:"[0-9, A-F, a-f]",
description:"[0-9, A-F, a-f]"},Wb=/^["e" \/ "E"]/,Kc={type:"class",value:'["e" / "E"]',description:'["e" / "E"]'},ic="!",Bb={type:"literal",value:"!",description:'"!"'},jc="$",Ja={type:"literal",value:"$",description:'"$"'},Wa="%",fb={type:"literal",value:"%",description:'"%"'},ia="&",Z={type:"literal",value:"&",description:'"&"'},ca="(",Ca={type:"literal",value:"(",description:'"("'},Cb=")",rb={type:"literal",value:")",description:'")"'},sb="*",Ka={type:"literal",value:"*",description:'"*"'},Db=
"+",sa={type:"literal",value:"+",description:'"+"'},Pa=",",la={type:"literal",value:",",description:'","'},Xa="-",ua={type:"literal",value:"-",description:'"-"'},gb=".",uc={type:"literal",value:".",description:'"."'},vc="/",Xb={type:"literal",value:"/",description:'"/"'},xa=":",ma={type:"literal",value:":",description:'":"'},ya="<",Lc={type:"literal",value:"<",description:'"<"'},Da="=",Kb={type:"literal",value:"=",description:'"="'},Mc=">",Nc={type:"literal",value:">",description:'">"'},Yb="?",Qa=
{type:"literal",value:"?",description:'"?"'},La="@",kc={type:"literal",value:"@",description:'"@"'},wc=/^[A-Z]/,lc={type:"class",value:"[A-Z]",description:"[A-Z]"},hb="[",Lb={type:"literal",value:"[",description:'"["'},Ya="\\",Mb={type:"literal",value:"\\",description:'"\\\\"'},mc="]",Eb={type:"literal",value:"]",description:'"]"'},va="^",Ra={type:"literal",value:"^",description:'"^"'},A="_",tb={type:"literal",value:"_",description:'"_"'},ga="`",Zb={type:"literal",value:"`",description:'"`"'},J=/^[a-z]/,
za={type:"class",value:"[a-z]",description:"[a-z]"},Aa="{",Sa={type:"literal",value:"{",description:'"{"'},W="}",Ta={type:"literal",value:"}",description:'"}"'},Fb="~",id={type:"literal",value:"~",description:'"~"'},$b="T",Pb={type:"literal",value:"T",description:'"T"'},nc="t",Ba={type:"literal",value:"t",description:'"t"'},yc="R",og={type:"literal",value:"R",description:'"R"'},sd="r",Qb={type:"literal",value:"r",description:'"r"'},Gj="U",Hj={type:"literal",value:"U",description:'"U"'},Ij="u",Jj=
{type:"literal",value:"u",description:'"u"'},zc="E",Qc={type:"literal",value:"E",description:'"E"'},oc="e",pc={type:"literal",value:"e",description:'"e"'},Ie="O",Je={type:"literal",value:"O",description:'"O"'},Ke="o",Le={type:"literal",value:"o",description:'"o"'},Ac="N",Rb={type:"literal",value:"N",description:'"N"'},Bc="n",Sb={type:"literal",value:"n",description:'"n"'},pg="F",qg={type:"literal",value:"F",description:'"F"'},rg="f",sg={type:"literal",value:"f",description:'"f"'},Me="A",Ne={type:"literal",
value:"A",description:'"A"'},Oe="a",Pe={type:"literal",value:"a",description:'"a"'},Qe="L",Re={type:"literal",value:"L",description:'"L"'},Se="l",Te={type:"literal",value:"l",description:'"l"'},tg="S",ug={type:"literal",value:"S",description:'"S"'},vg="s",wg={type:"literal",value:"s",description:'"s"'},Mh="rgb(",Fj={type:"literal",value:"rgb(",description:'"rgb("'},ci="origin",mk={type:"literal",value:"origin",description:'"origin"'},Jh=/^[0-9a-zA-Z_]/,Kh={type:"class",value:"[0-9a-zA-Z_]",description:"[0-9a-zA-Z_]"},
Uh="as",dk={type:"literal",value:"as",description:'"as"'},Lh="0x",Ej={type:"literal",value:"0x",description:'"0x"'},xg="P",yg={type:"literal",value:"P",description:'"P"'},zg="p",Ag={type:"literal",value:"p",description:'"p"'},sf="I",tf={type:"literal",value:"I",description:'"I"'},uf="i",vf={type:"literal",value:"i",description:'"i"'},Bg="D",Cg={type:"literal",value:"D",description:'"D"'},Dg="d",Eg={type:"literal",value:"d",description:'"d"'},Kj="M",Lj={type:"literal",value:"M",description:'"M"'},
Mj="m",Nj={type:"literal",value:"m",description:'"m"'},Oj="G",Pj={type:"literal",value:"G",description:'"G"'},Qj="g",Rj={type:"literal",value:"g",description:'"g"'},Sj="V",Tj={type:"literal",value:"V",description:'"V"'},Uj="v",Vj={type:"literal",value:"v",description:'"v"'},Nh="scene",Wj={type:"literal",value:"scene",description:'"scene"'},Oh="structure",Xj={type:"literal",value:"structure",description:'"structure"'},Ph="moltype",Yj={type:"literal",value:"moltype",description:'"moltype"'},Qh="molecule",
Zj={type:"literal",value:"molecule",description:'"molecule"'},Rh="residue",ak={type:"literal",value:"residue",description:'"residue"'},Sh="atom",bk={type:"literal",value:"atom",description:'"atom"'},Vh="display",ek={type:"literal",value:"display",description:'"display"'},Th="load",ck={type:"literal",value:"load",description:'"load"'},Wh="remove",fk={type:"literal",value:"remove",description:'"remove"'},Xh="set",gk={type:"literal",value:"set",description:'"set"'},ii="center",sk={type:"literal",value:"center",
description:'"center"'},Yh="show",hk={type:"literal",value:"show",description:'"show"'},Zh="hide",ik={type:"literal",value:"hide",description:'"hide"'},$h="repr",jk={type:"literal",value:"repr",description:'"repr"'},ai="color",kk={type:"literal",value:"color",description:'"color"'},bi="move",lk={type:"literal",value:"move",description:'"move"'},di="align",nk={type:"literal",value:"align",description:'"align"'},fi="zoom",pk={type:"literal",value:"zoom",description:'"zoom"'},gi="highlight",qk={type:"literal",
value:"highlight",description:'"highlight"'},hi="clip",rk={type:"literal",value:"clip",description:'"clip"'},wf="finish",mi={type:"literal",value:"finish",description:'"finish"'},ei="wait",ok={type:"literal",value:"wait",description:'"wait"'},ji="opacity",tk={type:"literal",value:"opacity",description:'"opacity"'},ki="reset",uk={type:"literal",value:"reset",description:'"reset"'},li="target",vk={type:"literal",value:"target",description:'"target"'},p=0,rf=[{line:1,jb:1,$b:!1}],Za=0,ng=[],B=0,xf;if("startRule"in
V){if(!(V.nf in y))throw Error("Can't start parsing from rule \""+V.nf+'".');Jb=y[V.nf]}xf=Jb();if(xf!==m&&p===f.length)return xf;xf!==m&&p<f.length&&k({type:"end",description:"end of input"});throw function(f,g,h,k){function l(e){var f=1;for(e.sort(function(e,f){return e.description<f.description?-1:e.description>f.description?1:0});f<e.length;)e[f-1]===e[f]?e.splice(f,1):f++}function m(e,f){function g(e){function f(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,
'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+f(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+f(e)}).replace(/[\u0100-\u0FFF]/g,function(e){return"\\u0"+f(e)}).replace(/[\u1000-\uFFFF]/g,function(e){return"\\u"+f(e)})}var h=Array(e.length),k;for(k=0;k<e.length;k++)h[k]=e[k].description;h=1<e.length?h.slice(0,-1).join(", ")+" or "+h[e.length-1]:h[0];k=f?'"'+
g(f)+'"':"end of input";return"Expected "+h+" but "+k+" found."}null!==g&&l(g);return new e(null!==f?f:m(g,h),0,0,k)}(null,ng,Za<f.length?f.charAt(Za):null,Za<f.length?h(Za,Za+1):h(Za,Za));}}}();function Gh(e){this.parent=e;this.content=null}Gh.prototype.show=function(){Hh(this.parent);this.content.show();this.update(!0)};Gh.prototype.hide=function(){this.content.hide();this.update(!1);this.parent.ca.ba.scene3D.Wd.Zi()};Gh.prototype.toggle=function(){this.content.is(":visible")?this.hide():this.show()};
function Ih(e,f,g){$(g?'<option selected value="'+f+'">'+f+"</option>":'<option value="'+f+'">'+f+"</option>").appendTo(e)}function ni(e,f){var g;return g=""+('<input type="checkbox" id="widget'+e+'" title="'+f+'">')+('<label class="hasMenu mapSelection" for="widget'+e+'" title="'+f+'">')+"</label>"}Gh.prototype.update=function(){};
function oi(e){Gh.call(this,e);this.ca=this.parent.ca;this.div=this.ca.content;this.time=0;this.lock=!1;this.content=$('<div id="slider-range" style="height:250px;"></div>').css({position:"absolute",top:"20%",width:"5px",height:"60%","margin-left":"5px","margin-right":"auto"}).appendTo(this.div);this.nc=$("#slider-range");pi(this)}oi.prototype=Object.create(Gh.prototype);oi.prototype.constructor=oi;oi.prototype.toggle=function(){this.nc.toggle()};
oi.prototype.show=function(){this.nc.stop().fadeTo(0,1);this.lock=!0};oi.prototype.hide=function(){this.nc.stop().fadeTo(0,0);this.lock=!1};
function pi(e){function f(){e.lock||e.nc.stop().fadeTo(500,0)}setTimeout(function(){e.nc.fadeTo(1E3,0)},1E3);var g=!1;e.nc.on("mouseenter",function(){e.nc.stop().fadeTo(500,1)});e.nc.on("mouseleave",function(){g||f()});e.nc.slider({orientation:"vertical",Nl:!0,step:.1,values:[0,100],slide:function(f,g){$e(e.ca.ba.scene3D,g.values[0],g.values[1])}});e.nc.on("slidestart",function(){g=!0});e.nc.on("slidestop",function(){g=!1;f()})}function qi(e){Gh.call(this,e);ri(this);si(this)}qi.prototype=Object.create(Gh.prototype);
qi.prototype.constructor=qi;
function ti(e,f){$("#mapping").empty();void 0===f&&(f="Atoms");$("selectMap").text()!==f&&$("#selectMap").text(f);if("Atoms"===f||"Amino Acids"===f)ui(e,f,4);else if("Nucleic Acids"===f)ui(e,f,5);else if("Secondary Structure Type"===f)ui(e,f,2);else if("Molecules"===f)ui(e,f,4);else if("Rainbow"===f){$('<span class="gradientLabelLeft">First</span><span class="gradientLabelRight">Last</span></br><canvas id="gradient"></canvas><br/>').appendTo("#mapping");$("#gradient").css({width:"90%",height:"20px",
border:"1px solid #555"});for(var g=document.getElementById("gradient"),h=g.getContext("2d"),k=g.width,g=g.height,l=null,n=0;n<k;n++)for(var r=0;r<g;r++)l="hsl("+n+", 100%, 50%)",h.fillStyle=l,h.fillRect(n,r,1,1)}else"Hydrophobicity"===f?($('<span class="gradientLabelLeft">Hydrophilic</span><span class="gradientLabelRight">Hydrophobic</span></br><canvas id="gradient"></canvas><br/>').appendTo("#mapping"),$("#gradient").css({width:"90%",height:"20px",border:"1px solid #555"}),g=document.getElementById("gradient"),
h=g.getContext("2d"),k=g.width,g=g.height,l=h.createLinearGradient(0,0,k,0),l.addColorStop(0,e.Lb.Kc.Hydrophobicity.Hydrophobic),l.addColorStop(.5,"rgb(255,255,255)"),l.addColorStop(1,e.Lb.Kc.Hydrophobicity.Hydrophilic),h.fillStyle=l,h.fillRect(0,0,k,g)):console.warn("Unknown legend mapping name : ",f)}
function ui(e,f,g){var h=$('<table style="display: inline-block;">'),k,l=e.Lb.Kc[f],n=0,r;for(r in l){0===n%g&&(k=$("<tr></tr>"),k.appendTo(h));var q=$("<td></td>");q.appendTo(k);var t=$('<div class="legend-mapping"></div>');t.appendTo(q);$('<input type="text" value="'+r+'" readonly/>').appendTo(t);q='<div class="color-box" style="background-color:'+l[r]+';" data-mapping="'+f+'" data-mappingName="'+r+'" data-color="'+l[r]+'"></div>';q=$(q);q.click(function(){e.mg.map=$(this).attr("data-mapping");
e.mg.name=$(this).attr("data-mappingName");$.farbtastic($("#mcp")).setColor($(this).attr("data-color"));$.farbtastic($("#mcp")).ei=$(this);$("#mapColPick").show()});$(q).appendTo(t);n++}h.appendTo("#mapping")}
function ri(e){e.content=$('<div id="legend"></div>').css({width:"300px",opacity:"0.9",position:"absolute",top:"10px",right:"0px","margin-left":"5px","margin-right":"5px","text-align":"center","flex-direction":"column","align-items":"stretch"});var f;f='<button id="previousMapping" class="mapSelection">Previous</button><span id="selectMap" class="mapSelection"></span><button id="nextMapping" class="mapSelection">Next</button>';e.content.appendTo(e.parent.Oe);$('<button id="closeLegend" class="mapSelection">Close</button>').appendTo(e.content);
$('<div id="mappingSelection" style="text-align: center;"></div><div id="mapping" style="text-align: center;"></div>').appendTo(e.content);$("#mappingSelection").css({color:"white",display:"inline-flex","justify-content":"center",width:"100%"});$(f).appendTo($("#mappingSelection"));$("#selectMap").css({width:"63%"});e.toggle();e.Bj=$("#previousMapping");e.Aj=$("#nextMapping");e.Lb=te();$('<div id="mapColPick"><div id="mcp"></div><button id="mapClPicker" class="mapSelection">Close</button></div>').appendTo(e.content);
$("#mcp").farbtastic().click(function(){$("#mcp").farbtastic().on("mousemove",function(){var f=$.farbtastic($("#mcp")),g=f.color,l=e.Lb,n=e.mg.map,r=e.mg.name;if(void 0!==l.Kc[n]&&void 0!==l.Kc[n][r]){l.Kc[n][r]=g;var q=n;"Amino Acids"===q||"Nucleic Acids"===q?q="Residues":"Secondary Structure Type"===q&&(q="SST");void 0!=l.fa[q]&&void 0!=l.fa[q][r]&&(l.fa[q][r]=l.fa[q][r].set(g),xe(l,{lj:!0,Jj:n}))}f.ei.css("background-color",g);f.ei.attr("data-color",g)});$("#mcp").farbtastic().on("mouseup",function(){$("#mcp").farbtastic().off("mousemove");
$("#mcp").farbtastic().off("mouseup")})});$("#mapColPick").toggle();$("#mapColPick").hide();$("#mapClPicker").button({text:!1,label:"Quit",icons:{primary:"ui-icon-check"}}).click(function(){$("#mapColPick").hide()});$("#mapColPick").css({"float":"right"});$("#previousMapping").css({width:"7%",right:"5px"});$("#nextMapping").css({width:"7%",left:"5px"});$("#closeLegend").button({text:!1,label:"Quit",icons:{primary:"ui-icon-close"}}).click(function(){e.hide()});$("#closeLegend").css({width:"15px",position:"absolute",
right:"0px","margin-right":"10px"});e.Bj.button({text:!1,label:"Previous",icons:{primary:"ui-icon-triangle-1-w"}}).click(function(){void 0!=this&&this.blur();var f=$("#selectMap").text(),g=null,l;for(l in e.Lb.Kc){if(null!=g&&l===f)break;g=l}$("#selectMap").text(g);ti(e,g);$("#mapColPick").hide()});e.Aj.button({text:!1,label:"Previous",icons:{primary:"ui-icon-triangle-1-e"}}).click(function(){void 0!=this&&this.blur();var f=!1,g=$("#selectMap").text(),l=null,n;for(n in e.Lb.Kc){if(f){l=n;break}n===
g&&(f=!0)}if(null===l){for(var r in e.Lb.Kc)break;l=r}$("#selectMap").text(l);ti(e,l);$("#mapColPick").hide()});f=$(ni("SaveButton","Save")).button({text:!1,label:"Save",icons:{primary:"ui-icon-arrowstop-1-s"}}).click(function(){var f=e.Lb;window.localStorage.setItem("def",JSON.stringify(f.Yf));window.localStorage.setItem("moleculeColor",JSON.stringify(f.wd));window.localStorage.setItem("nucleicAcidColor",JSON.stringify(f.Ic));window.localStorage.setItem("residueColor",JSON.stringify(f.ud));window.localStorage.setItem("atomColor",
JSON.stringify(f.xb));window.localStorage.setItem("hydroColor",JSON.stringify(f.ze));window.localStorage.setItem("rainbowColor",JSON.stringify(f.Ae));window.localStorage.setItem("sstColor",JSON.stringify(f.Ud));window.localStorage.setItem("unsortedProperties",JSON.stringify(f.Xi));this.blur()}).css({width:"10%"});var g=$(ni("ResetButton","Reset")).button({text:!1,label:"Reset",icons:{primary:" ui-icon-arrowrefresh-1-e"}}).click(function(){var f=e.Lb;f.fa={Atoms:[],Residues:[],Molecules:[],SST:[]};
window.localStorage.setItem("def",JSON.stringify(Gd));window.localStorage.setItem("moleculeColor",JSON.stringify(Hd));window.localStorage.setItem("nucleicAcidColor",JSON.stringify(Id));window.localStorage.setItem("residueColor",JSON.stringify(Jd));window.localStorage.setItem("atomColor",JSON.stringify(Kd));window.localStorage.setItem("hydroColor",JSON.stringify(Ld));window.localStorage.setItem("rainbowColor",JSON.stringify(Md));window.localStorage.setItem("sstColor",JSON.stringify(Nd));window.localStorage.setItem("unsortedProperties",
JSON.stringify(Od));we(f);xe(f,{lj:!0});$("#mapColPick").hide();ti(e);this.blur()}).css({width:"10%"});f.focus(function(){});g.focus(function(){});f.appendTo("#legend");g.appendTo("#legend")}function si(e){document.addEventListener("keypress",function(e,g){return function(){return e.apply(g,arguments)}}(function(e){108===e.which&&this.toggle()},e),!1);ti(e);e.mg={map:null,name:null,value:null}}
function vi(e){Gh.call(this,e);this.tl="Star selection";this.Sk="Pair selection";this.Rg=" Click to select an atom ";wi(this);xi(this)}vi.prototype=Object.create(Gh.prototype);z=vi.prototype;z.constructor=vi;z.mf=function(e){this.parent.ca.ba.scene3D.mf(e)};z.pf=function(){this.parent.ca.ba.scene3D.pf()};z.Jf=function(){this.parent.ca.ba.scene3D.Jf()};
function wi(e){e.content=$('<div id="measureWidget"></div>').css({width:"300px",opacity:"0.9",position:"absolute",top:"10px",right:"0px","margin-left":"5px","margin-right":"5px","text-align":"center","flex-direction":"column","align-items":"stretch"});var f;f='<div><span id="measureTitle" class="mapSelection"> Measuring tool </span><button id="closeMeasurementButton" class="mapSelection">Close</button></div>';e.content.appendTo(e.parent.Oe);f=$(f);f.appendTo(e.content);f='<button id="clearMeasureButton"> Clear </button><div id="MeasurementTypeSelection"><input type="radio" id="starSelection" name="radioSelectionMeasure" checked="checked">'+
('<label for="starSelection" title="starSelection">'+e.tl+"</label>");f=f+'<input type="radio" id="pairSelection" name="radioSelectionMeasure">'+('<label for="pairSelection" title="pairSelection">'+e.Sk+"</label>");f+="</div>";var g=$("<div></div>").css({display:"flex","justify-content":"center"});$(f).appendTo(g);g.appendTo(e.content);$("#clearMeasureButton").button({text:!1,label:"Clear",icons:{primary:" ui-icon-arrowrefresh-1-e"}}).css({height:"20px","font-size":"0.7em"}).click(function(){e.Jf()});
e.Mh=$('<div id="starMeasureWidget"><button id="objectMeasurementSelection">'+e.Rg+"</button></div>");e.Zf=$('<div id="pairMeasureWidget"></div>');e.Mh.appendTo(e.content);e.Zf.appendTo(e.content);e.Zf.hide();$("#MeasurementTypeSelection").change(function(){var f=$("input[type='radio'][name='radioSelectionMeasure']:checked").attr("id");"starSelection"===f?($("#objectMeasurementSelection").text(this.Rg),e.pf(),e.Mh.show(),e.Zf.hide()):"pairSelection"===f&&(e.Mh.hide(),e.Zf.show(),e.mf())});$("#objectMeasurementSelection").button().css({width:"70%",
height:"20px","font-size":"0.7em"}).click(function(){e.update(!0)});$("#MeasurementTypeSelection").buttonset().css({"font-size":"0.7em","margin-right":"0px",height:"100%",border:"0px"});$("#measureTitle").css({color:"white"});$("#closeMeasurementButton").button({text:!1,label:"Quit",icons:{primary:"ui-icon-close"}}).click(function(){e.hide()});$("#closeMeasurementButton").css({width:"15px",position:"absolute",right:"0px","margin-right":"10px"})}
function xi(e){document.addEventListener("keypress",function(e,g){return function(){return e.apply(g,arguments)}}(function(e){109===e.which&&this.toggle()},e),!1)}z.hide=function(){Gh.prototype.hide.call(this);this.pf()};z.update=function(e){var f=this;e?f.parent.ca.ba.scene3D.Wd.Ci(function(e){null!=e&&(f.mf(e),$("#objectMeasurementSelection").text(e.qd()),f.parent.ca.ba.scene3D.Wd.Zi())}):$("#objectMeasurementSelection").text(this.Rg)};
function yi(e){Gh.call(this,e);this.sb=this.Od=this.tc=null;te();this.jj=" (visible)";this.ii="All representations";zi(this);Ai(this)}yi.prototype=Object.create(Gh.prototype);yi.prototype.constructor=yi;function Bi(){var e=$("input[type='radio'][name='radioSelectionLevel']:checked").attr("id"),e=e.replace("radioSelection","");return parseInt(e)}function Ci(e){0<e&&5>e&&(e="#radioSelection"+e,$(e)[0].checked=!0,$(e).button("refresh"))}
function Di(e,f,g){1===f||2===f?f="molecule":3===f?f="residue":4===f&&(f="atom");if(void 0!=e.sb){var h=[];f=f.toLowerCase();f="structure"===f||"molecule"===f?Yg.map[Ff]:"residue"===f?Yg.map[Hf]:"atom"===f?Yg.map[Kf]:void 0;for(var k=0;k<f.length;k++)h.push(f[k].name);e.tc.html("<option selected>"+e.ii+"</option>");for(var l in h)biovizAPI.jf([e.sb],h[l])?(f=h[l]+e.jj,g===h[l]?Ih(e.tc,f,!0):Ih(e.tc,f,!1)):g===h[l]?Ih(e.tc,h[l],!0):Ih(e.tc,h[l],!1)}}
function Ei(e){return null!=e.tc.val()&&e.tc.val()!==e.ii?e.tc.val().replace(e.jj,""):null}function Fi(e){var f=Bi(),g=$("#objectSelection").html(),f=biovizAPI.Rc(g,f)[0];e=Ei(e);null==f||null==e?$("#showhideRep").button({icons:{primary:" ui-icon-plus"},label:"Hide the representation"}):biovizAPI.jf([f],e)?$("#showhideRep").button({icons:{primary:" ui-icon-minus"},label:"Hide the representation"}):$("#showhideRep").button({icons:{primary:" ui-icon-plus"},label:"Show the representation"})}
function Gi(e){var f=Bi();1===f?$.farbtastic($("#colPicker")).setColor("#D3D3D3"):2===f?$.farbtastic($("#colPicker")).setColor(Hd[e.sb.ea.id]):3===f?$.farbtastic($("#colPicker")).setColor(Jd[e.sb.Cb.Vc()]):4===f&&(e=e.sb.qe,e=e.symbol.charAt(0).toUpperCase()+e.symbol.slice(1).toLowerCase(),$.farbtastic($("#colPicker")).setColor(Kd[e]))}
function zi(e){e.content=$('<div id="reprManagement"></div>').css({width:"300px",opacity:"0.9",position:"absolute",top:"10px",right:"0px","margin-left":"5px","margin-right":"5px","text-align":"center","flex-direction":"column","align-items":"stretch"});var f;f='<span id="managementTitle" class="mapSelection">Representation management</span><button id="closeManagementButton" class="mapSelection">Close</button>';var g;g=$("<div></div>");e.content.appendTo(e.parent.Oe);f=$(f);f.appendTo(g);f=$("<div></div>");
var h;h='<div id="selectionLevel"><input type="radio" id="radioSelection1" name="radioSelectionLevel"><label for="radioSelection1" title="Structure">S</label><input type="radio" id="radioSelection2" name="radioSelectionLevel" checked="checked"><label for="radioSelection2" title="Molecule">M</label>';h+='<input type="radio" id="radioSelection3" name="radioSelectionLevel">';h+='<label for="radioSelection3" title="Residue">R</label>';h+='<input type="radio" id="radioSelection4" name="radioSelectionLevel">';
h+='<label for="radioSelection4" title="Atom">A</label>';h+="</div>";var k=$('<div id="selection"></div>');$('<button id="objectSelection"> Click to select an object </button> ').appendTo($(k));$(h).appendTo($(k));$(k).appendTo(f);h=$('<div id="selectDiv"></div>');$('<button id="showhideRep" class="mapSelection">Close</button>').appendTo(h);e.tc=$('<select name="repType" id="repType" onfocus="this.selectedIndex = -1;"><option selected disabled>Representation</option></select>');e.Od=$('<select name="col" id="col" onfocus="this.selectedIndex = 0;"><option selected disabled value="Coloration">Coloration</option></select>');
e.tc.appendTo(h);e.Od.appendTo(h);h.appendTo(f);f.appendTo(g);g.appendTo(e.content);$('<div id="reprcolorpicker"><div id="colPicker"></div><button id="reprClosePicker" class="mapSelection">Close</button></div>').appendTo(e.content);$("#colPicker").farbtastic().mousemove(function(){biovizAPI.ef($.farbtastic($("#colPicker")).color,[l.sb],Ei(l))});$("#reprcolorpicker").toggle();$("#reprcolorpicker").hide();$("#reprClosePicker").button({text:!1,label:"Quit",icons:{primary:"ui-icon-check"}}).click(function(){$("#reprcolorpicker").hide()});
$("#reprcolorpicker").css({"align-self":"flex-end","float":"right"});$("#showhideRep").button({text:!1,label:"Show the representation",icons:{primary:"ui-icon-plus"}});$("#showhideRep").css({width:"5%",top:"3px"});e.toggle();var l=e;$("#managementTitle").css({color:"white"});$("#closeManagementButton").button({text:!1,label:"Quit",icons:{primary:"ui-icon-close"}}).click(function(){l.hide()});$("#closeManagementButton").css({width:"15px",position:"absolute",right:"0px","margin-right":"10px"});$("#objectSelection").button().css({width:"63%",
height:"20px"});$("#selectionLevel").buttonset().css({"margin-right":"0px",height:"100%",border:"0px"});$("#selection").css({"font-size":"0.7em",display:"flex","align-items":"stretch",width:"100%","margin-bottom":"2px"});$("#selectDiv").css({height:"20px",display:"flex","align-items":"stretch",width:"100%"});$("#repType").css({width:"60%"});e.tc.change(function(){var e=Ei(l);null===e||biovizAPI.jf([l.sb],e)||biovizAPI.jg([l.sb],e);Fi(l);var f=Bi();Di(l,f,e);$('#col option[value="Coloration"]').prop("selected",
!0);biovizAPI.pb({type:"requestWidgetUpdate"})});e.Od.change(function(){"Uniform color"===l.Od.val()?(void 0!=l.sb&&biovizAPI.ef($.farbtastic($("#colPicker")).color,[l.sb],Ei(l)),$("#reprcolorpicker").show()):($("#reprcolorpicker").hide(),biovizAPI.ef(l.Od.val(),[l.sb],Ei(l)))});$("#selectionLevel").change(function(){var e=Ei(l),f=l,g=Bi(),h=$("#objectSelection").html();f.sb=biovizAPI.Rc(h,g)[0];Gi(f);f=Bi();Di(l,f,e);null!=l.sb&&Fi(l);$('#col option[value="Coloration"]').prop("selected",!0)});$("#showhideRep").click(function(){var e=
Ei(l);if(null!=e){biovizAPI.jf([l.sb],e)?biovizAPI.Fi([l.sb],e):biovizAPI.jg([l.sb],e);Fi(l);var f=Bi();Di(l,f,e);biovizAPI.pb({type:"requestWidgetUpdate"})}});g=Gf.gk();for(var n in g)Ih(e.Od,g[n],!1);Ih(e.Od,"Uniform color",!1)}function Ai(e){document.addEventListener("keypress",function(e,g){return function(){return e.apply(g,arguments)}}(function(e){114===e.which&&this.toggle()},e),!1)}
yi.prototype.update=function(e){if(e){var f=this;f.parent.ca.ba.scene3D.Wd.Ci(function(e){if(null!=e){$("#objectSelection").text(e.qd());var h=Bi();e=$("#objectSelection").html();var k=f.sb,l=biovizAPI.Rc(e,h)[0];if(null!=k){if(k==l)4>h&&h++;else for(;k.parent!=l.parent&&0<h;)h--,k=k.parent,l=l.parent;Ci(h);l=biovizAPI.Rc(e,h)[0]}f.sb=l;Gi(f);Di(f,Bi());$('#col option[value="Coloration"]').prop("selected",!0)}})}};
function Hi(e){this.ca=e;this.div=this.ca.content;this.time=0;this.u=this.wf=this.ed=null;new EventTarget(Hi.prototype);this._listeners=[];this.Hd()}
Hi.prototype.Hd=function(){var e=this,f;f='<div id="scriptPlayerDiv"><table style="width:100%"><tr><td><button id="play">Play</button></td>';f+='<td><button id="stop">Stop</button></td>';f+='<td id="progressbar" style="width:90%"></td>';f+="</tr>";f+="</table>";f+="</div>";$(f).css({position:"relative",top:"-50px",width:"95%","margin-left":"auto","margin-right":"auto"}).appendTo(this.div);this.Zc=$("#scriptPlayerDiv");this.ed=$("#progressbar");this.wf=$("#play");this.u=$("#stop");setTimeout(function(){e.Zc.fadeTo(1E3,
0)},1E3);this.Zc.on("mouseenter",function(){e.Zc.stop().fadeTo(500,1)});this.Zc.on("mouseleave",function(){e.Zc.stop().fadeTo(500,0)});this.ed.progressbar({value:!1});this.ed.bind("click",function(f){f=(f.clientX-f.currentTarget.offsetLeft-f.currentTarget.offsetParent.offsetParent.offsetLeft)/f.currentTarget.clientWidth;e.ed.progressbar("option","value",100*f);e.pb({type:"update",value:f})});this.ed.bind("mousemove",function(f){1===f.buttons&&(f=(f.clientX-f.currentTarget.offsetLeft-f.currentTarget.offsetParent.offsetParent.offsetLeft)/
f.currentTarget.clientWidth,e.ed.progressbar("option","value",100*f),e.pb({type:"update",value:f}))});this.wf.button({text:!1,label:"play",icons:{primary:"ui-icon-play"}}).click(function(){var f;"play"===$(this).text()?(f={label:"pause",icons:{primary:"ui-icon-pause"}},e.pb("play")):(f={label:"play",icons:{primary:"ui-icon-play"}},e.pb("pause"));$(this).button("option",f)});this.u.button({text:!1,icons:{primary:"ui-icon-stop"}}).click(function(){e.wf.button("option",{label:"play",icons:{primary:"ui-icon-play"}});
e.pb("stop")});this.ed.find(".ui-progressbar-value")};Hi.prototype.toggle=function(){this.Zc.toggle()};Hi.prototype.show=function(){this.Zc.stop().fadeTo(0,1)};Hi.prototype.hide=function(){this.Zc.stop().fadeTo(0,0)};function Ii(e){this.ca=e;this.canvas=this.ca.canvas;this.u=[];this.Oe=$('<div id="widgets"></div>').css({});this.Oe.appendTo(this.canvas);for(var f in Ji)this.u[f]=new Ji[f](this);Hh(this)}function Hh(e){for(var f in Ji)e.u[f].hide()}Ii.prototype.show=function(){this.Oe.show()};
Ii.prototype.hide=function(){this.Oe.hide()};var Ji={Legend:qi,RepresentationManager:yi,ClippingWidget:oi,MeasureWidget:vi};function Ki(){this.canvas=null;this.Qh="http://ftp.rcsb.org/view/${id}.cif";this.load=this.vd=!0;this.fj=!1;new EventTarget(Ki.prototype);this.Fh=this.ba=null;this.canvas=this.content=$('<div id="content"></div>').css({tabindex:"0","z-index":"0",width:"100%",height:"100%",overflow:"hidden"})}
Ki.prototype.Lh=function(e,f){"urlTemplate"===e?this.Qh=f:"loadPDBX"===e?this.vd=f:console.warn("Can't change unexisting option : "+e)};
function He(e,f,g){e=e.Pf();var h=$("#loadBar"),k=$("#loadLabel"),l;g?l='<img src="img/loader.gif" id="imgLoader" alt="loader">':(h.remove(),h=$("#loadBar"),setTimeout(function(){$("#loadBar").remove()},6E3));void 0==f?h.remove():(0==h.length&&(g=$(l).css({display:"inline-block"}),k=$('<div id="loadLabel"> </div>').css({display:"inline-block",color:"white","font-size":"100%"}),h=$('<div id="loadBar"> </div>').css({position:"absolute",top:"2%",right:"0px"}),k.appendTo(h),g.appendTo(h),h.appendTo(e)),
k.text(f))}Ki.prototype.Pg=function(e){this.pb({type:"atomMouseOver",data:e})};function re(e,f){var g=e.Fh;g.u=g.v.parse(f).slice(0);g.u[0]instanceof Dh||g.u.splice(0,0,new Dh);g.u.add=g.u.push;g.u.remove=g.u.shift;g.pb({type:"commandParsed",data:g.u})}Ki.prototype.Pf=function(){return this.canvas};function dd(e){e.contextMenu.div.contextmenu("close")}
Ki.prototype.Hd=function(){if(!Detector.webgl)return Detector.addGetWebGLMessage({parent:this.canvas[0]}),!1;this.ba=new Ee(this);this.Fh=new mh(this.ba);this.contextMenu=new ce(this,$(document.body));this.Lj=$(".hasContextMenu:first");this.Ug=this.contextMenu.div;this.ti=this.Mf=null;this.Eb=this.ba.scene3D.Eb;this.Sh=new Ii(this);$('<div id="bionextlogo" class="noselect"><img src="img/logo.png" alt="Bionext Logo" width="100%" /></div>').css({position:"absolute",top:"10px",width:"30%","margin-left":"10px",
"margin-right":"auto"}).appendTo(this.content);setTimeout(function(){$("#bionextlogo").fadeTo(2E3,.6)},4E3);Li(this);return!0};
function Li(e){e.ad=new Hi(e);e.Eb.addListener("timeChanged",function(f){e.ad.ed.progressbar("option","value",100*f.data.progress)});e.Eb.addListener("endScript",function(){e.ad.wf.button("option",{label:"play",icons:{primary:"ui-icon-play"}})});e.ad.addListener("play",function(){e.Eb.play()});e.ad.addListener("pause",function(){e.Eb.pause()});e.ad.addListener("stop",function(){e.Eb.stop()});e.ad.addListener("update",function(f){ph(e.Eb,f)});e.Fh.addListener("commandParsed",function(f){var g=e.Eb;
f=f.data;g.aa=0;g.fa=f.slice(0);qh(g);f=g.fa.length;for(var h=0;h<f;h++){var k=g.fa[h];k instanceof oh&&(g.aa+=k.duration)}})}function zf(e){e?$("#scriptPlayerDiv").css({top:"-50px"}):$("#scriptPlayerDiv").css({top:"50px"})}
var Mi=P.NONE.name,Ni=P.Qe.name,Oi=P.LINES.name,Pi=P.be.name,Qi=P.ac.name,Ri=P.Bd.name,Si=P.vg.name,Ti=P.vf.name,Ui=P.pg.name,Vi=P.tf.name,Wi=P.Pe.name,Xi=P.rg.name,Yi=P.uf.name,Zi=P.qg.name,$i={NONE:Mi,Qe:Ni,LINES:Oi,be:Pi,ac:Qi,Bd:Ri,vg:Si,vf:Ti,pg:Ui,tf:Vi,Pe:Wi,rg:Xi,uf:Yi,qg:Zi},aj=M.u.xf,bj=M.u.Vb,cj=M.u.Gb,dj=M.u.Va,ej=M.u.vc,fj={xf:aj,Vb:bj,Gb:cj,Va:dj,vc:ej},gj=Gf.Vb.name,hj=Gf.Gb.name,ij=Gf.Va.name,jj=Gf.sg.name,kj=Gf.tg.name,lj=Gf.yg.name,mj=Gf.wg.name,nj=Gf.ug.name,oj={Vb:gj,Gb:hj,Va:ij,
sg:jj,tg:kj,yg:lj,wg:mj,ug:nj};function U(){}z=U.prototype;z.Nj=function(){this.u=new Ki};z.yk=function(){this.v=this.u.Hd();this.ba=this.u.ba};z.Ck=function(){return this.v};z.fl=function(e){this.u.contextMenu.moveTo(e);this.u.Mf=e;this.u.ti=e.find("#biovizFrame")};z.Pf=function(){return this.u.Pf()};z.pb=function(e){this.u.pb(e)};z.Ed=function(e){a:{var f=this.ba.scene3D,g;for(g in f.ka)if(f.ka[g].Uc().toUpperCase()===e.toUpperCase()){e=f.ka[g];break a}e=void 0}return e};
z.Ue=function(e,f){var g=this.Ed(e);if(void 0!==g){a:{var h=g.ya.keys(),k;for(k in h){var l=h[k];if(l.toString()===f){g=g.ya.get(l);break a}}g=void 0}return g}};z.Af=function(e,f,g){e=this.Ue(e,f);if(void 0!==e)return e.oc(g,!0)};z.$h=function(e,f,g,h){e=this.Af(e,f,g);if(void 0!==e)return e.od(h,!0)};z.hd=function(e){var f,g;for(g in P){var h=P[g];if(h.name===e){f=h;break}}if(!f)throw"Can't find RepresentationType corresponding to representationTypeID : "+e;return f};
z.Eg=function(e){if(1<e.length)throw Error("Selection must contain a single object");e=e[0];if(e instanceof Ff)return e;throw Error("Selection must contain a only a molecule");};z.zg=function(e){var f=this,g=Ue(this.ba,e);ah(this.ba.scene3D,g);this.ba.scene3D.ba.Ja=g;Ve(this.ba,g).then(function(){Ye(f.ba);ke(f.ba,g,!0);Ye(f.ba);f.u.pb({type:"structureReady",data:e._id});He(f.u)})};
z.Rc=function(e,f){var g=null,h=e.split(":"),k,l,n;5<h.length&&(n=h[5]+":"+h[6],null==f&&(f=4));3<h.length&&(l=h[3]+":"+h[4],null==f&&(f=3));1<h.length&&(k=h[1]+":"+h[2],null==f&&(f=2));h=h[0];null==f&&(f=1);switch(f){case 1:g=this.Ed(h);break;case 2:g=this.Ue(h,k);break;case 3:g=this.Af(h,k,l);break;case 4:g=this.$h(h,k,l,n)}return null!=g?[g]:[]};z.rj=function(e,f){this.Eg(e).ea.tj(f)};z.De=function(){this.ba.scene3D.De()};z.Yk=function(){this.ba.scene3D.eg()};z.Ch=function(){this.ba.scene3D.Ch()};
z.Zk=function(){this.ba.scene3D.reset()};z.tb=function(e,f,g,h,k){var l=this.Eg(e);null!=g?(g=this.hd(g),g=[fg(l,g)]):g=l.Jb();e=null;if(null!=h){e=[];for(var l=l.ea,n=l.ia,r=null,r=null,q=h[0]-1;q<h[1];q++)if(k?(r=nd(l.fa,q),r=n[r]):(r=q,r=l.mb(r)),null!=r)for(var r=r.xa(),t=0;t<=r.length;t++)e.push(r[t])}for(t=0;t<g.length;t++)g[t].tb(f,e)};z.Uj=function(e){re(this.u,e)};z.ul=function(){this.u.Eb.play()};z.vl=function(){this.u.Eb.stop()};z.Uk=function(){this.u.Eb.pause()};
z.uk=function(){this.u.ad.Zc.css("visibility","hidden")};z.wk=function(){this.u.Sh.hide()};z.addListener=function(e,f){this.u.addListener(e,f)};z.Ki=function(){return this.u.Ki()};z.Lh=function(e,f){this.u.Lh(e,f)};z.jf=function(e,f){if(1===e.length&&e[0]instanceof Wg)var g=e[0],h=this.hd(f);else throw Error("Selection must contain a single object");return g.Wf(h)};z.Dj=function(e,f,g){if(1===e.length)ne(this.ba.scene3D,e[0],g,f);else throw Error("Selection must contain a single object");};
z.wj=function(e){if(1===e.length)this.ba.scene3D.ba.Ja=e[0];else throw Error("Selection must contain a single object");};z.mk=function(e){var f;if(1!==e.length)throw Error("Selection must contain a single object");if(e[0]instanceof Ff){f=e[0].ea;e=e[0].ab();f=f.ia;for(var g=0;g<f.length;g++)if(void 0==e.Mc.get(f[g]))return!1;return!0}return e[0]instanceof Hf?(f=e[0].Cb,e=e[0].hb().ab(),void 0!=e.Mc.get(f)):!1};z.nk=function(){return 0!==this.ba.scene3D.ka.length};
z.fh=function(){for(var e=[],f=this.ba,g=f.scene3D.ka.length,h=0;h<g;h++){var k=f.scene3D.ka[h];k instanceof M&&e.push(k.Uc())}return e};z.eh=function(e){return this.Ed(e).ya.keys()};z.hk=function(e,f){for(var g=this.Ue(e,f).ea.ia,h=[],k=0;k<g.length;k++)h.push(g[k].toString());return h};z.Jc=function(e){var f=this;this.ba.Jc(e).then(function(e){e instanceof Error?console.warn(e):f.zg(e)})};z.Xf=function(e){var f=this;this.ba.Xf(e).then(function(e){e instanceof Error?console.warn(e):f.zg(e)})};
z.Rj=function(e){var f=this.Ed(e);if(null==f)throw Error("Structure with id: "+e+" not found");oe(this.ba,f)};z.gg=function(e,f,g,h,k){this.ba.scene3D.gg(e,f,g,h,k)};z.jg=function(e,f){for(var g=this.hd(f),h=0,k=e.length;h<k;h++)e[h].show(g)};z.Fi=function(e,f){for(var g=this.hd(f),h=0,k=e.length;h<k;h++)e[h].hide(g)};z.show=function(e,f){for(var g=[],h=0,k=e.length;h<k;h++){var l=e[h];l.visible=!0;f&&l instanceof M&&(g=g.concat(We(l)))}0!=g.length&&this.show(g)};
z.hide=function(e){for(var f=0,g=e.length;f<g;f++)e[f].visible=!1};z.Gk=function(e){if(1===e.length)return e[0].visible;throw Error("Selection must contain a single object");};z.Mb=function(e,f){var g,h;if(1!==e.length)throw Error("Selection must contain a single object");if(e[0]instanceof Ff)g=e[0].ea,h=e[0].ab();else if(e[0]instanceof Hf)g=e[0].Cb,h=e[0].hb().ab();else throw Error("Selection item is not a Molecule or a Residue");h.Mb(g,f)};
z.tk=function(e){var f;if(1!==e.length)throw Error("Selection must contain a single object");if(e[0]instanceof Ff)f=e[0].ea.ia,e=e[0].ab();else if(e[0]instanceof Hf)f=e[0].Cb,e=e[0].hb().ab();else throw Error("Selection item is not a Molecule or a Residue");qe(e,f)};
z.ef=function(e,f,g){if(1!==f.length)throw Error("Selection must contain a single object");f[0]instanceof M&&(f=We(f[0]));var h=Gf.fk(e);null==h&&(h=e);e=0;for(var k=f.length;e<k;e++)if(null!=f[e])for(var l=f[e].Jb(),n=0,r=l.length;n<r;n++){var q=l[n].$c;null!=g&&q!==g||l[n].color(h)}};
z.hg=function(e,f,g){if(1!==f.length)throw Error("Selection must contain a single object");f[0]instanceof M&&(f=We(f[0]));for(var h=0,k=f.length;h<k;h++)if(null!=f[h])for(var l=f[h].Jb(),n=0,r=l.length;n<r;n++){var q=l[n].$c;null!=g&&q!==g||l[n].hg(e)}};z.Cj=function(e){var f=this.ba;e=this.Ed(e);f.u=new THREE.Matrix4;f.u.copy(e.matrix);var g;g="["+f.u.elements[0];for(var h=f.u.elements.length,k=1;k<h;k++)g+=","+f.u.elements[k];console.log(e+" : "+(g+"]"))};
z.dl=function(e){var f=this.ba;e=new THREE.Color(e);f.ra.Ld(e)};z.kg=function(e){this.ba.kg(e)};z.qf=function(){this.ba.qf()};window.BiovizAPI=U.prototype.constructor;U.prototype.RepresentationTypeID=$i;U.prototype.RepresentationTypeID.NONE=Mi;U.prototype.RepresentationTypeID.SPHERES=Ni;U.prototype.RepresentationTypeID.LINES=Oi;U.prototype.RepresentationTypeID.BALL_AND_STICKS=Pi;U.prototype.RepresentationTypeID.STICKS=Qi;U.prototype.RepresentationTypeID.ATOMS=Ri;
U.prototype.RepresentationTypeID.MOLECULAR_SURFACE_WIREFRAME=Si;U.prototype.RepresentationTypeID.MOLECULAR_SURFACE=Ti;U.prototype.RepresentationTypeID.ACCESSIBLE_SURFACE_WIREFRAME=Ui;U.prototype.RepresentationTypeID.ACCESSIBLE_SURFACE=Vi;U.prototype.RepresentationTypeID.CARTOON=Wi;U.prototype.RepresentationTypeID.CYLINDER=Xi;U.prototype.RepresentationTypeID.ALPHA_SHAPE=Yi;U.prototype.RepresentationTypeID.ALPHA_SHAPE_WIREFRAME=Zi;U.prototype.LabelTypeID=fj;U.prototype.LabelTypeID.STRUCTURE=aj;
U.prototype.LabelTypeID.MOLECULE=bj;U.prototype.LabelTypeID.RESIDUE=cj;U.prototype.LabelTypeID.ATOM=dj;U.prototype.LabelTypeID.VDW=ej;U.prototype.ColorMappingID=oj;U.prototype.ColorMappingID.Molecule=gj;U.prototype.ColorMappingID.Residue=hj;U.prototype.ColorMappingID.Atom=ij;U.prototype.ColorMappingID.CarbonAtom=jj;U.prototype.ColorMappingID.HeteroAtom=kj;U.prototype.ColorMappingID.SST=lj;U.prototype.ColorMappingID.Rainbow=mj;U.prototype.ColorMappingID.Hydrophobicity=nj;z=U.prototype;
z.Ok=function(e,f,g,h){var k=this,l=new pj(e);new pj(f);for(var n=new qj(g,0,this.ba.scene3D),r=l.ja.keys().length,q=[],t=0;t<r;t++){var x=bd(l.ja)[t],x=this.ba.Jc(x);q.push(x);x.then(function(l){l=Ue(k.ba,l,g);n.Ng(l);l=new rj(n,h,g);for(var q=k.Sf(g,e),r=0,t=q.length;r<t;r++)Xe(q[r]);q=k.Sf(g,f);r=0;for(t=q.length;r<t;r++)q[r].show(P.ac).color("atom");ke(k.ba,l,!0);k.ba.scene3D.ba.Ja=l;Ye(k.ba)})["catch"](function(e){console.warn("Error on loadStructure : ",e)})}return Promise.all(q).then(function(){return"Query loaded"})};
z.Qj=function(){this.he()["delete"]();Ye(this.ba)};
z.Nk=function(e,f,g,h,k){var l=this,n=new pj(e),r=this.he();if(null==sj(r,f)){var q=new tj(f,r),r=new THREE.Vector3(h[4],h[5],h[6]);h=new THREE.Quaternion(h[1],h[2],h[3],h[0]);h=(new THREE.Matrix4).compose(r,h,new THREE.Vector3(1,1,1));q.applyMatrix(h);q.updateMatrixWorld(!0);h=n.ja.keys().length;for(var r=[],t=0;t<h;t++){var x=bd(n.ja)[t],x=this.ba.Jc(x);r.push(x);x.then(function(h){var r=Ue(l.ba,h,f);q.Ng(r);null!=g&&new rj(q,g,f);for(var r=0,t=bd(n.ja),x=t.length,I=0;I<x;I++)if(t[I].toUpperCase()===
h.Gg.toUpperCase()){r=h.Gg;break}if(null!=k)for(h=0,t=k.length;h<t;h++)x=k[h],I=new uj(q.nb,q,x.qTips),q.Lc[x.type]=I,q.add(I);h=l.Sf(f,e);t=0;for(x=h.length;t<x;t++)Xe(h[t]);r=n.ja.get(r).ja.keys();h=0;for(t=r.length;h<t;h++)x=l.Rc(f+":Ligand:"+r[h],2),l.jg(x,Qi),l.ef("atom",x,Qi);Ye(l.ba)})["catch"](function(e){console.warn("Error on loadStructure : ",e)})}return Promise.all(r).then(function(){return"Hit loaded"})}};z.Pj=function(e){e=this.gd(e);null!=e&&(e["delete"](),Ye(this.ba))};
z.Sf=function(e,f){for(var g=[],h=new pj(f),k=bd(h.ja),l=k.length,n=0;n<l;n++)for(var r=h.ja.get(k[n]),q=r.ja.keys(),t=q.length,x=0;x<t;x++)for(var w=q[x],C=r.ja.get(w),F=C.length,G=0;G<F;G++){var I=C[G],D;a:{switch(I.type){case vj:D=["Protein","Small Peptide","Peptide","DNA","RNA"];break a;case wj:D=["Solvent"];break a;case xj:D=["Ligand"];break a}D=void 0}for(var K=null,H=0,L=D.length;H<L;H++)K=D[H],K=I.type==xj?this.Af(e,K+":"+w,I.Hh+":"+I.Gh):this.Ue(e,K+":"+w),null!=K&&g.push(K)}return g};
z.Hk=function(e,f){var g=this.ie(e),h=this.hd(f);return g.Wf(h)};z.nl=function(e,f){var g=this.ie(e),h=this.hd(f);g.show(h)};z.vk=function(e,f){var g=this.ie(e),h=this.hd(f);g.hide(h)};z.ll=function(e){e=sj(this.he(),e);null!=e&&e.show()};z.sk=function(e){e=sj(this.he(),e);null!=e&&e.hide()};z.ml=function(e){e=We(e[0]);for(var f in e){var g=e[f];g.visible="Ligand"!==g.qa.type?!1:!0}};
z.Gj=function(e,f,g,h){e=We(this.Ed(e));for(var k in e){var l=e[k],n=l.qa.type;if("Protein"===n||"Peptide"===n||"Small Peptide"===n){var l=l.Jb(),r;for(r in l)l[r].ig(f,g,h)}}};z.Ij=function(e,f,g){f=this.ie(f).Jb();for(var h in f){var k=f[h].$c;null!=g&&k!==g||f[h].color(e)}};z.Hj=function(e,f,g,h,k){h=this.ie(h).Jb();for(var l in h){var n=h[l].$c;null!=k&&n!==k||h[l].color([e,f,g])}};z.hl=function(e,f){var g=this.gd(e).Lc[f];g&&g.show()};z.pk=function(e,f){var g=this.gd(e).Lc[f];g&&g.hide()};
z.jl=function(e,f){var g=this.gd(e).Lc[f];g&&(g.re.visible=!1,g.Ie.visible=!0)};z.rk=function(e,f){var g=this.gd(e).Lc[f];g&&(g.Ie.visible=!1)};z.il=function(e,f){var g=this.gd(e).Lc[f];g&&(g.Ie.visible=!1,g.re.visible=!0)};z.qk=function(e,f){var g=this.gd(e).Lc[f];g&&(g.re.visible=!1)};z.ie=function(e){var f=this.ba.scene3D,g;for(g in f.ka){var h=f.ka[g];if(h instanceof rj&&h.name===e)return f.ka[g]}return null};z.he=function(){return this.ba.scene3D.nb};z.gd=function(e){return sj(this.he(),e)};
function yj(e){this.pa=e;this.ja=new fa}yj.prototype.vb=function(){return structure+"@"+chain};function zj(e,f,g){this.type=e;this.Hh=f;this.Gh=g}zj.prototype.toString=function(){var e="";switch(this.type){case vj:e+="T";break;case wj:e+="S";break;case xj:e+="L"}null!=this.Hh&&null!=this.Gh&&(e+="."+this.Hh+"."+this.Gh);return e};var vj="TARGET",wj="SOLVENT",xj="LIGAND";
function Aj(e){switch(e){case "Protein":case "Small Peptide":case "Peptide":case "DNA":case "RNA":return vj;case "Solvent":return wj;case "Ligand":return xj;default:return null}}function Bj(e){switch(e.toUpperCase()){case "T":case "TAR":case "TARGET":return vj;case "L":case "LIG":case "LIGAND":return xj;case "S":case "SOL":case "SOLVENT":return wj;default:return vj}}
function pj(e){this.ja=new fa;if(null!=e){e=e.split("+");for(var f=0;f<e.length;f++){var g=e[f].split("/"),h=g[0].toUpperCase(),k=new yj(h);this.ja.set(h,k);for(var h=g.slice(1),l=0;l<h.length;l++){var g=h[l].split(":"),n=g[0].toUpperCase();k.ja.set(n,[]);for(var g=g[1].split(","),r=0;r<g.length;r++){var q="",t=null,x=null,w=g[r].split("."),q=w[0].toUpperCase();3===w.length&&(t=w[1].toUpperCase(),x=parseFloat(w[2]));q=new zj(Bj(q),t,x);k.ja.get(n).push(q)}}}}}
pj.prototype.toString=function(){for(var e="",f=bd(this.ja),g=0,h=f.length;g<h;g++){0<g&&(e+="+");for(var k=f[g],e=e+(k+"/"),k=this.ja.get(k),l=k.ja.keys(),n=0,r=l.length;n<r;n++){0<n&&(e+="/");for(var q=l[n],t=k.ja.get(q),e=e+(q+":"),q=0,x=t.length;q<x;q++)e+=t[q].toString()}}return e};function Cj(e){Ef.call(this,e);this.nb=e.nb;this.zl=e.gh}Cj.prototype=Object.create(Ef.prototype);Cj.prototype.constructor=Cj;P.Uh=new Lf("BVS Matching","BVSMatching",Cj);
Cj.prototype.Ua=function(){var e=new THREE.CylinderGeometry(.1,.1,1),f=(new THREE.BufferGeometry).fromGeometry(e),g=this.oa.length/2,h=f.attributes.position.array.length/f.attributes.position.itemSize,k=g*h,e=new THREE.BufferGeometry,l=new Float32Array(3*k),n=new Float32Array(3*k),r=new Float32Array(3*k),q=new Float32Array(2*k),k=new Float32Array(k),t=new THREE.Matrix4;t.makeRotationX(.5*Math.PI);for(var x=0;x<g;x++){var w=this.oa[2*x+1],C=this.Da.cj[x],F=this.oa[2*x].pos.clone(),G=w.pos.clone(),
w=(new THREE.Matrix4).getInverse(this.zl.matrix);F.applyMatrix4(w);var I=(new THREE.Vector3).addVectors(F,G).multiplyScalar(.5),w=(new THREE.Vector3).subVectors(F,G),D=new THREE.Vector3(1,w.length(),1),K=new THREE.Matrix4;K.lookAt(G,F,new THREE.Vector3(0,1,0));K.multiply(t);K.setPosition(I);K.scale(D);I=f.clone();I.applyMatrix(K);F=I.attributes.position.array;G=I.attributes.normal.array;K=I.attributes.color.array;I=I.attributes.uv.array;C=Cj.Yf(w.length(),C);w=F.length/3;for(D=0;D<w;D++){for(var H=
0;3>H;H++)l[x*F.length+3*D+H]=F[3*D+H],n[x*G.length+3*D+H]=G[3*D+H],r[x*K.length+3*D+H]=C[H];for(H=0;2>H;H++)q[x*I.length+2*D+H]=I[2*D+H];k[x*h+D]=x}}e.addAttribute("position",new THREE.BufferAttribute(l,3));e.addAttribute("normal",new THREE.BufferAttribute(n,3));K=new THREE.BufferAttribute(r,3);K.dynamic=!0;e.addAttribute("color",K);e.addAttribute("uv",new THREE.BufferAttribute(q,2));e.addAttribute("atomIndex",new THREE.BufferAttribute(k,1));e.sd();f=De();e=new THREE.Mesh(e,f);e.Ha=this;this.parent.add(e);
this.ga=e};Cj.prototype.update=function(){};Cj.Ae=[new THREE.Color(.7,.7,.7),new THREE.Color(0,1,0)];Cj.Vd=[new THREE.Color(1,0,0),new THREE.Color(.9,.5,.1)];Cj.ze=[.5,1];Cj.Ud=[.25,.75];Cj.Yf=function(e,f){var g=null,g=5<e||.5>f||.7>f&&4<e?Cj.ud(Cj.Vd,Cj.Ud,f):Cj.ud(Cj.Ae,Cj.ze,f);return g.toArray()};
Cj.ud=function(e,f,g){var h=f[0],k=f[1];f=null;if(g>=h&&g<=k){var l=e.length-1;f=(k-h)/l;k=Math.ceil((g-h)/(k-h)*l)-1;l=h+k*f;g=(g-l)/(h+(k+1)*f-l);h=e[k].clone();e=e[k+1].clone();h.lerp(e,g);f=h}else f=g<h?e[0]:e[e.length-1];return f};function Dj(e){Fg.call(this,e);this.Sd=e.Sd;e=this.oa.length;for(var f=[],g=[],h=0;h<e;h++){var k=this.oa[h].mb();if(!(0<=f.indexOf(k))){var l=k.xa(),g=g.concat(l);f.push(k)}}this.oa=g}Dj.prototype=Object.create(Fg.prototype);Dj.prototype.constructor=Dj;
P.qj=new Lf("BVS Residues","BVSResidues",Dj);function wk(e){Ef.call(this,e);this.Sd=e.Sd}wk.prototype=Object.create(Ef.prototype);wk.prototype.constructor=wk;P.Vh=new Lf("BVS Surface","BVSSurface",wk);
wk.prototype.Ua=function(){for(var e=new Sd(!0),f=[],g=this.Sd.le.values(),h=g.length,k=0;k<h;k++)f.push(g[k]);for(g=0;g<f.length;g++)h=f[g].Dd,Td(e,h.pos.x,h.pos.y,h.pos.z,new THREE.Color("#AAAA00")),e.Nc.push(this.Da.oa.indexOf(h));for(g=0;g<f.length;g++)if(h=f[g],k=h.Qc())for(var l=0;l<k.length;l++)for(var n=gd(k[l],h),r=n.Qc(),q=0;q<r.length;q++){var t=gd(r[q],n);t!==h&&t.Ei(h)&&Ud(e,h._id,n._id,t._id)}e=Vd(e);f=De();f.shading=THREE.FlatShading;f.vertexColors=THREE.FaceColors;f.side=THREE.DoubleSide;
e=new THREE.Mesh(e,f);e.qa=this.Aa;e.Ha=this;this.parent.add(e);this.ga=e};wk.prototype.update=function(){};function xk(e){Fg.call(this,e);this.ec=e.Sd}xk.prototype=Object.create(Fg.prototype);xk.prototype.constructor=xk;P.pj=new Lf("BVS Mesh","BVSMesh",xk);xk.prototype.Ua=function(){Fg.prototype.Ua.call(this);this.lf("residue")};function tj(e,f){Wg.call(this);this.Lb=te();this._id=e;this.ic=[];this.$d=null;var g=this.nb=f;g.rd.push(this);g.add(this);this.Lc={}}tj.prototype=Object.create(Wg.prototype);
z=tj.prototype;z.constructor=tj;
z["delete"]=function(){Wg.prototype["delete"].call(this);var e=this;this.traverse(function(f){f===e.nb.scene3D.ba.Ja&&(e.nb.scene3D.ba.Ja=null);f===e.nb.scene3D.ba.Xa&&(e.nb.scene3D.ba.Xa=e.nb.scene3D)});for(var f=this.nb.parent.ka,g=0,h=this.ic.length;g<h;g++)f.splice(f.indexOf(this.ic[g]),1),this.ic[g]["delete"]();f.splice(f.indexOf(this.$d),1);for(var k in this.Lc)this.remove(this.Lc[k]),this.Lc[k]["delete"]();this.$d["delete"]();this.parent.remove(this);this.nb.rd.splice(this.nb.rd.indexOf(this),1)};
z.Ng=function(e){this.ic.push(e);this.nb.scene3D.ka.push(e);this.add(e);var f=this;e.qb=function(){var e=null,h;for(h in this.ya.keys()){var k=this.ya.get(this.ya.keys()[h]),l=k.qb().clone();l.applyMatrix4(k.matrix);e=null===e?l:e.merge(l)}e.applyMatrix4(f.matrix);return e};e.updateMatrixWorld(!0)};z.gi=function(e){this.$d=e;this.nb.scene3D.ka.push(e);this.add(e)};z.show=function(){this.visible=!0};z.hide=function(){this.visible=!1};
function uj(e,f,g){Wg.call(this);this.nb=e;this.gh=f;this.ag=g;this.Lb=te();this.Ie=new THREE.Object3D;this.add(this.Ie);this.Ie.visible=!1;this.re=new THREE.Object3D;this.add(this.re);this.re.visible=!1;this.oa=Array(2*this.ag.length);this.cj=Array(this.ag.length);e=this.nb.ic[0].pa.Qf().xa();f=this.gh.ic[0].pa.Qf().xa();g=0;for(var h=this.ag.length;g<h;g++){var k=this.ag[g],l=yk(e,k.queryAtom),n=yk(f,k.targetAtom),k=parseFloat(k.value);this.oa[2*g]=l;this.oa[2*g+1]=n;this.cj[g]=k;var l=l.pos.clone(),
n=n.pos.clone(),r=(new THREE.Matrix4).getInverse(this.gh.matrix);l.applyMatrix4(r);r=(new THREE.Vector3).addVectors(l,n).multiplyScalar(.5);l=(new THREE.Vector3).subVectors(l,n).length();this.Ie.add(this.yf(k.toFixed(2),15,null,r));this.re.add(this.yf(l.toFixed(2),15,null,r))}e=fg(this,P.Uh);null!==e&&void 0!==e&&e.show();this.visible=!1}uj.prototype=Object.create(Wg.prototype);uj.prototype.constructor=uj;Yg.add(uj,[P.Uh]);uj.prototype["delete"]=function(){Wg.prototype["delete"].call(this)};
uj.prototype.show=function(){this.visible=!0};uj.prototype.hide=function(){this.visible=!1};function yk(e,f){for(var g=null,h=0,k=e.length;h<k;h++){var l=e[h];l.name+"."+l.id===f.split(".",2).join(".")&&(g=l)}return g}uj.prototype.yf=function(e,f,g,h){e=Ae(e,f);return Rd(e,h)};function qj(e,f,g){Wg.call(this);this.Lb=te();this._id=e;this.ic=[];this.$d=null;this.rd=[];this.scene3D=g;this.scene3D.nb=this;this.scene3D.add(this)}qj.prototype=Object.create(Wg.prototype);qj.prototype.constructor=qj;
qj.prototype["delete"]=function(){Wg.prototype["delete"].call(this);var e=this;this.traverse(function(f){f===e.scene3D.ba.Ja&&(console.log("hasAnchor"),e.scene3D.ba.Ja=null);f===e.scene3D.ba.Xa&&(console.log("hasTarget"),e.scene3D.ba.Xa=e.scene3D)});for(var f=this.parent.ka,g=0,h=this.ic.length;g<h;g++)f.splice(f.indexOf(this.ic[g]),1),this.ic[g]["delete"]();this.$d["delete"]();f.splice(f.indexOf(this.$d),1);g=0;for(h=this.rd.length;g<h;g++)this.rd[0]["delete"]();this.rd=null;this.scene3D.nb=null;
this.parent.remove(this)};qj.prototype.Ng=function(e){this.ic.push(e);this.scene3D.ka.push(e);e.scene3D=this.scene3D;this.add(e);var f=this;e.qb=function(){var e=null,h;for(h in this.ya.keys()){var k=this.ya.get(this.ya.keys()[h]),l=k.qb().clone();l.applyMatrix4(k.matrix);e=null===e?l:e.merge(l)}e.applyMatrix4(f.matrix);return e}};qj.prototype.gi=function(e){this.$d=e;this.scene3D.ka.push(e);this.add(e)};
function sj(e,f){for(var g=0,h=e.rd.length;g<h;g++){var k=e.rd[g];if(k._id===f)return k}return null}
function rj(e,f,g){Wg.call(this);this.Lb=te();this.aj=e;this.aj.gi(this);this.name=g;this.rf=this.aj.ic[0];this.qa=this.rf.pa.Qf();e=new ib;g=this.qa.xa();for(var h=f.isolated,k=0;k<h.length;k++){for(var l=h[k].value,n=null,r=0;r<g.length&&(null==x||null==w);r++){var q=g[r],t=q.name+"."+q.id;t===l.split(".",2).join(".")&&(n=q)}null==e.findNode(n)&&e.Ff(n)}f=f.edges;for(k=0;k<f.length;k++){for(var h=f[k].v1,l=f[k].v2,x=null,w=null,r=0;r<g.length&&(null==x||null==w);r++)q=g[r],t=q.name+"."+q.id,t===
h.split(".",2).join(".")&&(x=q),t===l.split(".",2).join(".")&&(w=q);r=e.findNode(x);null==r&&(r=e.Ff(x));x=e.findNode(w);null==x&&(x=e.Ff(w));w=!1;if(q=e.fd.get(r))for(t=0,h=q.length;t<h;t++)if(gd(q[t],r)===x){w=!0;break}w||e.Kg(r,x)}this.Sd=e;this.oa=this.Sd.values();this.updateMatrixWorld(!0);fg(this,P.Vh).show()}rj.prototype=Object.create(Wg.prototype);rj.prototype.constructor=rj;Yg.add(rj,[P.Vh,P.pj,P.qj,P.oj]);z=rj.prototype;z["delete"]=function(){Wg.prototype["delete"].call(this)};z.Uc=function(){return this.name};
z.reset=function(){};z.Yd=function(){};z.Pc=function(){return jd(this.qb())};z.qb=function(){for(var e=new THREE.Vector3(Infinity,Infinity,Infinity),f=new THREE.Vector3(-Infinity,-Infinity,-Infinity),g=0,h=this.oa.length;g<h;g++){var k=this.oa[g].pos;e.x=Math.min(e.x,k.x);e.y=Math.min(e.y,k.y);e.z=Math.min(e.z,k.z);f.x=Math.max(f.x,k.x);f.y=Math.max(f.y,k.y);f.z=Math.max(f.z,k.z)}e=new Va(e,f);e.applyMatrix4(this.parent.matrix);return e};z=U.prototype;
z.Sj=function(e,f,g){var h=new fa,k=this.Rc(e)[0],l=[];e=0;for(var n=f.length;e<n;e++)l.push(this.Rc(f[e])[0]);var r=[],q=new THREE.Vector3(Infinity,Infinity,Infinity),t=new THREE.Vector3(-Infinity,-Infinity,-Infinity);e=0;for(n=l.length;e<n;e++)if(f=l[e],f!==k){var x=f.oa;f=0;for(var w=x.length;f<w;f++){var C=x[f];q.min(C.pos);t.max(C.pos);r.push(new xb(C))}}l=new wb(q,t);l.add(r);l.optimize();k=k.oa;e=0;for(n=k.length;e<n;e++)for(C=k[e],r=C.radius(),q=l.ah(C.pos,2*g),f=0,t=q.length;f<t;f++){var x=
q[f].getPoint(),F=x.mb(),G=F.ea,w=G.Ec().toString()+":"+G.toString();G.Pi()&&(w+=":"+F.cc+":"+F._id);F=x.distanceTo(C);G=x.radius();F/(r+G)<=g&&(F=h.get(w),null==F&&(F=[],h.set(w,F)),F.push([C,x]))}return h};z.bk=function(e){var f=new pj,g=e.split(":"),h=g[0],k=g[1];e=g[2];var l=null,n=null;3<g.length&&(l=g[3],n=g[4]);g=new yj(h);g.ja.set(e,[]);f.ja.set(h,g);h=new zj(Aj(k),l,n);g.ja.get(e).push(h);return f.toString()};
z.ak=function(){for(var e=[],f=this.fh(),g=f.length,h=0;h<g;h++)for(var k=f[h],l=this.eh(k),n=0,r=l.length;n<r;n++){var q=l[n];q.Qi()&&e.push(k+":"+q.toString())}return e};z.$j=function(){for(var e=[],f=this.fh(),g=f.length,h=0;h<g;h++)for(var k=f[h],l=this.eh(k),n=0,r=l.length;n<r;n++){var q=l[n];if(q.Qi())e.push(k+":"+q.toString());else if(q.Pi())for(var t=q.ia,x=0,w=t.length;x<w;x++)e.push(k+":"+q.toString()+":"+t[x].toString())}return e};
z.ik=function(e,f){for(var g=[],h=0,k=e.length;h<k;h++){var l=e[h][f].mb(),l=l.ea.Ec().toString()+":"+l.ea.toString()+":"+l.toString();0>g.indexOf(l)&&g.push(l)}return g};z.dk=function(e){return e.pa.blob};
(function(e){e.widget("bionext.bvsjobswidget",{options:{ca:null},xh:[],Vf:null,$f:null,_create:function(){this.element.addClass("bionext.bvsjobswidget");this.ca=this.options.ca;if(null==this.ca)throw new Exception("You must set bioviz option when using this widget");this.Hd()},_destroy:function(){this.element.removeClass("bionext.bvsjobswidget")},Hd:function(){var f=this,g;g='<label for="target">Select a target : </label><select name="target" id="target"><option disabled>No target available</option></select><br><label for="dist">Interaction distance : </label>';
g+='<input type="text" id="dist" readonly>';g+='<div id="distSlider"></div>';g+="<br>";g+='<button id="detect">Detect</button>';g+="<br>";g+='<label for="detected">Detected Ligand : </label>';g+='<select name="detected" id="detected"><option disabled>No compound available</option></select>';g+='<input type="checkbox" id ="focus">autoFocus</input>';g+="<br>";g+='<input id="title" placeholder="Title">';g+='<select name="db" id="db"><option>crystal</option><option>small-mq</option></select>';g+="<br>";
g+='<input id="compoundStr" placeholder="Compound selection">';g+='<input id="siteStr" placeholder="Site selection">';g+='<button id="submit">Submit</button>';g=e('<div id="bvsjobswidget" class="ui-widget-header ui-corner-all">'+g+"</div>");this.element.empty();g.appendTo(this.element);e("#target").selectmenu().addClass("disabled");e("#detected").selectmenu().addClass("disabled");e("#db").selectmenu();e("#distSlider").slider({value:20,min:1,max:80,step:1,slide:function(f,g){e("#dist").val(g.value/
10+"A")}}).each(function(){for(var f=e(this).data()["ui-slider"].options,g=f.max-f.min,l=0;l<=g;l++)if(0===(l+f.min)%20){var n=e("<label>"+(l+f.min)/10+"</label>").css("left",l/g*100+"%");e("#distSlider").append(n)}});e("#dist").val(e("#distSlider").slider("value")/10+"A");e("#detect").button().attr("disabled",!0);e("#submit").button().attr("disabled",!0);e("#target").css("color","black").css("font-weight","normal");e("#detected").css("color","black").css("font-weight","normal");e("#db").css("color",
"black").css("font-weight","normal");e("#title").css("color","black").css("font-weight","normal");e("#compoundStr").css("color","black").css("font-weight","normal");e("#siteStr").css("color","black").css("font-weight","normal");e("#dist").css("color","black").css("font-weight","normal");e("#distSlider label").css("position","absolute").css("width","20px").css("margin-top","10px").css("margin-left","-10px").css("text-align","center");e("#detect").click(function(){e("#detected").empty();f.Vf=f.ca.ca("detectLigands",
e("#target").val(),f.xh,e("#distSlider").slider("value")/10);var g=f.Vf.keys();if(0<g.length){for(var k=0,l=g.length;k<l;k++)e("#detected").append(e("<option></option>").attr("value",g[k]).text(g[k]));e("#detected").selectmenu().removeClass("disabled");e("#submit").button().removeAttr("disabled")}else e("#detected").append(e("<option disabled></option>").attr("value","No compound available").text("No compound available")),e("#detected").selectmenu().addClass("disabled");e("#detected").selectmenu("refresh",
!0);f.ji();e("#focus").is(":checked")&&setTimeout(function(){var g=f.ca.ca("getObjects3DFromSelection",e("#detected").val());f.ca.ca("centerOnSelection",g,!1);f.ca.ca("anchorOnSelection",g)},200)});e("#target").on("selectmenuselect",function(){var g=f.ca.ca("getObjects3DFromSelection",e("#target").val(),1);f.ca.ca("centerOnSelection",g)});e("#detected").on("selectmenuchange",function(){null!=f.Vf&&(f.ji(),e("#focus").is(":checked")&&setTimeout(function(){var g=f.ca.ca("getObjects3DFromSelection",
e("#detected").val());f.ca.ca("centerOnSelection",g,!1);f.ca.ca("anchorOnSelection",g)},200))});e("#focus").change(function(){if(!e("#submit").button().attr("disabled"))if(e(this).is(":checked"))g=f.ca.ca("getObjects3DFromSelection",e("#detected").val()),f.ca.ca("centerOnSelection",g,!1);else{var g=f.ca.ca("getObjects3DFromSelection",e("#target").val(),1);f.ca.ca("centerOnSelection",g)}});e("#submit").click(function(){f.cl()});this.ca.ca("addListener","requestWidgetUpdate",function(){f.El()})},El:function(){var f=
e("#target").val();e("#target").empty();this.xh=[];if(this.ca.ca("hasObject3D")){e("#target").selectmenu().removeClass("disabled");e("#detect").button().removeAttr("disabled");for(var g=this.ca.ca("getAvailableTargets"),h=0,k=g.length;h<k;h++){var l=g[h];e("#target").append(e("<option></option>").attr("value",l).text(l))}this.xh=this.ca.ca("getAvailableCompounds")}else e("#target").append(e("<option disabled></option>").attr("value","No target available").text("No target available")),e("#target").selectmenu().addClass("disabled"),
e("#detect").button().attr("disabled",!0);e("#target").selectmenu("refresh",!0);g=e("#selectBox option");0>e.map(g,function(e){return e.value===f}).indexOf(!0)&&this.Bl()},Bl:function(){e("#detected").empty();e("#detected").append(e("<option></option>").attr("value","No compound available").text("No compound available"));e("#detected").selectmenu("refresh",!0);e("#submit").button().attr("disabled",!0);e("#compoundStr").val("");e("#siteStr").val("")},ji:function(){this.Dl();this.$k();this.$f=e("#detected").val();
for(var f=this.Vf.get(e("#detected").val()),g=this.ca.ca("getSelectionFromInteraction",f,0),f=this.ca.ca("getSelectionFromInteraction",f,1),h=0,k=g.length;h<k;h++){var l=this.ca.ca("getObjects3DFromSelection",g[h]);this.ca.ca("showRepresentation",l,e.u.xg.ac);this.ca.ca("colorBy",[255,0,0],l,e.u.xg.ac);this.ca.ca("showLabel",l,e.u.sj.Gb)}h=0;for(k=f.length;h<k;h++)l=this.ca.ca("getObjects3DFromSelection",f[h]),this.ca.ca("showRepresentation",l,e.u.xg.ac),this.ca.ca("colorBy",[0,255,0],l,e.u.xg.ac),
this.ca.ca("showLabel",l,e.u.sj.Gb)},$k:function(){var f=this.ca.ca("getObjects3DFromSelection",e("#target").val());this.ca.ca("removeResidues3D",f);this.ca.ca("hideLabel",f);null!=this.$f&&(f=this.ca.ca("getObjects3DFromSelection",this.$f,2),0===f.length?this.$f=null:(this.ca.ca("removeResidues3D",f),this.ca.ca("hideLabel",f)))},Dl:function(){var f=this.ca.ca("getBVSSelectionFromBiovizSelection",e("#target").val()),g=this.ca.ca("getBVSSelectionFromBiovizSelection",e("#detected").val());e("#compoundStr").val(g);
e("#siteStr").val(f)},cl:function(){var f={title:e("#title").val(),Kf:e("#db").val(),Ml:e("#compoundStr").val(),Ol:e("#siteStr").val()},g=this.ca.ca("getObjects3DFromSelection",e("#target").val(),1),g=this.ca.ca("getFileFromStructureSelection",g[0]);console.log(g);console.log(JSON.stringify(f))}})})(jQuery);U.prototype.createBioviz=U.prototype.Nj;U.prototype.initBioviz=U.prototype.yk;U.prototype.isAvailable=U.prototype.Ck;U.prototype.setExternalContextMenuDiv=U.prototype.fl;
U.prototype.getCanvas=U.prototype.Pf;U.prototype._notify=U.prototype.pb;U.prototype._getStructure=U.prototype.Ed;U.prototype._getMolecule=U.prototype.Ue;U.prototype._getResidue=U.prototype.Af;U.prototype._getAtom=U.prototype.$h;U.prototype._getRepresentationType=U.prototype.hd;U.prototype._checkSingleMolecule3DFromSelection=U.prototype.Eg;U.prototype._afterLoaded=U.prototype.zg;U.prototype.getObjects3DFromSelection=U.prototype.Rc;U.prototype.linkWithExternalSequence=U.prototype.rj;
U.prototype.resetRepresentations=U.prototype.De;U.prototype.resetHighlights=U.prototype.Yk;U.prototype.resetPositions=U.prototype.Ch;U.prototype.resetScene=U.prototype.Zk;U.prototype.highlight=U.prototype.tb;U.prototype.executeScript=U.prototype.Uj;U.prototype.startScript=U.prototype.ul;U.prototype.stopScript=U.prototype.vl;U.prototype.pauseScript=U.prototype.Uk;U.prototype.hideScriptPlayer=U.prototype.uk;U.prototype.hideWidgetManager=U.prototype.wk;U.prototype.addListener=U.prototype.addListener;
U.prototype.isDebug=U.prototype.Ki;U.prototype.setOption=U.prototype.Lh;U.prototype.isRepresentationActive=U.prototype.jf;U.prototype.centerOnSelection=U.prototype.Dj;U.prototype.anchorOnSelection=U.prototype.wj;U.prototype.hasLabels=U.prototype.mk;U.prototype.hasObject3D=U.prototype.nk;U.prototype.getStructuresByPDBID=U.prototype.fh;U.prototype.getMoleculesFromStructure=U.prototype.eh;U.prototype.getResiduesFromMolecule=U.prototype.hk;U.prototype.loadStructure=U.prototype.Jc;
U.prototype.loadLocalStructure=U.prototype.Xf;U.prototype.deleteStructure=U.prototype.Rj;U.prototype.say=U.prototype.gg;U.prototype.showRepresentation=U.prototype.jg;U.prototype.hideRepresentation=U.prototype.Fi;U.prototype.show=U.prototype.show;U.prototype.hide=U.prototype.hide;U.prototype.isShowed=U.prototype.Gk;U.prototype.showLabel=U.prototype.Mb;U.prototype.hideLabel=U.prototype.tk;U.prototype.colorBy=U.prototype.ef;U.prototype.setAlpha=U.prototype.hg;U.prototype.capturePosition=U.prototype.Cj;
U.prototype.setBackground=U.prototype.dl;U.prototype.startSpin=U.prototype.kg;U.prototype.stopSpin=U.prototype.qf;U.prototype.loadBvsQuery=U.prototype.Ok;U.prototype.deleteBvsQuery=U.prototype.Qj;U.prototype.loadBvsHit=U.prototype.Nk;U.prototype.deleteBvsHit=U.prototype.Pj;U.prototype.getObjects3DFromBVSSelection=U.prototype.Sf;U.prototype.isSiteRepresentationActive=U.prototype.Hk;U.prototype.showSiteRepresentation=U.prototype.nl;U.prototype.hideSiteRepresentation=U.prototype.vk;
U.prototype.showHit=U.prototype.ll;U.prototype.hideHit=U.prototype.sk;U.prototype.showLigandOnly=U.prototype.ml;U.prototype.colorMolecules=U.prototype.Gj;U.prototype.colorSiteBy=U.prototype.Ij;U.prototype.colorSite=U.prototype.Hj;U.prototype.showBvsHitMatching=U.prototype.hl;U.prototype.hideBvsHitMatching=U.prototype.pk;U.prototype.showBvsHitMatchingLabels=U.prototype.jl;U.prototype.hideBvsHitMatchingLabels=U.prototype.rk;U.prototype.showBvsHitMatchingDistanceLabels=U.prototype.il;
U.prototype.hideBvsHitMatchingDistanceLabels=U.prototype.qk;U.prototype._getSite=U.prototype.ie;U.prototype._getQuery=U.prototype.he;U.prototype._getHit=U.prototype.gd;U.prototype.detectLigands=U.prototype.Sj;U.prototype.getBVSSelectionFromBiovizSelection=U.prototype.bk;U.prototype.getAvailableTargets=U.prototype.ak;U.prototype.getAvailableCompounds=U.prototype.$j;U.prototype.getSelectionFromInteraction=U.prototype.ik;U.prototype.getFileFromStructureSelection=U.prototype.dk;
}(biovizNamespace));